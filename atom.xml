<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>jack110530çš„åšå®¢</title>
  
  <subtitle>è·¯æ¼«æ¼«å…¶ä¿®è¿œå…®ï¼Œå¾å°†ä¸Šä¸‹è€Œæ±‚ç´¢ã€‚</subtitle>
  <link href="https://jack110530.github.io/atom.xml" rel="self"/>
  
  <link href="https://jack110530.github.io/"/>
  <updated>2020-12-15T02:03:24.066Z</updated>
  <id>https://jack110530.github.io/</id>
  
  <author>
    <name>jack110530</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>RAC(1)åŸºç¡€å…¥é—¨</title>
    <link href="https://jack110530.github.io/rac-1-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/"/>
    <id>https://jack110530.github.io/rac-1-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/</id>
    <published>2020-12-14T07:24:10.000Z</published>
    <updated>2020-12-15T02:03:24.066Z</updated>
    
    <content type="html"><![CDATA[<img src="/rac-1-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/RAC.jpg" class=""><blockquote><p>å…³é”®è¯ï¼šrac</p></blockquote><a id="more"></a>        <h4 id="å‰è¨€"   >          <a href="#å‰è¨€" class="heading-link"><i class="fas fa-link"></i></a>å‰è¨€</h4>      <p>ä¸ªäººè®¤ä¸ºï¼Œå­¦ä¹ ä¸€ä¸ªæ–°ä¸œè¥¿æ—¶ï¼Œæœ€å¥½çš„æ–¹å¼æ˜¯å…ˆå­¦ä¼šå»ä½¿ç”¨å®ƒã€‚å…ˆå¯¹å®ƒçš„â€œåŠŸèƒ½â€æœ‰ä¸ªç®€å•çš„è®¤è¯†ï¼ŒçŸ¥é“ä»–çš„åº”ç”¨åœºæ™¯ï¼Œç­‰æ¥è§¦æ—¶é—´é•¿äº†ï¼Œå†æ…¢æ…¢çš„å¯¹å®ƒçš„åº•å±‚åŸç†è¿›è¡Œä¸€ä¸ªæ¢ç´¢ã€‚<br><br>æ‰€ä»¥ï¼Œä»Šå¤©å‘¢ï¼Œå…ˆæ¥å‡ ä¸ªå°demoï¼Œå¯¹RACæœ‰ä¸ªç®€å•çš„è®¤è¯†ã€‚<br><br>é‚£ä¹ˆï¼Œå°±å¼€å§‹å§â€¦<br></p>        <h4 id="æ­£æ–‡"   >          <a href="#æ­£æ–‡" class="heading-link"><i class="fas fa-link"></i></a>æ­£æ–‡</h4>              <h5 id="1ï¼Œç›‘å¬æ–¹æ³•"   >          <a href="#1ï¼Œç›‘å¬æ–¹æ³•" class="heading-link"><i class="fas fa-link"></i></a>1ï¼Œç›‘å¬æ–¹æ³•</h5>      <p>ç›´æ¥ä¸Šä»£ç ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SFViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¿¡å·é‡</span></span><br><span class="line">    RACSignal *signal = [<span class="keyword">self</span> rac_signalForSelector:<span class="keyword">@selector</span>(testFunc:)];</span><br><span class="line">    <span class="comment">// è®¢é˜…ä¿¡å·é‡</span></span><br><span class="line">    [signal subscribeNext:^(<span class="keyword">id</span>  _Nullable x) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,x);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)testFunc:(<span class="built_in">NSInteger</span>)i &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">    [<span class="keyword">self</span> testFunc:<span class="number">10</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><p>æµ‹è¯•å‘ç°ï¼Œå½“æˆ‘ä»¬ç‚¹å‡»å±å¹•æ—¶ï¼Œä¼šæœ‰å¦‚ä¸‹æ‰“å°ï¼š</p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">OCTestDemo[<span class="number">37634</span>:<span class="number">572271</span>] -[SFViewController touchesBegan:withEvent:]</span><br><span class="line">OCTestDemo[<span class="number">37634</span>:<span class="number">572271</span>] -[SFViewController testFunc:]</span><br><span class="line">OCTestDemo[<span class="number">37634</span>:<span class="number">572271</span>] &lt;RACTuple: <span class="number">0x600002dde3d0</span>&gt; (</span><br><span class="line">    <span class="number">10</span></span><br><span class="line">)</span><br></pre></td></tr></table></div></figure><p>ç”±æ­¤å¯çŸ¥ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸçš„ç›‘å¬åˆ°äº†<code>testFunc:</code>æ–¹æ³•çš„å“åº”äº†ã€‚æ˜¯ä¸æ˜¯å¾ˆæ£’ğŸ˜Š<br></p>        <h5 id="2ï¼ŒUIButtonçš„å“åº”äº‹ä»¶ç›‘å¬"   >          <a href="#2ï¼ŒUIButtonçš„å“åº”äº‹ä»¶ç›‘å¬" class="heading-link"><i class="fas fa-link"></i></a>2ï¼ŒUIButtonçš„å“åº”äº‹ä»¶ç›‘å¬</h5>      <p>é€šå¸¸æˆ‘ä»¬æƒ³ç»™ä¸€ä¸ªUIButtonæ·»åŠ ç‚¹å‡»äº‹ä»¶æ—¶ï¼Œå¯èƒ½ä¼šè¿™ä¹ˆå†™ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.signInBtn];</span><br><span class="line">    [<span class="keyword">self</span>.signInBtn addTarget:<span class="keyword">self</span> action:<span class="keyword">@selector</span>(signInBtnEvent:) forControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)signInBtnEvent:(<span class="built_in">UIButton</span> *)sender &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIButton</span> *)signInBtn &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_signInBtn) &#123;</span><br><span class="line">        _signInBtn = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">        _signInBtn.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">        _signInBtn.backgroundColor = [<span class="built_in">UIColor</span> orangeColor];</span><br><span class="line">        [_signInBtn setTitle:<span class="string">@&quot;ç™»å½•&quot;</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _signInBtn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>é¦–å…ˆï¼Œè¿™ä¹ˆå†™å½“ç„¶æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚<br><br>é‚£ä¹ˆï¼Œè¿˜æœ‰ä»€ä¹ˆå¯çœ‹çš„å‘¢ï¼Œracèƒ½æœ‰ä»€ä¹ˆç‹¬ç‰¹çš„åœ°æ–¹ï¼Ÿ<br><br>æˆ‘ä»¬å¸¦ç€ç–‘é—®ï¼Œæ¥çœ‹ä¸€ä¸‹racä¸­çš„å†™æ³•:<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.signInBtn];</span><br><span class="line">    </span><br><span class="line">    RACSignal *signal = [<span class="keyword">self</span>.signInBtn rac_signalForControlEvents:<span class="built_in">UIControlEventTouchUpInside</span>];</span><br><span class="line">    [signal subscribeNext:^(<span class="keyword">id</span>  _Nullable x) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,x);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIButton</span> *)signInBtn &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_signInBtn) &#123;</span><br><span class="line">        _signInBtn = [<span class="built_in">UIButton</span> buttonWithType:<span class="built_in">UIButtonTypeCustom</span>];</span><br><span class="line">        _signInBtn.frame = <span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>);</span><br><span class="line">        _signInBtn.backgroundColor = [<span class="built_in">UIColor</span> orangeColor];</span><br><span class="line">        [_signInBtn setTitle:<span class="string">@&quot;ç™»å½•&quot;</span> forState:<span class="built_in">UIControlStateNormal</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _signInBtn;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æ‰“å°å¦‚ä¸‹ï¼š<br></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OCTestDemo[37767:583939] &lt;UIButton: 0x7ff1fe4255d0; frame &#x3D; (100 100; 100 100); opaque &#x3D; NO; layer &#x3D; &lt;CALayer: 0x6000035eee20&gt;&gt;</span><br></pre></td></tr></table></div></figure><p>ç”±æ­¤ï¼Œæˆ‘ä»¬å‘ç°ï¼Œç›¸æ¯”äºä¼ ç»Ÿçš„<code>target-action</code>æ–¹å¼ï¼Œracä½¿ç”¨<code>block</code>çš„æ–¹å¼è®©ä»£ç æ›´å†…èšï¼Œé›†ä¸­åˆ°äº†ä¸€å¤„ï¼Œå¯¹äºä»£ç çš„ç»´æŠ¤å¯èƒ½ç›¸å¯¹æ›´ä¼˜ã€‚</p>        <h5 id="3ï¼ŒUITextFieldæ–‡æœ¬è¾“å…¥ç›‘å¬"   >          <a href="#3ï¼ŒUITextFieldæ–‡æœ¬è¾“å…¥ç›‘å¬" class="heading-link"><i class="fas fa-link"></i></a>3ï¼ŒUITextFieldæ–‡æœ¬è¾“å…¥ç›‘å¬</h5>      <p>è¾“å…¥æ¡†å¸¸ç”¨åœ¨è¡¨å•ç›¸å…³çš„é¡µé¢é‡Œã€‚æ¯”å¦‚åœ¨ç™»å½•é¡µé¢ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹è¾“å…¥æ¡†å½“å‰è¾“å…¥çš„å†…å®¹è¿›è¡ŒéªŒè¯ï¼Œæ¥é™åˆ¶æ‰‹æœºå·è¾“å…¥æ•°é‡ï¼ˆ11ä½ï¼‰ã€‚<br><br>é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šè¿™ä¹ˆå†™ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SFViewController</span> ()&lt;<span class="title">UITextFieldDelegate</span>&gt;</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UITextField</span> *phoneTextField;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SFViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.phoneTextField];</span><br><span class="line">    <span class="keyword">self</span>.phoneTextField.delegate = <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">BOOL</span>)textField:(<span class="built_in">UITextField</span> *)textField shouldChangeCharactersInRange:(<span class="built_in">NSRange</span>)range replacementString:(<span class="built_in">NSString</span> *)string &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *curString = [textField.text stringByReplacingCharactersInRange:range withString:string];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,curString);</span><br><span class="line">    <span class="keyword">if</span> (curString.length &gt; <span class="number">11</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UITextField</span> *)phoneTextField &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_phoneTextField) &#123;</span><br><span class="line">        _phoneTextField = [[<span class="built_in">UITextField</span> alloc]initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">200</span>, <span class="number">200</span>, <span class="number">40</span>)];</span><br><span class="line">        _phoneTextField.placeholder = <span class="string">@&quot;è¯·è¾“å…¥æ‰‹æœºå·&quot;</span>;</span><br><span class="line">        _phoneTextField.keyboardType = <span class="built_in">UIKeyboardTypePhonePad</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _phoneTextField;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><p>ä¹Ÿå°±æ˜¯é€šè¿‡ä»£ç†çš„æ–¹å¼ï¼Œæ¥è·å–è¾“å…¥æ¡†å½“å‰çš„å†…å®¹ï¼Œé€šè¿‡<code>length</code>æ¥åˆ¤æ–­æ‰‹æœºå·é•¿åº¦ï¼Œè¿›è¡Œé™åˆ¶è¾“å…¥ã€‚<br></p><p>é‚£ä¹ˆï¼Œæ¥çœ‹çœ‹åœ¨racä¸­ï¼Œæ˜¯æ€ä¹ˆå®ç°çš„ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SFViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UITextField</span> *phoneTextField;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SFViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.phoneTextField];</span><br><span class="line">    </span><br><span class="line">    RACSignal *signal = [<span class="keyword">self</span>.phoneTextField.rac_textSignal filter:^<span class="built_in">BOOL</span>(<span class="built_in">NSString</span> * _Nullable value) &#123;</span><br><span class="line">        <span class="keyword">if</span> (value.length &gt; <span class="number">11</span>) &#123;</span><br><span class="line">            <span class="keyword">self</span>.phoneTextField.text = [value substringToIndex:<span class="number">11</span>];</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;];</span><br><span class="line">    [signal subscribeNext:^(<span class="keyword">id</span>  _Nullable x) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,x);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UITextField</span> *)phoneTextField &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_phoneTextField) &#123;</span><br><span class="line">        _phoneTextField = [[<span class="built_in">UITextField</span> alloc]initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">10</span>, <span class="number">200</span>, <span class="number">200</span>, <span class="number">40</span>)];</span><br><span class="line">        _phoneTextField.placeholder = <span class="string">@&quot;è¯·è¾“å…¥æ‰‹æœºå·&quot;</span>;</span><br><span class="line">        _phoneTextField.keyboardType = <span class="built_in">UIKeyboardTypePhonePad</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _phoneTextField;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><p>åœ¨racä¸­ï¼Œé€šè¿‡ä¸€ä¸ª<code>rac_textSignal</code>ä¿¡å·é‡çš„æ–¹å¼ç›‘å¬è¾“å…¥æ¡†çš„å˜åŒ–ï¼ŒåŒæ—¶ä»¥blockçš„æ–¹å¼è¿”å›ç›‘å¬çš„å€¼ã€‚<br><br>å¯¹æ¯”ï¼Œä¼ ç»Ÿçš„ä»£ç†æ–¹å¼ï¼Œä»£ç æ›´å†…èšã€‚<br></p>        <h5 id="4ï¼Œé€šçŸ¥ä¸­å¿ƒæ¶ˆæ¯ç›‘å¬"   >          <a href="#4ï¼Œé€šçŸ¥ä¸­å¿ƒæ¶ˆæ¯ç›‘å¬" class="heading-link"><i class="fas fa-link"></i></a>4ï¼Œé€šçŸ¥ä¸­å¿ƒæ¶ˆæ¯ç›‘å¬</h5>      <p>å…³äº<code>é¡µé¢ä¼ å€¼æ–¹å¼</code>è¿™ä¸ªè¯é¢˜ï¼Œè®°å¾—ä»¥å‰åœ¨é¢è¯•ä¸­ä¹Ÿæœ‰è¢«é—®åˆ°è¿‡ğŸ˜‚<br><br>å¸¸ç”¨çš„æ–¹å¼ä¹Ÿå°±æ˜¯ï¼šæŒ‡é’ˆä¼ å€¼ã€ä»£ç†ã€blockã€é€šçŸ¥ä¸­å¿ƒâ€¦<br></p><p>å¯¹äº<code>é€šçŸ¥ä¸­å¿ƒ</code>ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šè¿™ä¹ˆå†™ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] addObserver:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(notifyEventOfChangeBackgroundColor:) name:<span class="string">@&quot;SF_NotifyKey_changeBackgroundColor&quot;</span> object:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)notifyEventOfChangeBackgroundColor:(<span class="built_in">NSNotification</span> *)sender &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">    <span class="built_in">NSDictionary</span> *userInfo = sender.userInfo;</span><br><span class="line">    <span class="built_in">UIColor</span> *color = userInfo[<span class="string">@&quot;color&quot;</span>];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = color;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿé€šçŸ¥</span></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:<span class="string">@&quot;SF_NotifyKey_changeBackgroundColor&quot;</span> object:<span class="literal">nil</span> userInfo:@&#123;<span class="string">@&quot;color&quot;</span>:[<span class="built_in">UIColor</span> redColor]&#125;];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    <span class="comment">// deallocæ—¶è¦ç§»é™¤é€šçŸ¥</span></span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] removeObserver:<span class="keyword">self</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>é‚£ä¹ˆï¼Œåœ¨racä¸­æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿ<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    RACSignal *signal = [[<span class="built_in">NSNotificationCenter</span> defaultCenter] rac_addObserverForName:<span class="string">@&quot;SF_NotifyKey_changeBackgroundColor&quot;</span> object:<span class="literal">nil</span>];</span><br><span class="line">    [signal subscribeNext:^(<span class="keyword">id</span>  _Nullable x) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;%@&quot;</span>,x);</span><br><span class="line">        <span class="built_in">NSNotification</span> *note = (<span class="built_in">NSNotification</span> *)x;</span><br><span class="line">        <span class="built_in">NSDictionary</span> *userInfo = note.userInfo;</span><br><span class="line">        <span class="built_in">UIColor</span> *color = [userInfo objectForKey:<span class="string">@&quot;color&quot;</span>];</span><br><span class="line">        <span class="keyword">self</span>.view.backgroundColor = color;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿé€šçŸ¥</span></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">    [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:<span class="string">@&quot;SF_NotifyKey_changeBackgroundColor&quot;</span> object:<span class="literal">nil</span> userInfo:@&#123;<span class="string">@&quot;color&quot;</span>:[<span class="built_in">UIColor</span> redColor]&#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>åŒæ ·çš„ï¼Œracç”¨blockçš„æ–¹å¼è®©ä»£ç æ›´å†…èšã€‚<br><br>åŒæ—¶ï¼Œæˆ‘ä»¬å‘ç°ï¼Œä¹Ÿä¸éœ€è¦åœ¨<code>dealloc</code>æ–¹æ³•ä¸­ï¼Œç§»é™¤å¯¹åº”çš„é€šçŸ¥äº†ã€‚<br><br>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿç‚¹å‡»<code>rac_addObserverForName:object:</code>æ¥çœ‹çœ‹å®ƒçš„å†…éƒ¨å®ç°ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (RACSignal *)rac_addObserverForName:(<span class="built_in">NSString</span> *)notificationName object:(<span class="keyword">id</span>)object &#123;</span><br><span class="line">@unsafeify(object);</span><br><span class="line"><span class="keyword">return</span> [[RACSignal createSignal:^(<span class="keyword">id</span>&lt;RACSubscriber&gt; subscriber) &#123;</span><br><span class="line">@strongify(object);</span><br><span class="line"><span class="keyword">id</span> observer = [<span class="keyword">self</span> addObserverForName:notificationName object:object queue:<span class="literal">nil</span> usingBlock:^(<span class="built_in">NSNotification</span> *note) &#123;</span><br><span class="line">[subscriber sendNext:note];</span><br><span class="line">&#125;];</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> [RACDisposable disposableWithBlock:^&#123;</span><br><span class="line">[<span class="keyword">self</span> removeObserver:observer];</span><br><span class="line">&#125;];</span><br><span class="line">&#125;] setNameWithFormat:<span class="string">@&quot;-rac_addObserverForName: %@ object: &lt;%@: %p&gt;&quot;</span>, notificationName, [object <span class="keyword">class</span>], object];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>å…³é”®ä»£ç ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> [RACDisposable disposableWithBlock:^&#123;</span><br><span class="line">[<span class="keyword">self</span> removeObserver:observer];</span><br><span class="line">&#125;];</span><br></pre></td></tr></table></div></figure><p>å³ï¼Œåœ¨ä¿¡å·é‡é”€æ¯æ—¶ï¼Œä¼šå°†é€šçŸ¥ç§»é™¤ã€‚<br></p>        <h5 id="5ï¼Œä»£æ›¿KVO"   >          <a href="#5ï¼Œä»£æ›¿KVO" class="heading-link"><i class="fas fa-link"></i></a>5ï¼Œä»£æ›¿KVO</h5>      <p>æˆ‘ä»¬çŸ¥é“ï¼ŒKVOå®è´¨ä¸Šæ˜¯åˆ©ç”¨äº†RunTimeæŠ€æœ¯ï¼Œåœ¨è¿è¡Œæ—¶ä¼šåŠ¨æ€çš„åˆ›å»ºä¸€ä¸ªå½“å‰å¯¹è±¡å¯¹åº”ç±»çš„å­ç±»ï¼Œé€šè¿‡é‡å†™å±æ€§çš„setteræ–¹æ³•æ¥é—´æ¥å®ç°å±æ€§ç›‘å¬ã€‚<br><br>é€šå¸¸ï¼Œæˆ‘ä»¬ä¼šè¿™ä¹ˆå†™KVOï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SFViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *testView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SFViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.testView];</span><br><span class="line">    [<span class="keyword">self</span>.testView addObserver:<span class="keyword">self</span> forKeyPath:<span class="string">@&quot;backgroundColor&quot;</span> options:(<span class="built_in">NSKeyValueObservingOptionNew</span>|<span class="built_in">NSKeyValueObservingOptionOld</span>) context:<span class="literal">NULL</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)observeValueForKeyPath:(<span class="built_in">NSString</span> *)keyPath ofObject:(<span class="keyword">id</span>)object change:(<span class="built_in">NSDictionary</span>&lt;<span class="built_in">NSKeyValueChangeKey</span>,<span class="keyword">id</span>&gt; *)change context:(<span class="keyword">void</span> *)context &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;keyPath=%@&quot;</span>,keyPath);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;object=%@&quot;</span>,object);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;change=%@&quot;</span>,change);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;context=%@&quot;</span>,context);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿ</span></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">    <span class="keyword">self</span>.testView.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIView</span> *)testView &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_testView) &#123;</span><br><span class="line">        _testView = [[<span class="built_in">UIView</span> alloc]initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">        _testView.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _testView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><p>åœ¨racä¸­ï¼ŒKVOçš„å®ç°æ–¹å¼å¦‚ä¸‹ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SFViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span> *testView;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SFViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:<span class="keyword">self</span>.testView];</span><br><span class="line">    <span class="comment">// æ–¹å¼ä¸€</span></span><br><span class="line">    [<span class="keyword">self</span>.testView rac_observeKeyPath:<span class="string">@&quot;backgroundColor&quot;</span> options:(<span class="built_in">NSKeyValueObservingOptionNew</span>|<span class="built_in">NSKeyValueObservingOptionOld</span>) observer:<span class="keyword">self</span> block:^(<span class="keyword">id</span> value, <span class="built_in">NSDictionary</span> *change, <span class="built_in">BOOL</span> causedByDealloc, <span class="built_in">BOOL</span> affectedOnlyLastComponent) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;value=%@&quot;</span>,value);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;change=%@&quot;</span>,change);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;causedByDealloc=%d&quot;</span>,causedByDealloc);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;affectedOnlyLastComponent=%d&quot;</span>,affectedOnlyLastComponent);</span><br><span class="line">    &#125;];</span><br><span class="line"><span class="comment">//    // æ–¹å¼äºŒ</span></span><br><span class="line"><span class="comment">//    [RACObserve(self.testView, backgroundColor) subscribeNext:^(id  _Nullable x) &#123;</span></span><br><span class="line"><span class="comment">//        NSLog(@&quot;%@&quot;,x);</span></span><br><span class="line"><span class="comment">//    &#125;];</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿ</span></span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">    <span class="keyword">self</span>.testView.backgroundColor = [<span class="built_in">UIColor</span> redColor];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="built_in">UIView</span> *)testView &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_testView) &#123;</span><br><span class="line">        _testView = [[<span class="built_in">UIView</span> alloc]initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">100</span>)];</span><br><span class="line">        _testView.backgroundColor = [<span class="built_in">UIColor</span> blackColor];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _testView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š<br><br>åŒºåˆ«ï¼š<br></p><ul><li>ä¼ ç»Ÿå†™æ³•çš„KVOï¼Œåªæœ‰åœ¨å±æ€§å€¼æœ‰æ”¹å˜æ—¶æ‰ä¼šè§¦å‘KVOï¼›</li><li>racçš„KVOï¼Œæ˜¯åœ¨ä¸€å¼€å§‹å°±ä¼šè§¦å‘KVOï¼›</li></ul>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/rac-1-%E5%9F%BA%E7%A1%80%E5%85%A5%E9%97%A8/RAC.jpg&quot; class=&quot;&quot;&gt;

&lt;blockquote&gt;
&lt;p&gt;å…³é”®è¯ï¼šrac&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="RAC" scheme="https://jack110530.github.io/categories/RAC/"/>
    
    
    <category term="rac" scheme="https://jack110530.github.io/tags/rac/"/>
    
  </entry>
  
  <entry>
    <title>GitæŠ¥é”™-refusing to merge unrelated histories</title>
    <link href="https://jack110530.github.io/git%E6%8A%A5%E9%94%99-refusing-to-merge-unrelated-histories/"/>
    <id>https://jack110530.github.io/git%E6%8A%A5%E9%94%99-refusing-to-merge-unrelated-histories/</id>
    <published>2020-11-06T01:47:43.000Z</published>
    <updated>2020-11-06T02:15:34.282Z</updated>
    
    <content type="html"><![CDATA[<img src="/git%E6%8A%A5%E9%94%99-refusing-to-merge-unrelated-histories/git.png" class=""><br><blockquote><p>å…³é”®è¯ï¼šGitã€pullã€pushã€fetchã€merge</p></blockquote><a id="more"></a>        <h3 id="é—®é¢˜"   >          <a href="#é—®é¢˜" class="heading-link"><i class="fas fa-link"></i></a>é—®é¢˜</h3>      <p>1ã€æœ¬åœ°æœ‰ä¸€ä¸ªgitä»“åº“ï¼Œå¼€å‘å¾ˆé•¿æ—¶é—´äº†ï¼Œä¸€ç›´ä¹Ÿéƒ½æœ‰addã€commitï¼Œä½†æ˜¯å§‹ç»ˆæ²¡æœ‰æ¨é€åˆ°è¿œç«¯ä»“åº“è¿‡ï¼›<br><br>å› ä¸ºæœ€å¼€å§‹åªæ˜¯æˆ‘è‡ªå·±ä¸€ä¸ªäººå¼€å‘ï¼Œæ‰€ä»¥æœ¬åœ°è¿™ä»“åº“å¹¶ä¸æ˜¯ä»è¿œç«¯ä»“åº“<code>git clone</code>è¿‡æ¥çš„ï¼Œè€Œæ˜¯ç›´æ¥åœ¨æœ¬åœ°<code>git init</code>ï¼Œä¸€ç›´åœ¨æœ¬åœ°ç®¡ç†çš„ã€‚<br><br>2ã€ç°åœ¨éœ€è¦å°†ä»£ç æ¨é€è¿œç«¯ä»“åº“ï¼Œå’Œåˆ«äººåä½œå¼€å‘ã€‚<br><br>3ã€å…ˆæ–°å»ºä¸ªè¿œç«¯ä»“åº“</p><img src="/git%E6%8A%A5%E9%94%99-refusing-to-merge-unrelated-histories/init.png" class=""><br><p>4ã€ç„¶åæœ¬åœ°ä»“åº“æ·»åŠ githubä¸Šçš„gitä»“åº“ä½œä¸ºè¿œç¨‹ä»“åº“ï¼Œèµ·åoriginï¼›</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin https:&#x2F;&#x2F;github.com&#x2F;XXXXXXX&#x2F;XXXXXX</span><br></pre></td></tr></table></div></figure><p>5ã€é—®é¢˜æ¥äº†ï¼Œæœ¬åœ°ä»“åº“åœ¨æƒ³åšåŒæ­¥è¿œç¨‹ä»“åº“åˆ°æœ¬åœ°ä¸ºä¹‹åæœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“åšå‡†å¤‡æ—¶æŠ¥é”™äº†ï¼Œé”™è¯¯å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fatal: refusing to merge unrelated histories</span><br><span class="line">ï¼ˆæ‹’ç»åˆå¹¶ä¸ç›¸å…³çš„å†å²ï¼‰</span><br></pre></td></tr></table></div></figure>        <h3 id="è§£å†³"   >          <a href="#è§£å†³" class="heading-link"><i class="fas fa-link"></i></a>è§£å†³</h3>      <p>å‡ºç°è¿™ä¸ªé—®é¢˜çš„æœ€ä¸»è¦åŸå› è¿˜æ˜¯åœ¨äºæœ¬åœ°ä»“åº“å’Œè¿œç¨‹ä»“åº“å®é™…ä¸Šæ˜¯ç‹¬ç«‹çš„ä¸¤ä¸ªä»“åº“ã€‚å‡å¦‚æˆ‘ä¹‹å‰æ˜¯ç›´æ¥cloneçš„æ–¹å¼åœ¨æœ¬åœ°å»ºç«‹èµ·è¿œç¨‹githubä»“åº“çš„å…‹éš†æœ¬åœ°ä»“åº“å°±ä¸ä¼šæœ‰è¿™é—®é¢˜äº†ã€‚<br></p><p>æŸ¥é˜…äº†ä¸€ä¸‹èµ„æ–™ï¼Œå‘ç°å¯ä»¥åœ¨pullå‘½ä»¤åç´§æ¥ç€ä½¿ç”¨<code>--allow-unrelated-history</code>é€‰é¡¹æ¥è§£å†³é—®é¢˜ï¼ˆè¯¥é€‰é¡¹å¯ä»¥åˆå¹¶ä¸¤ä¸ªç‹¬ç«‹å¯åŠ¨ä»“åº“çš„å†å²ï¼‰ã€‚</p><p>å‘½ä»¤ï¼š<br></p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$git pull origin master --allow-unrelated-histories</span><br></pre></td></tr></table></div></figure><p>ä»¥ä¸Šæ˜¯å°†è¿œç¨‹ä»“åº“çš„æ–‡ä»¶æ‹‰å–åˆ°æœ¬åœ°ä»“åº“äº†ã€‚<br><br>ç´§æ¥ç€å°†æœ¬åœ°ä»“åº“çš„æäº¤æ¨é€åˆ°è¿œç¨‹githubä»“åº“ä¸Šï¼Œä½¿ç”¨çš„å‘½ä»¤æ˜¯ï¼š&lt;&gt;</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git push &lt;è¿œç¨‹ä¸»æœºå&gt; &lt;æœ¬åœ°åˆ†æ”¯å&gt;:&lt;è¿œç¨‹åˆ†æ”¯å&gt;</span><br><span class="line">ä¹Ÿå°±æ˜¯</span><br><span class="line">$git push origin master:master</span><br><span class="line">æäº¤æˆåŠŸã€‚</span><br></pre></td></tr></table></div></figure>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/git%E6%8A%A5%E9%94%99-refusing-to-merge-unrelated-histories/git.png&quot; class=&quot;&quot;&gt;&lt;br&gt;

&lt;blockquote&gt;
&lt;p&gt;å…³é”®è¯ï¼šGitã€pullã€pushã€fetchã€merge&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç¬”è®°" scheme="https://jack110530.github.io/categories/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="Git" scheme="https://jack110530.github.io/categories/%E7%AC%94%E8%AE%B0/Git/"/>
    
    
    <category term="git" scheme="https://jack110530.github.io/tags/git/"/>
    
    <category term="error" scheme="https://jack110530.github.io/tags/error/"/>
    
  </entry>
  
  <entry>
    <title>ç¬”è®°ï¼šè®¾å¤‡æ—‹è½¬ååˆ·æ–°UICollectionViewå¸ƒå±€</title>
    <link href="https://jack110530.github.io/%E7%AC%94%E8%AE%B0%EF%BC%9A%E8%AE%BE%E5%A4%87%E6%97%8B%E8%BD%AC%E5%90%8E%E5%88%B7%E6%96%B0uicollectionview%E5%B8%83%E5%B1%80/"/>
    <id>https://jack110530.github.io/%E7%AC%94%E8%AE%B0%EF%BC%9A%E8%AE%BE%E5%A4%87%E6%97%8B%E8%BD%AC%E5%90%8E%E5%88%B7%E6%96%B0uicollectionview%E5%B8%83%E5%B1%80/</id>
    <published>2020-11-04T03:05:08.000Z</published>
    <updated>2020-11-04T03:52:40.382Z</updated>
    
    <content type="html"><![CDATA[<img src="/%E7%AC%94%E8%AE%B0%EF%BC%9A%E8%AE%BE%E5%A4%87%E6%97%8B%E8%BD%AC%E5%90%8E%E5%88%B7%E6%96%B0uicollectionview%E5%B8%83%E5%B1%80/%E7%AC%94%E8%AE%B0iOS.jpg" class=""><br><p>æœ€è¿‘åœ¨å¼€å‘iPadé¡¹ç›®æ—¶é‡åˆ°ä¸ªé—®é¢˜ï¼š<br><br>å±å¹•æ—‹è½¬æ—¶ï¼ŒUICollectionViewä¸ä¼šè‡ªåŠ¨åˆ·æ–°å¸ƒå±€ï¼Œcellçš„å¤§å°ä¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼Ÿï¼Ÿ<br></p><a id="more"></a><br><p>å¦‚ï¼š<br><br>1ã€å½“ä¸€å¼€å§‹è¿›æ¥æ˜¯ç«–å±æ—¶ï¼š<br></p><img src="/%E7%AC%94%E8%AE%B0%EF%BC%9A%E8%AE%BE%E5%A4%87%E6%97%8B%E8%BD%AC%E5%90%8E%E5%88%B7%E6%96%B0uicollectionview%E5%B8%83%E5%B1%80/test1.png" class=""><br><p>æ—‹è½¬åˆ°æ¨ªå±åï¼š<br></p><img src="/%E7%AC%94%E8%AE%B0%EF%BC%9A%E8%AE%BE%E5%A4%87%E6%97%8B%E8%BD%AC%E5%90%8E%E5%88%B7%E6%96%B0uicollectionview%E5%B8%83%E5%B1%80/test2.png" class=""><br><p>ä¸¤è¾¹æœ‰ç•™ç™½ï¼Œcellæ²¡æœ‰è‡ªé€‚åº”åˆ°å±å¹•å®½åº¦ï¼›<br></p><p>2ã€å½“ä¸€å¼€å§‹è¿›æ¥æ˜¯æ¨ªå±æ—¶ï¼š<br></p><img src="/%E7%AC%94%E8%AE%B0%EF%BC%9A%E8%AE%BE%E5%A4%87%E6%97%8B%E8%BD%AC%E5%90%8E%E5%88%B7%E6%96%B0uicollectionview%E5%B8%83%E5%B1%80/test3.png" class=""><br><p>æ—‹è½¬åˆ°ç«–å±åï¼š<br></p><img src="/%E7%AC%94%E8%AE%B0%EF%BC%9A%E8%AE%BE%E5%A4%87%E6%97%8B%E8%BD%AC%E5%90%8E%E5%88%B7%E6%96%B0uicollectionview%E5%B8%83%E5%B1%80/test4.png" class=""><br><p>cellçš„å®½åº¦è¿˜æ˜¯æ¨ªå±æ—¶çš„å®½åº¦ï¼ï¼›<br></p><blockquote><p>æ€ä¹ˆè§£å†³ï¼Ÿ</p></blockquote><p>ç½‘ä¸Šä¹Ÿæœ‰äº›è§£å†³åŠæ³•ï¼Œå¦‚ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€ç§ï¼Œé‡å†™viewWillLayoutSubviewsæ–¹æ³•</span></span><br><span class="line">- (<span class="keyword">void</span>)viewWillLayoutSubviews &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewWillLayoutSubviews];</span><br><span class="line">    [<span class="keyword">self</span>.collectionView.collectionViewLayout invalidateLayout];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒç§ï¼Œé‡å†™viewWillTransitionToSizeæ–¹æ³•</span></span><br><span class="line">- (<span class="keyword">void</span>)viewWillTransitionToSize:(<span class="built_in">CGSize</span>)size withTransitionCoordinator:(<span class="keyword">id</span>&lt;<span class="built_in">UIViewControllerTransitionCoordinator</span>&gt;)coordinator &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewWillTransitionToSize:size withTransitionCoordinator:coordinator];</span><br><span class="line"></span><br><span class="line">    [<span class="keyword">self</span>.collectionView.collectionViewLayout invalidateLayout]; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>è¿™é‡Œåšäº›è¡¥å……ï¼š<br><br>1ã€å¦‚æœä½ æ˜¯åœ¨UICollectionViewåˆå§‹åŒ–æ—¶ï¼Œç»™å®šitemSizeï¼Œé‚£ä¹ˆä¸ç®¡ä½ ç”¨ä»¥ä¸Šé‚£ç§æ–¹æ³•éƒ½æ˜¯æ— æ•ˆçš„ã€‚<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">layout.itemSize = <span class="built_in">CGSizeMake</span>([<span class="built_in">UIScreen</span> mainScreen].bounds.size.width, <span class="number">200</span>);</span><br><span class="line">_collectionView = [[<span class="built_in">UICollectionView</span> alloc]initWithFrame:<span class="built_in">CGRectZero</span> collectionViewLayout:layout];</span><br></pre></td></tr></table></div></figure><p>å› ä¸ºä½ æŠŠlayoutçš„itemSizeå†™æ­»äº†ã€‚</p><p>æ‰€ä»¥ï¼Œæœ€å¥½æ˜¯åœ¨sizeForItemAtIndexPathçš„ä»£ç†æ–¹æ³•ä¸­å®šä¹‰ï¼Œå¦‚ï¼š</p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">CGSize</span>)collectionView:(<span class="built_in">UICollectionView</span> *)collectionView layout:(<span class="built_in">UICollectionViewLayout</span> *)collectionViewLayout sizeForItemAtIndexPath:(<span class="built_in">NSIndexPath</span> *)indexPath &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">CGSizeMake</span>(collectionView.bounds.size.width, <span class="number">200</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>2ã€ç»è¿‡æµ‹è¯•ï¼Œåœ¨iPhoneä¸­ï¼Œæ˜¯ä¸éœ€è¦é¢å¤–å†™è¿™äº›ä»£ç çš„ï¼Œè‡ªåŠ¨å›æ›´æ–°å¸ƒå±€ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/%E7%AC%94%E8%AE%B0%EF%BC%9A%E8%AE%BE%E5%A4%87%E6%97%8B%E8%BD%AC%E5%90%8E%E5%88%B7%E6%96%B0uicollectionview%E5%B8%83%E5%B1%80/%E7%AC%94%E8%AE%B0iOS.jpg&quot; class=&quot;&quot;&gt;&lt;br&gt;

&lt;p&gt;æœ€è¿‘åœ¨å¼€å‘iPadé¡¹ç›®æ—¶é‡åˆ°ä¸ªé—®é¢˜ï¼š&lt;br&gt;&lt;br&gt;å±å¹•æ—‹è½¬æ—¶ï¼ŒUICollectionViewä¸ä¼šè‡ªåŠ¨åˆ·æ–°å¸ƒå±€ï¼Œcellçš„å¤§å°ä¸ä¼šè‡ªåŠ¨æ›´æ–°ï¼Ÿï¼Ÿ&lt;br&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="ç¬”è®°" scheme="https://jack110530.github.io/categories/%E7%AC%94%E8%AE%B0/"/>
    
    <category term="iOS" scheme="https://jack110530.github.io/categories/%E7%AC%94%E8%AE%B0/iOS/"/>
    
    
    <category term="iPad" scheme="https://jack110530.github.io/tags/iPad/"/>
    
    <category term="UICollectionView" scheme="https://jack110530.github.io/tags/UICollectionView/"/>
    
  </entry>
  
  <entry>
    <title>isKindOfClassä¸isMemberOfClassçš„åŒºåˆ«</title>
    <link href="https://jack110530.github.io/iskindofclass%E4%B8%8Eismemberofclass%E7%9A%84%E5%8C%BA%E5%88%AB/"/>
    <id>https://jack110530.github.io/iskindofclass%E4%B8%8Eismemberofclass%E7%9A%84%E5%8C%BA%E5%88%AB/</id>
    <published>2020-11-03T02:27:52.000Z</published>
    <updated>2020-11-03T02:48:50.608Z</updated>
    
    <content type="html"><![CDATA[<img src="/iskindofclass%E4%B8%8Eismemberofclass%E7%9A%84%E5%8C%BA%E5%88%AB/%E9%87%8D%E6%8B%BEiOS.jpg" class=""><blockquote><p>å…³é”®è¯ï¼šisaã€superclassã€ç±»ç°‡</p></blockquote><a id="more"></a>        <h3 id="ä¸€ã€isKindOfClassä¸isMemberOfClassçš„åŒºåˆ«"   >          <a href="#ä¸€ã€isKindOfClassä¸isMemberOfClassçš„åŒºåˆ«" class="heading-link"><i class="fas fa-link"></i></a>ä¸€ã€isKindOfClassä¸isMemberOfClassçš„åŒºåˆ«</h3>      <p>ä»¥ä¸‹ä»£ç çš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆï¼Ÿ<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç¬¬ä¸€ç»„</span></span><br><span class="line"><span class="built_in">BOOL</span> re1 = [(<span class="keyword">id</span>)[<span class="built_in">NSObject</span> <span class="keyword">class</span>] isKindOfClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]];</span><br><span class="line"><span class="built_in">BOOL</span> re2 = [(<span class="keyword">id</span>)[<span class="built_in">NSObject</span> <span class="keyword">class</span>] isMemberOfClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]];</span><br><span class="line"><span class="built_in">BOOL</span> re3 = [(<span class="keyword">id</span>)[SFPerson <span class="keyword">class</span>] isKindOfClass:[SFPerson <span class="keyword">class</span>]];</span><br><span class="line"><span class="built_in">BOOL</span> re4 = [(<span class="keyword">id</span>)[SFPerson <span class="keyword">class</span>] isMemberOfClass:[SFPerson <span class="keyword">class</span>]];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%hhd%hhd%hhd%hhd&quot;</span>,re1,re2,re3,re4);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒç»„</span></span><br><span class="line"><span class="built_in">BOOL</span> re5 = [(<span class="keyword">id</span>)[<span class="built_in">NSObject</span> alloc] isKindOfClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]];</span><br><span class="line"><span class="built_in">BOOL</span> re6 = [(<span class="keyword">id</span>)[<span class="built_in">NSObject</span> alloc] isMemberOfClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]];</span><br><span class="line"><span class="built_in">BOOL</span> re7 = [(<span class="keyword">id</span>)[SFPerson alloc] isKindOfClass:[SFPerson <span class="keyword">class</span>]];</span><br><span class="line"><span class="built_in">BOOL</span> re8 = [(<span class="keyword">id</span>)[SFPerson alloc] isMemberOfClass:[SFPerson <span class="keyword">class</span>]];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%hhd%hhd%hhd%hhd&quot;</span>,re5,re6,re7,re8);</span><br></pre></td></tr></table></div></figure><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¾“å‡ºï¼š<span class="number">1000</span>ï¼Œ<span class="number">1111</span>&lt;br&gt;</span><br></pre></td></tr></table></div></figure><blockquote><p>ä¸ºä»€ä¹ˆï¼Ÿ</p></blockquote><p>1ã€é¦–å…ˆè¦çŸ¥é“isKindOfClass ä¸ isMemberOfClass çš„åŒºåˆ«ï¼š<br></p><ul><li>isKindOfClassæ¥ç¡®å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ªç±»çš„æˆå‘˜ï¼Œæˆ–è€…æ˜¯æ´¾ç”Ÿè‡ªè¯¥ç±»çš„æˆå‘˜ï¼›</li><li>isMemberOfClassåªèƒ½ç¡®å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯å½“å‰ç±»çš„æˆå‘˜ï¼›</li></ul><p>isKindOfClassçš„å®ç°ä»£ç å¤§è‡´å¦‚ä¸‹ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”±isaæŒ‡é’ˆæ‰¾åˆ°è¯¥å¯¹è±¡æ‰€åœ¨å½“å‰ç±»ï¼Œåˆ¤æ–­aClassæ˜¯å¦ä¸ºå½“å‰ç±»ï¼Œè‹¥ä¸æ˜¯åˆ™é€šè¿‡superclassæŒ‡é’ˆè·å–åˆ°å…¶çˆ¶ç±»è¿›è¡Œæ¯”è¾ƒ</span></span><br><span class="line">-(<span class="built_in">BOOL</span>)isKindOfClass:(Class)aClass &#123;</span><br><span class="line">    <span class="keyword">for</span> (Class tcls = isa; tcls; tcls-&gt; superclass) &#123;</span><br><span class="line">        <span class="keyword">if</span> (tcls == aClass) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>isMemberOfClassçš„å®ç°ä»£ç å¤§è‡´å¦‚ä¸‹ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç”±isaæŒ‡é’ˆæ‰¾åˆ°è¯¥å¯¹è±¡æ‰€åœ¨å½“å‰ç±»ï¼Œç›´æ¥æ¯”è¾ƒaClassæ˜¯å¦ä¸ºå½“å‰ç±»</span></span><br><span class="line">-(<span class="built_in">BOOL</span>)isMemberOfClass:(Class)aClass &#123;</span><br><span class="line">    <span class="keyword">return</span> isa == aClass;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>2ã€å†è€…è¦äº†è§£å®ä¾‹å¯¹è±¡ã€ç±»å¯¹è±¡å’Œå…ƒç±»å¯¹è±¡ä¹‹é—´çš„å…³ç³»ï¼š<br></p><img src="/iskindofclass%E4%B8%8Eismemberofclass%E7%9A%84%E5%8C%BA%E5%88%AB/isa.png" class=""><br><p>ç”±å›¾å¯çŸ¥ï¼š<br></p><p>isaæŒ‡é’ˆï¼š<br></p><ul><li>å®ä¾‹å¯¹è±¡çš„isaæŒ‡å‘ç±»å¯¹è±¡ï¼›</li><li>ç±»å¯¹è±¡çš„isaæŒ‡å‘å…ƒç±»å¯¹è±¡ï¼›</li><li>å…ƒç±»å¯¹è±¡çš„isaæŒ‡å‘åŸºç±»çš„å…ƒç±»å¯¹è±¡ï¼›</li><li>åŸºç±»å…ƒç±»å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘å®ƒè‡ªå·±ï¼›</li></ul><p>superclassæŒ‡é’ˆï¼š<br></p><ul><li>ç±»å¯¹è±¡çš„superclassæŒ‡å‘å…¶çˆ¶ç±»ç±»å¯¹è±¡ï¼›</li><li>å¦‚æœæ²¡æœ‰çˆ¶ç±»ï¼ŒsuperclassæŒ‡é’ˆä¸ºnilï¼›</li><li>å…ƒç±»å¯¹è±¡çš„superclassæŒ‡å‘å…¶çˆ¶ç±»å…ƒç±»å¯¹è±¡ï¼›</li><li>åŸºç±»çš„å…ƒç±»å¯¹è±¡çš„superclassæŒ‡å‘åŸºç±»çš„ç±»å¯¹è±¡ï¼›</li></ul><p>äº†è§£äº†è¿™äº›ï¼Œå›è¿‡å¤´æ¥çœ‹è¿™é“é¢˜ï¼Œæ˜¯ä¸æ˜¯å°±æ˜ç™½äº†ã€‚</p>        <h3 id="äºŒ-ç±»ç°‡"   >          <a href="#äºŒ-ç±»ç°‡" class="heading-link"><i class="fas fa-link"></i></a>äºŒ.  ç±»ç°‡</h3>      <p>ä»¥ä¸‹ä»£ç çš„è¾“å‡ºç»“æœæ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆï¼Ÿ</p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSArray</span> *arr = [<span class="built_in">NSArray</span> array];</span><br><span class="line"><span class="built_in">NSArray</span> *mtArr = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line"> </span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%d&quot;</span>, [arr isKindOfClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]]);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%d&quot;</span>, [arr isMemberOfClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]]);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%d&quot;</span>, [mtArr isKindOfClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]]);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%d&quot;</span>, [mtArr isMemberOfClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]]);</span><br><span class="line">    </span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%d&quot;</span>, [arr isKindOfClass:[<span class="built_in">NSArray</span> <span class="keyword">class</span>]]);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%d&quot;</span>, [arr isMemberOfClass:[<span class="built_in">NSArray</span> <span class="keyword">class</span>]]);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%d&quot;</span>, [mtArr isKindOfClass:[<span class="built_in">NSArray</span> <span class="keyword">class</span>]]);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%d&quot;</span>, [mtArr isMemberOfClass:[<span class="built_in">NSArray</span> <span class="keyword">class</span>]]);</span><br><span class="line">    </span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%d&quot;</span>, [mtArr isKindOfClass:[arr <span class="keyword">class</span>]]);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%d&quot;</span>, [mtArr isMemberOfClass:[arr <span class="keyword">class</span>]]); </span><br></pre></td></tr></table></div></figure><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">è¾“å‡ºï¼š<span class="number">1010101000</span></span><br></pre></td></tr></table></div></figure><p>ä½ å¯èƒ½ä¼šå¯¹ä»¥ä¸‹è¾“å‡ºäº§ç”Ÿç–‘é—®ğŸ¤”ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%d&quot;</span>, [arr isMemberOfClass:[<span class="built_in">NSArray</span> <span class="keyword">class</span>]]); </span><br><span class="line"><span class="comment">// è¾“å‡º0</span></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%d&quot;</span>, [mtArr isKindOfClass:[arr <span class="keyword">class</span>]]);</span><br><span class="line"><span class="comment">// è¾“å‡º0</span></span><br></pre></td></tr></table></div></figure><p>åŸå› åœ¨äºNSArrayæ˜¯ä¸€ä¸ªç±»ç°‡ï¼Œæ„å‘³ç€æ¯ä¸ªNSArrayçš„å®ä¾‹éƒ½æ˜¯NSArrayå†…éƒ¨å­ç±»çš„ä¸€ä¸ªå®ä¾‹ï¼Œæˆ‘ä»¬ä¼šå‘ç°[[NSArray array] class]è¿”å›å€¼ä¸º__NSArray0,[[NSMutableArray array] class]è¿”å›å€¼ä¸º__NSArrayM, è€Œ[NSArray class]è¿”å›å€¼ä¸ºNSArrayï¼Œæ‰€ä»¥äºŒè€…ä¸ç­‰ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/iskindofclass%E4%B8%8Eismemberofclass%E7%9A%84%E5%8C%BA%E5%88%AB/%E9%87%8D%E6%8B%BEiOS.jpg&quot; class=&quot;&quot;&gt;

&lt;blockquote&gt;
&lt;p&gt;å…³é”®è¯ï¼šisaã€superclassã€ç±»ç°‡&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="é‡æ‹¾iOS" scheme="https://jack110530.github.io/categories/%E9%87%8D%E6%8B%BEiOS/"/>
    
    
    <category term="ç±»ç°‡" scheme="https://jack110530.github.io/tags/%E7%B1%BB%E7%B0%87/"/>
    
    <category term="isa" scheme="https://jack110530.github.io/tags/isa/"/>
    
    <category term="superclass" scheme="https://jack110530.github.io/tags/superclass/"/>
    
  </entry>
  
  <entry>
    <title>iOSé¢è¯•é¢˜(1)</title>
    <link href="https://jack110530.github.io/ios%E9%9D%A2%E8%AF%95%E9%A2%98-1/"/>
    <id>https://jack110530.github.io/ios%E9%9D%A2%E8%AF%95%E9%A2%98-1/</id>
    <published>2020-10-29T04:08:20.000Z</published>
    <updated>2020-10-30T01:05:09.740Z</updated>
    
    <content type="html"><![CDATA[<img src="/ios%E9%9D%A2%E8%AF%95%E9%A2%98-1/iOS%E9%9D%A2%E8%AF%95%E9%A2%98.jpg" class=""><br><a id="more"></a>        <h3 id="weakå’Œassignçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™æƒ…å†µä¸‹ä½¿ç”¨weakï¼Ÿ"   >          <a href="#weakå’Œassignçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™æƒ…å†µä¸‹ä½¿ç”¨weakï¼Ÿ" class="heading-link"><i class="fas fa-link"></i></a>weakå’Œassignçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™æƒ…å†µä¸‹ä½¿ç”¨weakï¼Ÿ</h3>      <blockquote><p>å…³é”®è¯ï¼šweakã€assignã€æ‚¬ç©ºæŒ‡é’ˆã€é‡æŒ‡é’ˆ</p></blockquote><hr>        <h3 id="ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨copyä¿®é¥°å±æ€§ï¼Ÿ"   >          <a href="#ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨copyä¿®é¥°å±æ€§ï¼Ÿ" class="heading-link"><i class="fas fa-link"></i></a>ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨copyä¿®é¥°å±æ€§ï¼Ÿ</h3>      <blockquote><p>å…³é”®è¯ï¼šcopyã€å°è£…æ€§ã€å †æ ˆ</p></blockquote><hr>        <h3 id="æ·±æ‹·è´ä¸æµ…æ‹·è´"   >          <a href="#æ·±æ‹·è´ä¸æµ…æ‹·è´" class="heading-link"><i class="fas fa-link"></i></a>æ·±æ‹·è´ä¸æµ…æ‹·è´</h3>      <blockquote><p>å…³é”®è¯ï¼šæ·±æ‹·è´ã€æµ…æ‹·è´</p></blockquote><hr>        <h3 id="property-copy-NSMutableArray-array-è¿™ç§å†™æ³•ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ"   >          <a href="#property-copy-NSMutableArray-array-è¿™ç§å†™æ³•ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="heading-link"><i class="fas fa-link"></i></a>@property (copy) NSMutableArray *array;è¿™ç§å†™æ³•ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h3>      <blockquote><p>å…³é”®è¯ï¼šcopy</p></blockquote><hr>        <h3 id="atomicå’Œnonatomicçš„åŒºåˆ«ï¼Œä¸ºä»€ä¹ˆå¼€å‘ä¸­å¸¸ç”¨nonatomicè€Œéatomicï¼Ÿ"   >          <a href="#atomicå’Œnonatomicçš„åŒºåˆ«ï¼Œä¸ºä»€ä¹ˆå¼€å‘ä¸­å¸¸ç”¨nonatomicè€Œéatomicï¼Ÿ" class="heading-link"><i class="fas fa-link"></i></a>atomicå’Œnonatomicçš„åŒºåˆ«ï¼Œä¸ºä»€ä¹ˆå¼€å‘ä¸­å¸¸ç”¨nonatomicè€Œéatomicï¼Ÿ</h3>      <blockquote><p>å…³é”®è¯ï¼šatomicã€nonatomicã€é”</p></blockquote><hr>        <h3 id="å¦‚ä½•è®©è‡ªå·±çš„ç±»ç”¨-copy-ä¿®é¥°ç¬¦ï¼Ÿå¦‚ä½•é‡å†™å¸¦-copy-å…³é”®å­—çš„-setterï¼Ÿ"   >          <a href="#å¦‚ä½•è®©è‡ªå·±çš„ç±»ç”¨-copy-ä¿®é¥°ç¬¦ï¼Ÿå¦‚ä½•é‡å†™å¸¦-copy-å…³é”®å­—çš„-setterï¼Ÿ" class="heading-link"><i class="fas fa-link"></i></a>å¦‚ä½•è®©è‡ªå·±çš„ç±»ç”¨ copy ä¿®é¥°ç¬¦ï¼Ÿå¦‚ä½•é‡å†™å¸¦ copy å…³é”®å­—çš„ setterï¼Ÿ</h3>      <blockquote><p>å…³é”®è¯ï¼šatomicã€nonatomicã€é”</p></blockquote><hr>        <h3 id="propertyçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ"   >          <a href="#propertyçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="heading-link"><i class="fas fa-link"></i></a>@propertyçš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</h3>      <blockquote><p>å…³é”®è¯ï¼š@propertyã€setterã€getterã€ivarã€protocolã€category</p></blockquote><hr>        <h3 id="ä½¿ç”¨runtime-Associateæ–¹æ³•å…³è”çš„å¯¹è±¡ï¼Œéœ€è¦åœ¨ä¸»å¯¹è±¡deallocçš„æ—¶å€™é‡Šæ”¾ä¹ˆï¼Ÿ"   >          <a href="#ä½¿ç”¨runtime-Associateæ–¹æ³•å…³è”çš„å¯¹è±¡ï¼Œéœ€è¦åœ¨ä¸»å¯¹è±¡deallocçš„æ—¶å€™é‡Šæ”¾ä¹ˆï¼Ÿ" class="heading-link"><i class="fas fa-link"></i></a>ä½¿ç”¨runtime Associateæ–¹æ³•å…³è”çš„å¯¹è±¡ï¼Œéœ€è¦åœ¨ä¸»å¯¹è±¡deallocçš„æ—¶å€™é‡Šæ”¾ä¹ˆï¼Ÿ</h3>      <blockquote><p>å…³é”®è¯ï¼šruntimeã€å…³è”å¯¹è±¡ã€dealloc</p></blockquote><hr>        <h3 id="synthesizeå’Œ-dynamicåˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"   >          <a href="#synthesizeå’Œ-dynamicåˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ" class="heading-link"><i class="fas fa-link"></i></a>@synthesizeå’Œ@dynamicåˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h3>      <blockquote><p>å…³é”®è¯ï¼š</p></blockquote>        <h2 id="åœ¨æœ‰äº†è‡ªåŠ¨åˆæˆå±æ€§å®ä¾‹å˜é‡ä¹‹åï¼Œ-synthesizeè¿˜æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ"   >          <a href="#åœ¨æœ‰äº†è‡ªåŠ¨åˆæˆå±æ€§å®ä¾‹å˜é‡ä¹‹åï¼Œ-synthesizeè¿˜æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ" class="heading-link"><i class="fas fa-link"></i></a>åœ¨æœ‰äº†è‡ªåŠ¨åˆæˆå±æ€§å®ä¾‹å˜é‡ä¹‹åï¼Œ@synthesizeè¿˜æœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ</h2>      ]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/ios%E9%9D%A2%E8%AF%95%E9%A2%98-1/iOS%E9%9D%A2%E8%AF%95%E9%A2%98.jpg&quot; class=&quot;&quot;&gt;
&lt;br&gt;</summary>
    
    
    
    <category term="iOSé¢è¯•é¢˜" scheme="https://jack110530.github.io/categories/iOS%E9%9D%A2%E8%AF%95%E9%A2%98/"/>
    
    
    <category term="property" scheme="https://jack110530.github.io/tags/property/"/>
    
  </entry>
  
  <entry>
    <title>RunTime(8)-é¢è¯•é¢˜äºŒ</title>
    <link href="https://jack110530.github.io/runtime-8-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%BA%8C/"/>
    <id>https://jack110530.github.io/runtime-8-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%BA%8C/</id>
    <published>2020-10-28T03:42:03.000Z</published>
    <updated>2020-11-10T07:26:27.668Z</updated>
    
    <content type="html"><![CDATA[<img src="/runtime-8-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%BA%8C/%E9%87%8D%E6%8B%BEiOS.jpg" class=""><blockquote><p>å…³é”®è¯ï¼šRunTime</p></blockquote><a id="more"></a><p>RunTimeç³»åˆ—æ–‡ç« :<br></p><ul><li><a href="https://jack110530.github.io/runtime-1-oc%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/">RunTime(1)-OCå¯¹è±¡çš„æœ¬è´¨</a></li><li><a href="https://jack110530.github.io/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/">RunTime(2)-Classç»“æ„åˆ†æ</a></li><li><a href="https://jack110530.github.io/runtime-3-%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/">RunTime(3)-æ¶ˆæ¯æœºåˆ¶</a></li><li><a href="https://jack110530.github.io/runtime-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/">RunTime(4)-Cacheæ–¹æ³•ç¼“å­˜</a></li><li><a href="https://jack110530.github.io/runtime-5-super%E7%9A%84%E6%9C%AC%E8%B4%A8/">RunTime(5)-superçš„æœ¬è´¨</a></li><li><a href="https://jack110530.github.io/runtime-6-%E5%AE%9E%E9%99%85%E8%BF%90%E7%94%A8/">RunTime(6)-å®é™…è¿ç”¨</a></li><li><a href="https://jack110530.github.io/runtime-7-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80/">RunTime(7)-é¢è¯•é¢˜ä¸€</a></li><li><a href="https://jack110530.github.io/runtime-8-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%BA%8C/">RunTime(8)-é¢è¯•é¢˜äºŒ</a></li></ul><p>ã€å¾…å®Œå–„â€¦ã€‘</p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/runtime-8-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%BA%8C/%E9%87%8D%E6%8B%BEiOS.jpg&quot; class=&quot;&quot;&gt;

&lt;blockquote&gt;
&lt;p&gt;å…³é”®è¯ï¼šRunTime&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="é‡æ‹¾iOS" scheme="https://jack110530.github.io/categories/%E9%87%8D%E6%8B%BEiOS/"/>
    
    
    <category term="runtime" scheme="https://jack110530.github.io/tags/runtime/"/>
    
  </entry>
  
  <entry>
    <title>RunTime(7)-é¢è¯•é¢˜ä¸€</title>
    <link href="https://jack110530.github.io/runtime-7-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80/"/>
    <id>https://jack110530.github.io/runtime-7-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80/</id>
    <published>2020-10-28T03:41:54.000Z</published>
    <updated>2020-11-10T07:26:27.668Z</updated>
    
    <content type="html"><![CDATA[<img src="/runtime-7-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80/%E9%87%8D%E6%8B%BEiOS.jpg" class=""><blockquote><p>å…³é”®è¯ï¼šRunTime</p></blockquote><a id="more"></a><p>RunTimeç³»åˆ—æ–‡ç« :<br></p><ul><li><a href="https://jack110530.github.io/runtime-1-oc%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/">RunTime(1)-OCå¯¹è±¡çš„æœ¬è´¨</a></li><li><a href="https://jack110530.github.io/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/">RunTime(2)-Classç»“æ„åˆ†æ</a></li><li><a href="https://jack110530.github.io/runtime-3-%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/">RunTime(3)-æ¶ˆæ¯æœºåˆ¶</a></li><li><a href="https://jack110530.github.io/runtime-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/">RunTime(4)-Cacheæ–¹æ³•ç¼“å­˜</a></li><li><a href="https://jack110530.github.io/runtime-5-super%E7%9A%84%E6%9C%AC%E8%B4%A8/">RunTime(5)-superçš„æœ¬è´¨</a></li><li><a href="https://jack110530.github.io/runtime-6-%E5%AE%9E%E9%99%85%E8%BF%90%E7%94%A8/">RunTime(6)-å®é™…è¿ç”¨</a></li><li><a href="https://jack110530.github.io/runtime-7-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80/">RunTime(7)-é¢è¯•é¢˜ä¸€</a></li><li><a href="https://jack110530.github.io/runtime-8-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%BA%8C/">RunTime(8)-é¢è¯•é¢˜äºŒ</a></li></ul><p>ã€å¾…å®Œå–„â€¦ã€‘</p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/runtime-7-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80/%E9%87%8D%E6%8B%BEiOS.jpg&quot; class=&quot;&quot;&gt;

&lt;blockquote&gt;
&lt;p&gt;å…³é”®è¯ï¼šRunTime&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="é‡æ‹¾iOS" scheme="https://jack110530.github.io/categories/%E9%87%8D%E6%8B%BEiOS/"/>
    
    
    <category term="runtime" scheme="https://jack110530.github.io/tags/runtime/"/>
    
  </entry>
  
  <entry>
    <title>RunTime(6)-å®é™…è¿ç”¨</title>
    <link href="https://jack110530.github.io/runtime-6-%E5%AE%9E%E9%99%85%E8%BF%90%E7%94%A8/"/>
    <id>https://jack110530.github.io/runtime-6-%E5%AE%9E%E9%99%85%E8%BF%90%E7%94%A8/</id>
    <published>2020-10-28T03:41:45.000Z</published>
    <updated>2020-11-10T07:35:09.954Z</updated>
    
    <content type="html"><![CDATA[<img src="/runtime-6-%E5%AE%9E%E9%99%85%E8%BF%90%E7%94%A8/%E9%87%8D%E6%8B%BEiOS.jpg" class=""><blockquote><p>å…³é”®è¯ï¼šRunTime</p></blockquote><a id="more"></a><p>RunTimeç³»åˆ—æ–‡ç« :<br></p><ul><li><a href="https://jack110530.github.io/runtime-1-oc%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/">RunTime(1)-OCå¯¹è±¡çš„æœ¬è´¨</a></li><li><a href="https://jack110530.github.io/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/">RunTime(2)-Classç»“æ„åˆ†æ</a></li><li><a href="https://jack110530.github.io/runtime-3-%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/">RunTime(3)-æ¶ˆæ¯æœºåˆ¶</a></li><li><a href="https://jack110530.github.io/runtime-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/">RunTime(4)-Cacheæ–¹æ³•ç¼“å­˜</a></li><li><a href="https://jack110530.github.io/runtime-5-super%E7%9A%84%E6%9C%AC%E8%B4%A8/">RunTime(5)-superçš„æœ¬è´¨</a></li><li><a href="https://jack110530.github.io/runtime-6-%E5%AE%9E%E9%99%85%E8%BF%90%E7%94%A8/">RunTime(6)-å®é™…è¿ç”¨</a></li><li><a href="https://jack110530.github.io/runtime-7-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80/">RunTime(7)-é¢è¯•é¢˜ä¸€</a></li><li><a href="https://jack110530.github.io/runtime-8-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%BA%8C/">RunTime(8)-é¢è¯•é¢˜äºŒ</a></li></ul>        <h3 id="å‰è¨€"   >          <a href="#å‰è¨€" class="heading-link"><i class="fas fa-link"></i></a>å‰è¨€</h3>              <h3 id="ä¸€ã€RunTime-API"   >          <a href="#ä¸€ã€RunTime-API" class="heading-link"><i class="fas fa-link"></i></a>ä¸€ã€RunTime API</h3>              <h4 id="ç±»"   >          <a href="#ç±»" class="heading-link"><i class="fas fa-link"></i></a>ç±»</h4>      <figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. åŠ¨æ€åˆ›å»ºä¸€ä¸ªç±»ï¼ˆå‚æ•°ï¼šçˆ¶ç±»ï¼Œç±»åï¼Œé¢å¤–çš„å†…å­˜ç©ºé—´ï¼‰</span></span><br><span class="line">Class objc_allocateClassPair(Class superclass, <span class="keyword">const</span> <span class="keyword">char</span> *name, size_t extraBytes)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. æ³¨å†Œä¸€ä¸ªç±»ï¼ˆè¦åœ¨ç±»æ³¨å†Œä¹‹å‰æ·»åŠ æˆå‘˜å˜é‡ï¼‰</span></span><br><span class="line"><span class="keyword">void</span> objc_registerClassPair(Class cls) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. é”€æ¯ä¸€ä¸ªç±»</span></span><br><span class="line"><span class="keyword">void</span> objc_disposeClassPair(Class cls)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. è·å–isaæŒ‡å‘çš„Class</span></span><br><span class="line">Class object_getClass(<span class="keyword">id</span> obj)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. è®¾ç½®isaæŒ‡å‘çš„Class</span></span><br><span class="line">Class object_setClass(<span class="keyword">id</span> obj, Class cls)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. åˆ¤æ–­ä¸€ä¸ªOCå¯¹è±¡æ˜¯å¦ä¸ºClass</span></span><br><span class="line"><span class="built_in">BOOL</span> object_isClass(<span class="keyword">id</span> obj)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 7. åˆ¤æ–­ä¸€ä¸ªClassæ˜¯å¦ä¸ºå…ƒç±»</span></span><br><span class="line"><span class="built_in">BOOL</span> class_isMetaClass(Class cls)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 8. è·å–çˆ¶ç±»</span></span><br><span class="line">Class class_getSuperclass(Class cls)</span><br></pre></td></tr></table></div></figure>        <h4 id="æˆå‘˜å˜é‡"   >          <a href="#æˆå‘˜å˜é‡" class="heading-link"><i class="fas fa-link"></i></a>æˆå‘˜å˜é‡</h4>      <figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. è·å–ä¸€ä¸ªå®ä¾‹å˜é‡ä¿¡æ¯</span></span><br><span class="line">Ivar class_getInstanceVariable(Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. æ‹·è´å®ä¾‹å˜é‡åˆ—è¡¨ï¼ˆæœ€åéœ€è¦è°ƒç”¨freeé‡Šæ”¾ï¼‰</span></span><br><span class="line">Ivar *class_copyIvarList(Class cls, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. è®¾ç½®å’Œè·å–æˆå‘˜å˜é‡çš„å€¼</span></span><br><span class="line"><span class="keyword">void</span> object_setIvar(<span class="keyword">id</span> obj, Ivar ivar, <span class="keyword">id</span> value)</span><br><span class="line"><span class="keyword">id</span> object_getIvar(<span class="keyword">id</span> obj, Ivar ivar)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. åŠ¨æ€æ·»åŠ æˆå‘˜å˜é‡ï¼ˆå·²ç»æ³¨å†Œçš„ç±»æ˜¯ä¸èƒ½åŠ¨æ€æ·»åŠ æˆå‘˜å˜é‡çš„ï¼‰</span></span><br><span class="line"><span class="built_in">BOOL</span> class_addIvar(Class cls, <span class="keyword">const</span> <span class="keyword">char</span> * name, size_t size, uint8_t alignment, <span class="keyword">const</span> <span class="keyword">char</span> * types)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. è·å–æˆå‘˜å˜é‡çš„ç›¸å…³ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *ivar_getName(Ivar v)</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *ivar_getTypeEncoding(Ivar v)</span><br></pre></td></tr></table></div></figure>        <h4 id="å±æ€§"   >          <a href="#å±æ€§" class="heading-link"><i class="fas fa-link"></i></a>å±æ€§</h4>      <figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. è·å–ä¸€ä¸ªå±æ€§</span></span><br><span class="line">objc_property_t class_getProperty(Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. æ‹·è´å±æ€§åˆ—è¡¨ï¼ˆæœ€åéœ€è¦è°ƒç”¨freeé‡Šæ”¾ï¼‰</span></span><br><span class="line">objc_property_t *class_copyPropertyList(Class cls, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. åŠ¨æ€æ·»åŠ å±æ€§</span></span><br><span class="line"><span class="built_in">BOOL</span> class_addProperty(Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">const</span> objc_property_attribute_t *attributes, <span class="keyword">unsigned</span> <span class="keyword">int</span> attributeCount)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. åŠ¨æ€æ›¿æ¢å±æ€§</span></span><br><span class="line"><span class="keyword">void</span> class_replaceProperty(Class cls, <span class="keyword">const</span> <span class="keyword">char</span> *name, <span class="keyword">const</span> objc_property_attribute_t *attributes, <span class="keyword">unsigned</span> <span class="keyword">int</span> attributeCount)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. è·å–å±æ€§çš„ä¸€äº›ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *property_getName(objc_property_t property)</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *property_getAttributes(objc_property_t property)</span><br></pre></td></tr></table></div></figure>        <h4 id="æ–¹æ³•"   >          <a href="#æ–¹æ³•" class="heading-link"><i class="fas fa-link"></i></a>æ–¹æ³•</h4>      <figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. è·å¾—ä¸€ä¸ªå®ä¾‹æ–¹æ³•ã€ç±»æ–¹æ³•</span></span><br><span class="line">Method class_getInstanceMethod(Class cls, SEL name)</span><br><span class="line">Method class_getClassMethod(Class cls, SEL name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. æ–¹æ³•å®ç°ç›¸å…³æ“ä½œ</span></span><br><span class="line">IMP class_getMethodImplementation(Class cls, SEL name) </span><br><span class="line">IMP method_setImplementation(Method m, IMP imp)</span><br><span class="line"><span class="keyword">void</span> method_exchangeImplementations(Method m1, Method m2) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. æ‹·è´æ–¹æ³•åˆ—è¡¨ï¼ˆæœ€åéœ€è¦è°ƒç”¨freeé‡Šæ”¾ï¼‰</span></span><br><span class="line">Method *class_copyMethodList(Class cls, <span class="keyword">unsigned</span> <span class="keyword">int</span> *outCount)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. åŠ¨æ€æ·»åŠ æ–¹æ³•</span></span><br><span class="line"><span class="built_in">BOOL</span> class_addMethod(Class cls, SEL name, IMP imp, <span class="keyword">const</span> <span class="keyword">char</span> *types)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 5. åŠ¨æ€æ›¿æ¢æ–¹æ³•</span></span><br><span class="line">IMP class_replaceMethod(Class cls, SEL name, IMP imp, <span class="keyword">const</span> <span class="keyword">char</span> *types)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 6. è·å–æ–¹æ³•çš„ç›¸å…³ä¿¡æ¯ï¼ˆå¸¦æœ‰copyçš„éœ€è¦è°ƒç”¨freeå»é‡Šæ”¾ï¼‰</span></span><br><span class="line">SEL method_getName(Method m)</span><br><span class="line">IMP method_getImplementation(Method m)</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *method_getTypeEncoding(Method m)</span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> method_getNumberOfArguments(Method m)</span><br><span class="line"><span class="keyword">char</span> *method_copyReturnType(Method m)</span><br><span class="line"><span class="keyword">char</span> *method_copyArgumentType(Method m, <span class="keyword">unsigned</span> <span class="keyword">int</span> index)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 7. é€‰æ‹©å™¨ç›¸å…³</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *sel_getName(SEL sel)</span><br><span class="line">SEL sel_registerName(<span class="keyword">const</span> <span class="keyword">char</span> *str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 8. ç”¨blockä½œä¸ºæ–¹æ³•å®ç°</span></span><br><span class="line">IMP imp_implementationWithBlock(<span class="keyword">id</span> block)</span><br><span class="line"><span class="keyword">id</span> imp_getBlock(IMP anImp)</span><br><span class="line"><span class="built_in">BOOL</span> imp_removeBlock(IMP anImp)</span><br></pre></td></tr></table></div></figure>        <h3 id="äºŒã€RunTimeçš„å®é™…è¿ç”¨åœºæ™¯"   >          <a href="#äºŒã€RunTimeçš„å®é™…è¿ç”¨åœºæ™¯" class="heading-link"><i class="fas fa-link"></i></a>äºŒã€RunTimeçš„å®é™…è¿ç”¨åœºæ™¯</h3>              <h4 id="1-å…³è”å¯¹è±¡ï¼Œç»™åˆ†ç±»categoryæ·»åŠ å±æ€§ï¼›"   >          <a href="#1-å…³è”å¯¹è±¡ï¼Œç»™åˆ†ç±»categoryæ·»åŠ å±æ€§ï¼›" class="heading-link"><i class="fas fa-link"></i></a>1) å…³è”å¯¹è±¡ï¼Œç»™åˆ†ç±»categoryæ·»åŠ å±æ€§ï¼›</h4>      <p><code>objc_setAssociatedObject</code>ï¼Œ<code>objc_getAssociatedObject</code></p>        <h4 id="2-æ–¹æ³•æ›¿æ¢ï¼›"   >          <a href="#2-æ–¹æ³•æ›¿æ¢ï¼›" class="heading-link"><i class="fas fa-link"></i></a>2) æ–¹æ³•æ›¿æ¢ï¼›</h4>      <p><code>class_addMethod</code>ï¼Œ<code>class_replaceMethod</code></p>        <h4 id="3-KVOï¼›"   >          <a href="#3-KVOï¼›" class="heading-link"><i class="fas fa-link"></i></a>3) KVOï¼›</h4>      <p>KVOçš„å®ç°ä¾èµ–äº Objective-C å¼ºå¤§çš„ Runtimeï¼Œå½“è§‚å¯ŸæŸå¯¹è±¡ A æ—¶ï¼ŒKVO æœºåˆ¶åŠ¨æ€åˆ›å»ºä¸€ä¸ªå¯¹è±¡Aå½“å‰ç±»çš„å­ç±»ï¼Œå¹¶ä¸ºè¿™ä¸ªæ–°çš„å­ç±»é‡å†™äº†è¢«è§‚å¯Ÿå±æ€§ keyPath çš„ setter æ–¹æ³•ã€‚setter æ–¹æ³•éšåè´Ÿè´£é€šçŸ¥è§‚å¯Ÿå¯¹è±¡å±æ€§çš„æ”¹å˜çŠ¶å†µã€‚</p>        <h4 id="4-å­—å…¸è½¬æ¨¡å‹ï¼ˆMJExtensionï¼‰ï¼›"   >          <a href="#4-å­—å…¸è½¬æ¨¡å‹ï¼ˆMJExtensionï¼‰ï¼›" class="heading-link"><i class="fas fa-link"></i></a>4) å­—å…¸è½¬æ¨¡å‹ï¼ˆMJExtensionï¼‰ï¼›</h4>              <h4 id="5-è‡ªåŠ¨å½’æ¡£è§£æ¡£ï¼›"   >          <a href="#5-è‡ªåŠ¨å½’æ¡£è§£æ¡£ï¼›" class="heading-link"><i class="fas fa-link"></i></a>5) è‡ªåŠ¨å½’æ¡£è§£æ¡£ï¼›</h4>              <h4 id="6-åˆ©ç”¨æ¶ˆæ¯è½¬å‘æœºåˆ¶è§£å†³æ–¹æ³•æ‰¾ä¸åˆ°çš„å¼‚å¸¸é—®é¢˜ï¼›"   >          <a href="#6-åˆ©ç”¨æ¶ˆæ¯è½¬å‘æœºåˆ¶è§£å†³æ–¹æ³•æ‰¾ä¸åˆ°çš„å¼‚å¸¸é—®é¢˜ï¼›" class="heading-link"><i class="fas fa-link"></i></a>6) åˆ©ç”¨æ¶ˆæ¯è½¬å‘æœºåˆ¶è§£å†³æ–¹æ³•æ‰¾ä¸åˆ°çš„å¼‚å¸¸é—®é¢˜ï¼›</h4>      ]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/runtime-6-%E5%AE%9E%E9%99%85%E8%BF%90%E7%94%A8/%E9%87%8D%E6%8B%BEiOS.jpg&quot; class=&quot;&quot;&gt;

&lt;blockquote&gt;
&lt;p&gt;å…³é”®è¯ï¼šRunTime&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="é‡æ‹¾iOS" scheme="https://jack110530.github.io/categories/%E9%87%8D%E6%8B%BEiOS/"/>
    
    
    <category term="runtime" scheme="https://jack110530.github.io/tags/runtime/"/>
    
  </entry>
  
  <entry>
    <title>RunTime(5)-superçš„æœ¬è´¨</title>
    <link href="https://jack110530.github.io/runtime-5-super%E7%9A%84%E6%9C%AC%E8%B4%A8/"/>
    <id>https://jack110530.github.io/runtime-5-super%E7%9A%84%E6%9C%AC%E8%B4%A8/</id>
    <published>2020-10-28T03:41:32.000Z</published>
    <updated>2020-11-10T07:26:27.668Z</updated>
    
    <content type="html"><![CDATA[<img src="/runtime-5-super%E7%9A%84%E6%9C%AC%E8%B4%A8/%E9%87%8D%E6%8B%BEiOS.jpg" class=""><blockquote><p>å…³é”®è¯ï¼šRunTime</p></blockquote><a id="more"></a><p>RunTimeç³»åˆ—æ–‡ç« :<br></p><ul><li><a href="https://jack110530.github.io/runtime-1-oc%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/">RunTime(1)-OCå¯¹è±¡çš„æœ¬è´¨</a></li><li><a href="https://jack110530.github.io/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/">RunTime(2)-Classç»“æ„åˆ†æ</a></li><li><a href="https://jack110530.github.io/runtime-3-%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/">RunTime(3)-æ¶ˆæ¯æœºåˆ¶</a></li><li><a href="https://jack110530.github.io/runtime-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/">RunTime(4)-Cacheæ–¹æ³•ç¼“å­˜</a></li><li><a href="https://jack110530.github.io/runtime-5-super%E7%9A%84%E6%9C%AC%E8%B4%A8/">RunTime(5)-superçš„æœ¬è´¨</a></li><li><a href="https://jack110530.github.io/runtime-6-%E5%AE%9E%E9%99%85%E8%BF%90%E7%94%A8/">RunTime(6)-å®é™…è¿ç”¨</a></li><li><a href="https://jack110530.github.io/runtime-7-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80/">RunTime(7)-é¢è¯•é¢˜ä¸€</a></li><li><a href="https://jack110530.github.io/runtime-8-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%BA%8C/">RunTime(8)-é¢è¯•é¢˜äºŒ</a></li></ul>        <h3 id="å‰è¨€"   >          <a href="#å‰è¨€" class="heading-link"><i class="fas fa-link"></i></a>å‰è¨€</h3>      <p>å…ˆæ¥çœ‹ä¸€é“é¢è¯•é¢˜ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…ˆå®šä¹‰ä¸¤ä¸ªç±»SFPersonå’ŒSFStudent</span></span><br><span class="line"><span class="comment">// .h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SFPerson</span> : <span class="title">NSObject</span></span></span><br><span class="line">- (<span class="keyword">void</span>)run;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .m</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SFPerson</span></span></span><br><span class="line">- (<span class="keyword">void</span>)run &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SFStudent</span> : <span class="title">SFPerson</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .m</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SFStudent</span></span></span><br><span class="line">- (<span class="keyword">instancetype</span>)init</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> init];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>) &#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;[self class] = %@&quot;</span>,[<span class="keyword">self</span> <span class="keyword">class</span>]);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;[self superclass] = %@&quot;</span>,[<span class="keyword">self</span> superclass]);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;[super class] = %@&quot;</span>,[<span class="keyword">super</span> <span class="keyword">class</span>]);</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;[super superclass] = %@&quot;</span>,[<span class="keyword">super</span> superclass]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)run &#123;</span><br><span class="line">    [<span class="keyword">super</span> run];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><p><strong>é—®ï¼šä»¥ä¸‹ä»£ç å°†ä¼šå¦‚ä½•æ‰“å°?</strong><br><br><code>[[SFStudent alloc] init];</code> <br></p><p><strong>åˆ†æï¼š</strong><br></p><ul><li><code>[self class]</code> è¿™ä¸ªåº”è¯¥æ²¡æœ‰ä»€ä¹ˆç–‘é—®ï¼Œç»“æœåº”è¯¥æ˜¯[self class] = SFStudent</li><li><code>[self superclass]</code> è¿™ä¸ªåº”è¯¥æ²¡æœ‰ä»€ä¹ˆç–‘é—®ï¼Œç»“æœåº”è¯¥æ˜¯[self superclass] = CLPerson</li><li><code>[super class]</code> æˆ‘ä»¬é‡å†™çˆ¶ç±»æ–¹æ³•çš„æ—¶å€™ï¼Œå¦‚æœéœ€è¦æ‰§è¡Œçˆ¶ç±»æ–¹æ³•çš„é€»è¾‘ï¼Œé€šå¸¸ä¼šåŠ ä¸€å¥[super æ–¹æ³•å]ï¼Œé‚£ä¹ˆsuperä¸æ˜¯æŒ‡å‘çˆ¶ç±»çš„æŒ‡é’ˆå‘¢ï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œè¿™é‡Œçš„æ‰“å°ç»“æœåº”è¯¥æ˜¯[super class] = CLPerson</li><li><code>[super superclass]</code> æ ¹æ®ä¸Šé¢çš„æ¨æ–­ï¼Œé‚£ä¹ˆè¿™é‡Œåº”è¯¥æ˜¯æ‰“å°CLPersonçš„çˆ¶ç±»ï¼Œä¹Ÿå°±æ˜¯[super superclass] = NSObject</li></ul><p><strong>å®é™…æ‰“å°ç»“æœï¼š</strong><br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">TestDemo[<span class="number">3861</span>:<span class="number">132784</span>] [<span class="keyword">self</span> <span class="keyword">class</span>] = SFStudent</span><br><span class="line">TestDemo[<span class="number">3861</span>:<span class="number">132784</span>] [<span class="keyword">self</span> superclass] = SFPerson</span><br><span class="line">TestDemo[<span class="number">3861</span>:<span class="number">132784</span>] [<span class="keyword">super</span> <span class="keyword">class</span>] = SFStudent</span><br><span class="line">TestDemo[<span class="number">3861</span>:<span class="number">132784</span>] [<span class="keyword">super</span> superclass] = SFPerson</span><br></pre></td></tr></table></div></figure><p>é€šè¿‡å®é™…çš„ä»£ç è°ƒè¯•ï¼Œæˆ‘ä»¬çœ‹åˆ°[super class]å’Œ[super superclass]çš„æ‰“å°ç»“æœä¸æ˜¯æˆ‘ä»¬æ‰€é¢„æœŸçš„ã€‚æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</p>        <h3 id="ä¸€ã€superçš„æœ¬è´¨"   >          <a href="#ä¸€ã€superçš„æœ¬è´¨" class="heading-link"><i class="fas fa-link"></i></a>ä¸€ã€superçš„æœ¬è´¨</h3>      <p>ä¸ºäº†ç ”ç©¶æœ¬è´¨ï¼Œæ•…æŠ€é‡æ–½ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨clangå…ˆå°†ä»£ç è½¬åŒ–ä¸ºC++ä»£ç ã€‚<br></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc SFStudent.m -o SFStudent.cpp</span><br></pre></td></tr></table></div></figure><p>è½¬åŒ–åï¼Œä¸»è¦çœ‹runæ–¹æ³•ï¼š<br></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> _I_SFStudent_run(SFStudent * self, SEL _cmd) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// [super run];</span></span><br><span class="line">    ((<span class="keyword">void</span> (*)(__rw_objc_super *, SEL))(<span class="keyword">void</span> *)objc_msgSendSuper)((__rw_objc_super)&#123;(id)self, (id)class_getSuperclass(objc_getClass(<span class="string">&quot;SFStudent&quot;</span>))&#125;, sel_registerName(<span class="string">&quot;run&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// NSLog(@&quot;SFStudent Run&quot;);</span></span><br><span class="line">    NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_7__p19yp82j0xd2m_1k8fpr77z40000gn_T_SFStudent_5be081_mi_0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// =====ç®€åŒ–ä¸€ä¸‹=====</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> _I_SFStudent_run(SFStudent * self, SEL _cmd) &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">// [super run];</span></span><br><span class="line">   objc_msgSendSuper((__rw_objc_super)&#123;</span><br><span class="line">            (id)self,   </span><br><span class="line">            (id)class_getSuperclass(objc_getClass(<span class="string">&quot;SFStudent&quot;</span>))</span><br><span class="line">           &#125;,   </span><br><span class="line">            @selector(run));</span><br><span class="line"></span><br><span class="line"><span class="comment">// NSLog(@&quot;SFStudent Run&quot;);ä¸é‡è¦ï¼Œä¸ç”¨ç®¡</span></span><br><span class="line">    NSLog((NSString *)&amp;__NSConstantStringImpl__var_folders_7__p19yp82j0xd2m_1k8fpr77z40000gn_T_SFStudent_5be081_mi_0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// =====å†ç²¾ç®€ä¸€ä¸‹=====</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> _I_SFStudent_run(SFStudent * self, SEL _cmd) &#123;</span><br><span class="line"><span class="comment">// ç»“æ„ä½“å•ç‹¬æŠ½å‡ºæ¥</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">rw_objc_super</span> <span class="title">arg</span> =</span> &#123;</span><br><span class="line">            (id)self,   </span><br><span class="line">            (id)class_getSuperclass(objc_getClass(<span class="string">&quot;SFStudent&quot;</span>))</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// [super run];</span></span><br><span class="line">   objc_msgSendSuper(arg, @selector(run));</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></div></figure><p>ä»ç²¾ç®€åçš„ä»£ç ï¼Œå¯ä»¥çœ‹å‡ºæ¥ï¼Œ<code>[super run];</code>åº•å±‚å®é™…ä¸Šæ˜¯è°ƒç”¨äº†å‡½æ•°<code>objc_msgSendSuper(arg, @selector(run));</code> <br></p><p>1ã€é¦–å…ˆæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹å®ƒçš„ä¸¤ä¸ªå‚æ•°ã€‚ç¬¬äºŒä¸ªå‚æ•°ç›¸ä¿¡ä¸ç”¨å¤šè§£é‡Šäº†ï¼Œå°±æ˜¯ä¸€ä¸ªæ–¹æ³•é€‰æ‹©å™¨<code>SEL</code>ï¼Œé‡ç‚¹çœ‹ä¸€ä¸‹ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè¿™æ˜¯ä¸€ä¸ªç»“æ„ä½“<code>__rw_objc_super</code> <br></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">rw_objc_super</span> &#123;</span> </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_object</span> *<span class="title">object</span>;</span>     <span class="comment">// æ¶ˆæ¯æ¥å—è€…</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_object</span> *<span class="title">superClass</span>;</span> <span class="comment">// çˆ¶ç±»</span></span><br><span class="line">__rw_objc_super(struct objc_object *o, struct objc_object *s) : object(o), superClass(s) &#123;&#125; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p>ç”±æ­¤å¯çŸ¥ï¼š<br></p><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°objectä¼ å…¥çš„æ˜¯selfï¼Œå³SFStudentå®ä¾‹å¯¹è±¡ï¼›<br></li><li>ç¬¬äºŒä¸ªå‚æ•°superClassä¼ å…¥çš„æ˜¯SFPersonç±»å¯¹è±¡ï¼Œå³[SFPerson class]ï¼›<br></li></ul><p>2ã€æ¥ç€æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹<code>objc_msgSendSuper</code>è¿™ä¸ªæ–¹æ³•é‡Œåˆ°åº•åšäº†ä»€ä¹ˆã€‚<br></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">objc_msgSendSuper(struct objc_super * _Nonnull super, SEL _Nonnull op, ...)</span><br></pre></td></tr></table></div></figure><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°superæ˜¯ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“æŒ‡é’ˆ<code>struct objc_super *</code>ï¼Œå®ƒé‡Œé¢çš„å†…å®¹æ˜¯<code>&#123;æ¶ˆæ¯æ¥å—è€… recvï¼Œ æ¶ˆæ¯æ¥å—è€…çš„çˆ¶ç±»ç±»å¯¹è±¡ [[recv superclass] class]&#125;</code>ï¼Œobjc_msgSendSuperä¼šå°†æ¶ˆæ¯æ¥å—è€…çš„çˆ¶ç±»ç±»å¯¹è±¡ä½œä¸ºæ¶ˆæ¯æŸ¥æ‰¾çš„èµ·ç‚¹ã€‚</li><li>ç¬¬äºŒä¸ªå‚æ•°op æ˜¯æ¶ˆæ¯æ¥å—è€…æ¥å—çš„æ¶ˆæ¯/æ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯éœ€è¦å»æŸ¥æ‰¾çš„æ–¹æ³•ã€‚</li></ul>        <h3 id="äºŒã€selfå’Œsuper"   >          <a href="#äºŒã€selfå’Œsuper" class="heading-link"><i class="fas fa-link"></i></a>äºŒã€selfå’Œsuper</h3>              <h4 id="1ï¼‰åŒºåˆ«ï¼š"   >          <a href="#1ï¼‰åŒºåˆ«ï¼š" class="heading-link"><i class="fas fa-link"></i></a>1ï¼‰åŒºåˆ«ï¼š</h4>      <ul><li>self å…³é”®å­—æ˜¯ç±»ä¸­çš„ä¸€ä¸ª<strong>éšè—å‚æ•°</strong>;<ul><li>ä»£è¡¨å½“å‰ç±»çš„æ–¹æ³•è°ƒç”¨è€…ï¼›</li><li>è°ƒç”¨å¯¹è±¡æ–¹æ³•ï¼Œselfä»£è¡¨å½“å‰ç±»çš„å®ä¾‹å¯¹è±¡ï¼›</li><li>è°ƒç”¨ç±»æ–¹æ³•ï¼Œselfä»£è¡¨å½“å‰ç±»çš„ç±»å¯¹è±¡ï¼› </li></ul></li><li>super æ˜¯ä¸€ä¸ª<strong>ç¼–è¯‘å™¨æŒ‡ä»¤</strong>;</li></ul>        <h4 id="2ï¼‰-self-message-å’Œ-super-message-çš„å®ç°"   >          <a href="#2ï¼‰-self-message-å’Œ-super-message-çš„å®ç°" class="heading-link"><i class="fas fa-link"></i></a>2ï¼‰[self message] å’Œ [super message] çš„å®ç°</h4>      <p>ä¸ç®¡æ˜¯selfè¿˜æ˜¯superçœŸæ­£è°ƒç”¨çš„å¯¹è±¡éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æŸ¥æ‰¾æ–¹æ³•çš„ä½ç½®ä¸ä¸€æ ·ï¼Œselfæ˜¯ä»å½“å‰ç±»ç»“æ„ä¸­å¼€å§‹æŸ¥æ‰¾ï¼Œsuperæ˜¯ä»çˆ¶ç±»ä¸­æŸ¥æ‰¾ï¼Œä½†æ–¹æ³•çœŸæ­£çš„æ¥å—è€…éƒ½æ˜¯å½“å‰ç±»æˆ–è€…å½“å‰ç±»çš„å¯¹è±¡ï¼›<br></p><p><code>[self message]</code>ä¼šè½¬åŒ–ä¸º<code>objc_msgSend(id self,SEL _cmd)</code>è¿™ä¸ªå‡½æ•°ï¼Œåœ¨å½“å‰ç±»ç»“æ„ä¸­æ‰¾åˆ°æ–¹æ³•å¹¶ä¸”è°ƒç”¨<br><code>[super message]</code>ä¼šè½¬åŒ–ä¸º<code>id objc_msgSendSuper(struct __rw_objc_super *super, SEL op, â€¦) </code><br>å¯¹æ¯”<code>[self message]</code>è¿™é‡Œé™¤äº†å‡½æ•°ååŠ äº†superä»¥å¤–ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ç”±selfå˜æˆäº†ä¸€ä¸ªç»“æ„ä½“:</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> __<span class="title">rw_objc_super</span> &#123;</span> </span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_object</span> *<span class="title">object</span>;</span>     <span class="comment">// æ¶ˆæ¯æ¥å—è€…</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">objc_object</span> *<span class="title">superClass</span>;</span> <span class="comment">// çˆ¶ç±»</span></span><br><span class="line">__rw_objc_super(struct objc_object *o, struct objc_object *s) : object(o), superClass(s) &#123;&#125; </span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p>åœ¨æ‰§è¡Œ[super message]æ—¶ï¼Œä¼šåšä¸‹é¢çš„äº‹ï¼š<br></p><ol><li>ç¼–è¯‘å™¨ä¼šå…ˆæ„é€ ä¸€ä¸ª__rw_objc_superçš„ç»“æ„ä½“ </li><li>ç„¶åå»superClassçš„æ–¹æ³•åˆ—è¡¨ä¸­æ‰¾æ–¹æ³• </li><li>æ‰¾åˆ°ä¹‹åç”±objectè°ƒç”¨</li></ol><p>æ‰€ä»¥å½“ä½ ç”¨[self Class]å’Œ[super Class]æ‰“å°ç±»çš„æ—¶å€™ï¼Œæ‰“å°çš„éƒ½æ˜¯åŒä¸€ä¸ªç±»ï¼Œå› ä¸ºä»–ä»¬åªæ˜¯æŸ¥æ‰¾æ–¹æ³•çš„ä½ç½®ä¸åŒï¼Œä½†æ˜¯è°ƒç”¨æ–¹æ³•çš„ç±»/å¯¹è±¡æ˜¯ä¸€æ ·çš„.</p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/runtime-5-super%E7%9A%84%E6%9C%AC%E8%B4%A8/%E9%87%8D%E6%8B%BEiOS.jpg&quot; class=&quot;&quot;&gt;

&lt;blockquote&gt;
&lt;p&gt;å…³é”®è¯ï¼šRunTime&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="é‡æ‹¾iOS" scheme="https://jack110530.github.io/categories/%E9%87%8D%E6%8B%BEiOS/"/>
    
    
    <category term="runtime" scheme="https://jack110530.github.io/tags/runtime/"/>
    
  </entry>
  
  <entry>
    <title>RunTime(4)-Cacheæ–¹æ³•ç¼“å­˜</title>
    <link href="https://jack110530.github.io/runtime-4-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/"/>
    <id>https://jack110530.github.io/runtime-4-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/</id>
    <published>2020-10-28T03:41:31.000Z</published>
    <updated>2020-11-10T07:26:27.668Z</updated>
    
    <content type="html"><![CDATA[<img src="/runtime-4-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/%E9%87%8D%E6%8B%BEiOS.jpg" class=""><blockquote><p>å…³é”®è¯ï¼šRunTime</p></blockquote><a id="more"></a><p>RunTimeç³»åˆ—æ–‡ç« :<br></p><ul><li><a href="https://jack110530.github.io/runtime-1-oc%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/">RunTime(1)-OCå¯¹è±¡çš„æœ¬è´¨</a></li><li><a href="https://jack110530.github.io/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/">RunTime(2)-Classç»“æ„åˆ†æ</a></li><li><a href="https://jack110530.github.io/runtime-3-%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/">RunTime(3)-æ¶ˆæ¯æœºåˆ¶</a></li><li><a href="https://jack110530.github.io/runtime-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/">RunTime(4)-Cacheæ–¹æ³•ç¼“å­˜</a></li><li><a href="https://jack110530.github.io/runtime-5-super%E7%9A%84%E6%9C%AC%E8%B4%A8/">RunTime(5)-superçš„æœ¬è´¨</a></li><li><a href="https://jack110530.github.io/runtime-6-%E5%AE%9E%E9%99%85%E8%BF%90%E7%94%A8/">RunTime(6)-å®é™…è¿ç”¨</a></li><li><a href="https://jack110530.github.io/runtime-7-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80/">RunTime(7)-é¢è¯•é¢˜ä¸€</a></li><li><a href="https://jack110530.github.io/runtime-8-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%BA%8C/">RunTime(8)-é¢è¯•é¢˜äºŒ</a></li></ul>        <h3 id="å‰è¨€"   >          <a href="#å‰è¨€" class="heading-link"><i class="fas fa-link"></i></a>å‰è¨€</h3>      <p>ä»ä¸Šä¸€èŠ‚ã€Šæ¶ˆæ¯æœºåˆ¶ã€‹ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“åœ¨ã€Œæ¶ˆæ¯å‘é€ã€é˜¶æ®µä¼šå…ˆåœ¨cacheä¸­æŸ¥æ‰¾æ–¹æ³•ï¼Œcacheä¸­æ²¡æœ‰æ—¶ï¼Œä¼šå»æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼Œæ‰¾åˆ°åä¹Ÿä¼šç¼“å­˜åˆ°cacheä¸­ã€‚<br><br>å…ˆå›é¡¾ä¸€ä¸‹ï¼ŒClassçš„ç»“æ„ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_class *Class;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_object &#123;</span><br><span class="line">Class isa;</span><br><span class="line">&#125; *<span class="keyword">id</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> objc_class : objc_object &#123;</span><br><span class="line">    <span class="comment">// Class ISA;</span></span><br><span class="line">    Class superclass;           <span class="comment">// æŒ‡å‘çˆ¶ç±»</span></span><br><span class="line">    cache_t cache;              <span class="comment">// ç”¨äºæ–¹æ³•ç¼“å­˜</span></span><br><span class="line">    class_data_bits_t bits;     <span class="comment">// ç”¨äºè·å–å…·ä½“çš„ç±»ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">    class_rw_t *data() &#123; </span><br><span class="line">        <span class="keyword">return</span> bits.data();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> setData(class_rw_t *newData) &#123;</span><br><span class="line">        bits.setData(newData);</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">//......ä¸‹é¢çš„ä¸€å †æ–¹æ³•/å‡½æ•°ä»£ç å¯ä»¥æš‚æ—¶ä¸ç”¨å…³æ³¨</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p>åœ¨Classä¸­ç¡®å®æœ‰ä¸€ä¸ªç”¨äºæ–¹æ³•ç¼“å­˜çš„æˆå‘˜cacheï¼Œé‚£ä¹ˆï¼Œåœ¨cacheä¸­æ–¹æ³•åˆ°åº•æ˜¯æ€ä¹ˆå­˜å–çš„å‘¢ï¼Ÿ<br><br>å…¶å®cache_t cacheæ˜¯é€šè¿‡<strong>æ•£åˆ—è¡¨</strong>æ¥å®ç°çš„ï¼Œç±»ä¼¼æˆ‘ä»¬å¼€å‘ä¸­å¸¸ç”¨çš„NSDictionaryï¼Œä¸‹é¢å°±æ¥ç€é‡åˆ†æä¸€ä¸‹ï¼š<br></p>        <h3 id="ä¸€ã€cache-t"   >          <a href="#ä¸€ã€cache-t" class="heading-link"><i class="fas fa-link"></i></a>ä¸€ã€cache_t</h3>      <p>å…ˆæ¥çœ‹çœ‹cache_tçš„ç»“æ„ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> cache_t &#123;</span><br><span class="line">    <span class="keyword">struct</span> bucket_t *_buckets;  <span class="comment">// ç”¨æ¥ç¼“å­˜æ–¹æ³•çš„æ•£åˆ—/å“ˆå¸Œè¡¨</span></span><br><span class="line">    mask_t _mask;               <span class="comment">// è¿™ä¸ªå€¼ = æ•£åˆ—è¡¨é•¿åº¦ - 1</span></span><br><span class="line">    mask_t _occupied;           <span class="comment">// è¡¨ç¤ºå·²ç»ç¼“å­˜çš„æ–¹æ³•çš„æ•°é‡</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> bucket_t &#123;</span><br><span class="line">private:</span><br><span class="line">    cache_key_t _key; <span class="comment">// è¿™ä¸ªkeyå®é™…ä¸Šå°±æ˜¯æ–¹æ³•çš„SELï¼Œä¹Ÿå°±æ˜¯æ–¹æ³•å</span></span><br><span class="line">    IMP _imp;         <span class="comment">// è¿™ä¸ªå°±æ˜¯æ–¹æ³•å¯¹åº”çš„å‡½æ•°çš„å†…å­˜åœ°å€</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æƒ³ä¸€æƒ³æˆ‘ä»¬å¹³æ—¶æ˜¯æ€ä¹ˆä½¿ç”¨NSDictionaryçš„ï¼Œé€šè¿‡ä¸€å †Key-Valueé”®å€¼å¯¹æ¥è¿›è¡Œå­˜å‚¨çš„ï¼ŒNSDictionaryçš„åº•å±‚å°±æ˜¯æ•£åˆ—è¡¨ã€‚æ–¹æ³•ç¼“å­˜çš„æ—¶å€™ï¼Œkeyå°±æ˜¯ä¸Šé¢çš„cache_key_t _key;ï¼Œvalueå°±æ˜¯ä¸Šé¢çš„bucket_tç»“æ„ä½“å¯¹è±¡ã€‚<br></p><p>ä½†æ˜¯æ•£åˆ—è¡¨çš„è¿ä½œåŸç†åˆ°åº•å¦‚ä½•å‘¢ï¼Œè¿™ä¸ªå±äºæ•°æ®ç»“æ„é—®é¢˜ï¼Œè¿™é‡Œç®€è¦ä»‹ç»ä¸€ä¸‹ã€‚é¦–å…ˆæ•£åˆ—è¡¨æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚<br></p><p>åœ¨å¾€æ•£åˆ—è¡¨é‡Œé¢æ·»åŠ æˆå‘˜çš„æ—¶å€™ï¼Œé¦–å…ˆéœ€è¦å€ŸåŠ©keyè®¡ç®—å‡ºä¸€ä¸ªindexï¼Œç„¶åå†å°†å…ƒç´ æ’å…¥æ•£åˆ—è¡¨çš„indexä½ç½®ã€‚<br></p><img src="/runtime-4-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/set.png" class=""><br><p>é‚£ä¹ˆä»æ•£åˆ—è¡¨é‡Œé¢å–å€¼å°±æ˜¾è€Œæ˜“è§äº†ï¼Œæ ¹æ®ä¸€ä¸ªkeyï¼Œè®¡ç®—å‡ºindexï¼Œç„¶ååˆ°æ•£åˆ—è¡¨å¯¹åº”ä½ç½®å°†å€¼å–å‡ºã€‚<br></p><img src="/runtime-4-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/get.png" class=""><br><p>è¿™é‡Œçš„æŸ¥è¯¢æ–¹æ³•çš„æ—¶å€™ï¼ˆä¹Ÿå°±æ˜¯å–å€¼æ“ä½œï¼‰ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1), å¯¹æ¯”æˆ‘ä»¬ä¸€å¼€å§‹ä»æ–¹æ³•åˆ—è¡¨çš„éå†æŸ¥è¯¢æ‰€å¯¹åº”çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œå› æ­¤é€šè¿‡ç¼“å­˜æ–¹æ³•ï¼Œå¯ä»¥æå¤§çš„æé«˜æ–¹æ³•æŸ¥è¯¢çš„æ•ˆç‡ï¼Œä»è€Œæé«˜äº†æ–¹æ³•è°ƒç”¨æœºåˆ¶çš„æ•ˆç‡ã€‚<br></p><p>æ ¹æ®keyè®¡ç®—å‡ºindexå€¼çš„è¿™ä¸ªç®—æ³•ç§°ä½œ<strong>æ•£åˆ—ç®—æ³•</strong>ï¼Œè¿™ä¸ªç®—æ³•å¯ä»¥ç”±ä½ è‡ªå·±è®¾è®¡ï¼Œæ€»ä¹‹ç›®çš„å°±æ˜¯å°½å¯èƒ½å‡å°‘ä¸åŒçš„keyå¾—å‡ºç›¸åŒindexçš„æƒ…å†µå‡ºç°ï¼Œè¿™ç§æƒ…å†µè¢«ç§°ä½œ<strong>å“ˆå¸Œç¢°æ’</strong>ï¼ŒåŒæ—¶è¿˜è¦ä¿è¯å¾—å‡ºçš„indexå€¼åœ¨åˆç†çš„èŒƒå›´ã€‚indexè¶Šå¤§ï¼Œæ„å‘³ç€å¯¹åº”çš„æ•£åˆ—è¡¨çš„é•¿åº¦è¶Šé•¿ï¼Œè¿™æ˜¯éœ€è¦å ç”¨å®é™…ç‰©ç†ç©ºé—´çš„ï¼Œè€Œæˆ‘ä»¬çš„å†…å­˜æ˜¯æœ‰é™çš„ã€‚<br></p><p>æ•£åˆ—è¡¨æ˜¯ä¸€ç§é€šè¿‡ç‰ºç‰²ä¸€å®šç©ºé—´ï¼Œæ¥æ¢å–æ—¶é—´æ•ˆç‡çš„è®¾è®¡æ€æƒ³ã€‚<br></p><p>æˆ‘ä»¬é€šè¿‡keyè®¡ç®—å‡ºçš„indexå¤§å°æ˜¯éšæœºçš„ï¼Œæ— é¡ºåºçš„ï¼Œå› æ­¤åœ¨æ–¹æ³•ç¼“å­˜çš„è¿‡ç¨‹ä¸­ï¼Œæ’å…¥çš„é¡ºåºä¹Ÿæ˜¯æ— é¡ºåºçš„ã€‚<br></p><img src="/runtime-4-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/random.png" class=""><br><p>è€Œä¸”å¯ä»¥é¢„è§çš„æ˜¯ï¼Œæ•£åˆ—è¡¨é‡Œé¢å†å®é™…ä½¿ç”¨ä¸­ä¼šæœ‰å¾ˆå¤šä½ç½®æ˜¯ç©ºç€çš„ï¼Œæ¯”å¦‚æ•£åˆ—è¡¨é•¿åº¦ä¸º16ï¼Œæœ€ç»ˆå€¼å­˜å‚¨äº†10ä¸ªæ–¹æ³•ï¼Œæ•£åˆ—è¡¨é•¿åº¦ä¸º64ï¼Œæœ€ç»ˆå¯èƒ½åªä¼šå­˜å‚¨40ä¸ªæ–¹æ³•ï¼Œæœ‰ä¸€éƒ¨åˆ†ç©ºé—´ç»ˆç©¶æ˜¯è¦è¢«æµªè´¹çš„ã€‚ä½†æ˜¯å´æé«˜æŸ¥æ‰¾çš„æ•ˆç‡ã€‚è¿™æ—¢æ˜¯æ‰€è°“çš„<strong>ç©ºé—´æ¢æ—¶é—´</strong>ã€‚</p>        <h3 id="äºŒã€å‘cache-tå­˜å…¥æ–¹æ³•"   >          <a href="#äºŒã€å‘cache-tå­˜å…¥æ–¹æ³•" class="heading-link"><i class="fas fa-link"></i></a>äºŒã€å‘cache_tå­˜å…¥æ–¹æ³•</h3>      <img src="/runtime-4-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/setA.png" class=""><br><img src="/runtime-4-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/setB.png" class=""><br><img src="/runtime-4-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/setC.png" class=""><br><img src="/runtime-4-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/setD.png" class=""><br>        <h3 id="ä¸‰ã€ä»cache-tæŸ¥è¯¢æ–¹æ³•"   >          <a href="#ä¸‰ã€ä»cache-tæŸ¥è¯¢æ–¹æ³•" class="heading-link"><i class="fas fa-link"></i></a>ä¸‰ã€ä»cache_tæŸ¥è¯¢æ–¹æ³•</h3>      <img src="/runtime-4-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/getA.png" class=""><br><img src="/runtime-4-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/getC.png" class=""><br><img src="/runtime-4-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/getD.png" class=""><br><img src="/runtime-4-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/getE.png" class=""><br>        <h3 id="å››ã€æ‰©å®¹"   >          <a href="#å››ã€æ‰©å®¹" class="heading-link"><i class="fas fa-link"></i></a>å››ã€æ‰©å®¹</h3>      <blockquote><p>ä½ å¯èƒ½è¿˜ä¼šæœ‰ä¸€ä¸ªç–‘é—®ï¼Œå¦‚æœä¸æ–­çš„å¾€ç¼“å­˜é‡Œæ·»åŠ æ–¹æ³•ï¼Œç¼“å­˜æ»¡äº†æ€ä¹ˆåŠï¼Ÿ<br></p></blockquote><p>å…¶å®è‹¹æœçš„åšæ³•æ˜¯ï¼Œåœ¨å·²ç¼“å­˜çš„æ–¹æ³•æ•°é‡è¾¾åˆ°å½“å‰ç¼“å­˜å®¹é‡çš„3/4æ—¶å€™ï¼Œå°±ä¼šå‡ºå‘æ‰©å®¹æ“ä½œ<code>expand()</code>ï¼Œæºç å¦‚ä¸‹ï¼š<br></p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cache_t::expand</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cacheUpdateLock.assertLocked();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">uint32_t</span> oldCapacity = capacity();</span><br><span class="line">    <span class="keyword">uint32_t</span> newCapacity = oldCapacity ? oldCapacity*<span class="number">2</span> : INIT_CACHE_SIZE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">uint32_t</span>)(<span class="keyword">mask_t</span>)newCapacity != newCapacity) &#123;</span><br><span class="line">        <span class="comment">// mask overflow - can&#x27;t grow further</span></span><br><span class="line">        <span class="comment">// fixme this wastes one bit of mask</span></span><br><span class="line">        newCapacity = oldCapacity;</span><br><span class="line">    &#125;</span><br><span class="line">    reallocate(oldCapacity, newCapacity);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ä¸Šé¢ä»£ç é‡Œé¢<code>uint32_t newCapacity = oldCapacity ? oldCapacity*2 : INIT_CACHE_SIZE;</code>è¯´çš„å¾ˆæ˜ç™½ï¼Œæ‰©å®¹å°±æ˜¯å°†å½“å‰ç¼“å­˜å®¹é‡* 2ï¼Œå¦‚æœæ˜¯é¦–æ¬¡è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œä¼šä½¿ç”¨ä¸€ä¸ªåˆå§‹å®¹é‡å€¼<code>INIT_CACHE_SIZE</code>æ¥è®¾å®šç¼“å­˜å®¹é‡</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">enum</span> &#123;</span></span><br><span class="line">    INIT_CACHE_SIZE_LOG2 = <span class="number">2</span>,</span><br><span class="line">    INIT_CACHE_SIZE      = (<span class="number">1</span> &lt;&lt; INIT_CACHE_SIZE_LOG2)</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p>ä»INIT_CACHE_SIZEçš„å®šä¹‰æ˜¾ç¤ºå®ƒçš„å€¼æ˜¯4ï¼Œä¹Ÿå°±æ˜¯è¯´è‹¹æœç»™<strong>cache_tè®¾å®šçš„åˆå§‹å®¹é‡æ˜¯4</strong>ã€‚</p><blockquote><p>ä½ å¯èƒ½è¿˜ä¼šé—®ï¼Œé‡ç½®ç¼“å­˜ä¹‹åï¼ŒåŸæ¥è€ç¼“å­˜é‡Œé¢çš„å†…å®¹è¿˜è¦ä¸è¦å‘¢?<br></p></blockquote><p>expand()å‡½æ•°é‡Œé¢è°ƒç”¨çš„æœ€åä¸€ä¸ªå‡½æ•°æ˜¯<code>reallocate(oldCapacity, newCapacity);</code>ï¼Œæˆ‘ä»¬åœ¨è¿›å…¥å®ƒçš„æºç çœ‹çœ‹:</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cache_t::reallocate</span><span class="params">(<span class="keyword">mask_t</span> oldCapacity, <span class="keyword">mask_t</span> newCapacity)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">bool</span> freeOld = canBeFreed();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bucket_t</span> *oldBuckets = buckets();</span><br><span class="line">    <span class="keyword">bucket_t</span> *newBuckets = allocateBuckets(newCapacity);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Cache&#x27;s old contents are not propagated. </span></span><br><span class="line">    <span class="comment">// This is thought to save cache memory at the cost of extra cache fills.</span></span><br><span class="line">    <span class="comment">// fixme re-measure this</span></span><br><span class="line"></span><br><span class="line">    assert(newCapacity &gt; <span class="number">0</span>);</span><br><span class="line">    assert((<span class="keyword">uintptr_t</span>)(<span class="keyword">mask_t</span>)(newCapacity<span class="number">-1</span>) == newCapacity<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">    setBucketsAndMask(newBuckets, newCapacity - <span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (freeOld) &#123;</span><br><span class="line">        cache_collect_free(oldBuckets, oldCapacity);</span><br><span class="line">        cache_collect(<span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>å¾ˆæ˜æ˜¾ï¼Œåœ¨æœ€å¯¹æ—§çš„ç¼“å­˜ç©ºé—´è¿›è¡Œäº†é‡Šæ”¾ï¼Œä½†æ˜¯æ¡ä»¶æ˜¯<code>freeOld = true</code>ï¼Œå‡½æ•°å¼€å¤´ç»™å‡ºäº†freeOldçš„ç”±æ¥ï¼Œé€šè¿‡<code>canBeFreed()</code>å‡½æ•°è·å¾—</p><figure class="highlight c++"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cache_t::isConstantEmptyCache</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> </span><br><span class="line">        occupied() == <span class="number">0</span>  &amp;&amp;  </span><br><span class="line">        buckets() == emptyBucketsForCapacity(capacity(), <span class="literal">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cache_t::canBeFreed</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> !isConstantEmptyCache();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p><code>canBeFreed()</code>å‡½æ•°å…¶å®å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ¤æ–­ä¸€ä¸‹ç¼“å­˜æ˜¯ä¸æ˜¯ç©ºçš„ï¼Œå¦‚æœç©ºçš„ï¼Œæ—§æ²¡å¿…è¦é‡Šæ”¾ç©ºé—´äº†ï¼Œå¦‚æœåŸæ¥çš„ç¼“å­˜ä¸æ˜¯ç©ºçš„ï¼Œå°±ç›´æ¥é‡Šæ”¾æ‰ï¼Œå¹¶ä¸”æˆ‘ä»¬å‘ç°ï¼Œæ‰©å®¹çš„æ“ä½œé‡Œé¢ï¼Œå¹¶æ²¡æœ‰å¯¹æ—§çš„ç¼“å­˜ç©ºé—´é‡Œé¢çš„å†…å®¹è¿›è¡Œå¤åˆ¶ä¿ç•™ï¼Œå°±æ˜¯å¾ˆç²—æš´çš„ç›´æ¥åˆ†é…ä¸€å—æ–°çš„ç¼“å­˜ç©ºé—´ï¼Œç„¶åç›´æ¥é‡Šæ”¾æ‰æ—§çš„ç¼“å­˜ç©ºé—´ï¼Œè¿™æ„å‘³ç€ï¼Œ<strong>æ¯æ¬¡è¿›è¡Œæ‰©å®¹æ“ä½œä¹‹åï¼ŒåŸæ¥ç¼“å­˜è¿‡çš„æ–¹æ³•å°±ä¼šå…¨éƒ¨ä¸¢å¤±</strong>ï¼Œè€Œä¸Šé¢çš„<code>cache_fill_nolock</code>å‡½æ•°é‡Œé¢ï¼Œåœ¨è¿›è¡Œå®Œ<code>expand()</code>æ‰©å®¹æ“ä½œä¹‹åï¼Œä¹Ÿä»…ä»…æ˜¯æŠŠå½“å‰å¤„ç†çš„æ–¹æ³•æ”¾åˆ°ç¼“å­˜ç©ºé—´é‡Œé¢ï¼Œå› æ­¤ï¼Œæ‰©å®¹ä¹‹å‰æ›¾ç»è¢«ç¼“å­˜è¿‡çš„æ–¹æ³•ï¼Œå¦‚æœä¸‹æ¬¡å†æ¬¡è°ƒç”¨çš„è¯ï¼Œåˆéœ€è¦è¢«é‡æ–°ç¼“å­˜äº†ã€‚</p>        <h3 id="é¢è¯•é¢˜"   >          <a href="#é¢è¯•é¢˜" class="heading-link"><i class="fas fa-link"></i></a>é¢è¯•é¢˜</h3>      <hr><p><strong>1ã€çˆ¶ç±»çš„æ–¹æ³•è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šå¦‚ä½•ç¼“å­˜ï¼Ÿ</strong><br></p><p>ç°åœ¨ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå½“å¯¹ä¸€ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯åï¼Œä¼šé€šè¿‡å¯¹è±¡çš„isaæ‰¾åˆ°å®ƒçš„Classå¯¹è±¡ï¼Œåœ¨Classå¯¹è±¡é‡Œé¢å…ˆä»æ–¹æ³•ç¼“å­˜cache_tæŸ¥æ‰¾è¯¥æ–¹æ³•ï¼Œæ²¡æœ‰çš„è¯å†å¯¹Classå¯¹è±¡çš„æ–¹æ³•åˆ—è¡¨è¿›è¡Œéå†æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°äº†æ–¹æ³•ï¼Œå°±è¿›è¡Œç¼“å­˜å¹¶ä¸”è°ƒç”¨ï¼Œé‚£ä¹ˆè¿™é‡Œè‚¯å®šæ˜¯å°†æ–¹æ³•ç¼“å­˜åˆ°äº†è¯¥å¯¹è±¡çš„Classå¯¹è±¡çš„cache_té‡Œé¢ã€‚<br></p><p>å¦‚æœåœ¨å½“å‰Classå¯¹è±¡é‡Œé¢æ²¡æœ‰æ‰¾åˆ°è¯¥æ–¹æ³•ï¼Œé‚£ä¹ˆä¼šé€šè¿‡Classå¯¹è±¡çš„superclassè¿›å…¥å…¶çˆ¶ç±»çš„Classå¯¹è±¡é‡Œé¢ï¼ŒåŒæ ·ï¼Œä¼šå…ˆæŸ¥æ‰¾å®ƒçš„cache_t,å¦‚æœæ²¡æœ‰æ‰¾åˆ°æ–¹æ³•ï¼Œä¼šå¯¹å…¶æ–¹æ³•åˆ—è¡¨è¿›è¡Œéå†æŸ¥æ‰¾ï¼Œé—®é¢˜å°±åœ¨è¿™é‡Œï¼Œå¦‚æœæ­¤æ—¶åœ¨æ–¹æ³•åˆ—è¡¨é‡Œé¢æ‰¾åˆ°äº†æ–¹æ³•ï¼Œè¿›è¡Œç¼“å­˜æ“ä½œçš„æ—¶å€™ï¼Œæ˜¯ä¼šå°†æ–¹æ³•å­˜å…¥å½“å‰çˆ¶ç±»çš„Classå¯¹è±¡çš„cache_té‡Œé¢å‘¢ï¼Œè¿˜æ˜¯ä¼šå­˜åˆ°æ¥æ”¶æ¶ˆæ¯çš„å¯¹è±¡çš„Classå¯¹è±¡çš„cache_té‡Œé¢å‘¢ï¼Ÿ<br></p><p>ç­”ï¼š<br><br>åªç¼“å­˜åˆ°æ¥æ”¶æ¶ˆæ¯çš„å¯¹è±¡çš„Classå¯¹è±¡çš„cache_té‡Œã€‚</p><hr><p>[ç›¸å…³å‚è€ƒ]<br/></p><ol><li><span class="exturl"><a class="exturl__link"   href="https://blog.csdn.net/u013480070/article/details/100155929" >Runtimeç¬”è®°ï¼ˆä¸‰ï¼‰â€”â€” OC Classçš„æ–¹æ³•ç¼“å­˜cache_t</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> </li></ol>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/runtime-4-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/%E9%87%8D%E6%8B%BEiOS.jpg&quot; class=&quot;&quot;&gt;

&lt;blockquote&gt;
&lt;p&gt;å…³é”®è¯ï¼šRunTime&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="é‡æ‹¾iOS" scheme="https://jack110530.github.io/categories/%E9%87%8D%E6%8B%BEiOS/"/>
    
    
    <category term="runtime" scheme="https://jack110530.github.io/tags/runtime/"/>
    
  </entry>
  
  <entry>
    <title>RunTime(3)-æ¶ˆæ¯æœºåˆ¶</title>
    <link href="https://jack110530.github.io/runtime-3-%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/"/>
    <id>https://jack110530.github.io/runtime-3-%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/</id>
    <published>2020-10-28T03:41:30.000Z</published>
    <updated>2020-11-10T07:26:27.668Z</updated>
    
    <content type="html"><![CDATA[<img src="/runtime-3-%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/%E9%87%8D%E6%8B%BEiOS.jpg" class=""><blockquote><p>å…³é”®è¯ï¼šRunTime</p></blockquote><a id="more"></a><p>RunTimeç³»åˆ—æ–‡ç« :<br></p><ul><li><a href="https://jack110530.github.io/runtime-1-oc%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/">RunTime(1)-OCå¯¹è±¡çš„æœ¬è´¨</a></li><li><a href="https://jack110530.github.io/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/">RunTime(2)-Classç»“æ„åˆ†æ</a></li><li><a href="https://jack110530.github.io/runtime-3-%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/">RunTime(3)-æ¶ˆæ¯æœºåˆ¶</a></li><li><a href="https://jack110530.github.io/runtime-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/">RunTime(4)-Cacheæ–¹æ³•ç¼“å­˜</a></li><li><a href="https://jack110530.github.io/runtime-5-super%E7%9A%84%E6%9C%AC%E8%B4%A8/">RunTime(5)-superçš„æœ¬è´¨</a></li><li><a href="https://jack110530.github.io/runtime-6-%E5%AE%9E%E9%99%85%E8%BF%90%E7%94%A8/">RunTime(6)-å®é™…è¿ç”¨</a></li><li><a href="https://jack110530.github.io/runtime-7-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80/">RunTime(7)-é¢è¯•é¢˜ä¸€</a></li><li><a href="https://jack110530.github.io/runtime-8-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%BA%8C/">RunTime(8)-é¢è¯•é¢˜äºŒ</a></li></ul>        <h3 id="å‰è¨€"   >          <a href="#å‰è¨€" class="heading-link"><i class="fas fa-link"></i></a>å‰è¨€</h3>      <ol><li>æˆ‘ä»¬çŸ¥é“æ–¹æ³•æŸ¥æ‰¾æ—¶ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œä¼šå°†æ–¹æ³•ç¼“å­˜åˆ°cache_tä¸­ã€‚é‚£ä¹ˆï¼Œå½“å¯¹è±¡æ‰€åœ¨å½“å‰ç±»ä¸­æ²¡æœ‰è¯¥æ–¹æ³•æ—¶ï¼Œä¼šé€šè¿‡superclassæŒ‡é’ˆå»å®ƒçš„çˆ¶ç±»ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœåœ¨çˆ¶ç±»ä¸­æ‰¾åˆ°äº†è¯¥æ–¹æ³•æ—¶ï¼Œæ–¹æ³•ä¼šæ€ä¹ˆç¼“å­˜ï¼Ÿæ˜¯ç¼“å­˜åˆ°çˆ¶ç±»çš„cache_tä¸­ï¼Œè¿˜æ˜¯ç¼“å­˜åˆ°å½“å‰ç±»çš„cache_tä¸­ï¼Œè¿˜æ˜¯éƒ½ä¼šç¼“å­˜ï¼Ÿ</li></ol>        <h3 id="ä¸€ã€æ–¹æ³•çš„æœ¬è´¨"   >          <a href="#ä¸€ã€æ–¹æ³•çš„æœ¬è´¨" class="heading-link"><i class="fas fa-link"></i></a>ä¸€ã€æ–¹æ³•çš„æœ¬è´¨</h3>      <p>æœ‰äº†å‰ä¸¤èŠ‚çš„åŸºç¡€åï¼Œæˆ‘ä»¬çŸ¥é“ï¼š<br><br>ä¸ç®¡æ˜¯å¯¹è±¡æ–¹æ³•è¿˜æ˜¯ç±»æ–¹æ³•å…¶å®éƒ½æ˜¯å­˜åœ¨ç±»æˆ–å…ƒç±»çš„bitsä¸­ï¼Œå…·ä½“ä¸€ç‚¹æ˜¯å­˜åœ¨class_rw_tå’Œclass_ro_tä¸­ã€‚é‚£ä¹ˆï¼Œæ–¹æ³•å…·ä½“æ˜¯å¦‚ä½•è¢«è°ƒç”¨çš„å‘¢ï¼Ÿ<br><br>å¦‚ä»¥ä¸‹ä»£ç ï¼Œpersonå¯¹è±¡æ—¶æ€ä¹ˆæ‰¾åˆ°testæ–¹æ³•ï¼Œå†è¿›è¡Œè°ƒç”¨çš„ï¼Ÿ<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> play()&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        SFPerson *person = [SFPerson alloc];</span><br><span class="line">        [person test];</span><br><span class="line">        play();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨clangå…ˆå°†ä»£ç è½¬åŒ–æˆC++ä»£ç æ¥ç ”ç©¶<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -rewrite-objc main.m -o main.cpp</span><br></pre></td></tr></table></div></figure><p>è½¬åŒ–åçš„ä»£ç æ˜¯ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="comment">/* @autoreleasepool */</span> &#123; __AtAutoreleasePool __autoreleasepool; </span><br><span class="line">        SFPerson *person = ((SFPerson *(*)(<span class="keyword">id</span>, SEL))(<span class="keyword">void</span> *)objc_msgSend)((<span class="keyword">id</span>)objc_getClass(<span class="string">&quot;SFPerson&quot;</span>), sel_registerName(<span class="string">&quot;alloc&quot;</span>));</span><br><span class="line">        ((<span class="keyword">void</span> (*)(<span class="keyword">id</span>, SEL))(<span class="keyword">void</span> *)objc_msgSend)((<span class="keyword">id</span>)person, sel_registerName(<span class="string">&quot;test&quot;</span>));</span><br><span class="line"></span><br><span class="line">        play();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>å¯ä»¥å‘ç°ï¼Œæ–¹æ³•çš„è°ƒç”¨objc_msgSend(id,SEL) å‘é€æ¶ˆæ¯çš„æ–¹å¼æ¥å®ç°çš„ã€‚<br></p><p>objec_msgSendçš„æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OBJC_EXPORT objc_msgSend(<span class="keyword">id</span> _Nullable <span class="keyword">self</span>, SEL _Nonnull op, ...)</span><br></pre></td></tr></table></div></figure><p>åŒæ ·çš„ï¼Œplay()æ–¹æ³•çš„è°ƒç”¨ç›´æ¥å°±æ˜¯å‡½æ•°æŒ‡é’ˆè°ƒç”¨ã€‚<br></p><p>æ‰€ä»¥ï¼ŒOCå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨åº•å±‚æ˜¯é€šè¿‡objc_msgSend(id,SEL) å‘é€æ¶ˆæ¯çš„æ–¹å¼æ¥å®ç°çš„ï¼Œé‚£ä¹ˆå‘é€æ¶ˆæ¯çš„å…·ä½“æµç¨‹åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™å°±æ˜¯æœ¬ç« èŠ‚è®¨è®ºçš„é—®é¢˜ã€‚</p>        <h3 id="äºŒã€æ¶ˆæ¯å‘é€"   >          <a href="#äºŒã€æ¶ˆæ¯å‘é€" class="heading-link"><i class="fas fa-link"></i></a>äºŒã€æ¶ˆæ¯å‘é€</h3>      <p>ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•åƒè¿™æ ·[obj foo]ï¼Œç¼–è¯‘å™¨è½¬æˆæ¶ˆæ¯å‘é€objc_msgSend(obj, foo)ï¼ŒRuntimeæ—¶æ‰§è¡Œçš„æµç¨‹æ˜¯è¿™æ ·çš„ï¼š<br></p><ol><li>é¦–å…ˆï¼Œé€šè¿‡objçš„isaæŒ‡é’ˆæ‰¾åˆ°å®ƒçš„class;</li><li>åœ¨classçš„method listæ‰¾foo;</li><li>å¦‚æœclassä¸­æ²¡åˆ°fooï¼Œç»§ç»­å¾€å®ƒçš„superclassä¸­æ‰¾;</li><li>ä¸€æ—¦æ‰¾åˆ°fooè¿™ä¸ªå‡½æ•°ï¼Œå°±å»æ‰§è¡Œå®ƒçš„å®ç°IMPï¼›</li></ol><p>ä½†è¿™ç§å®ç°æœ‰ä¸ªé—®é¢˜ï¼Œæ•ˆç‡ä½ã€‚<br><br>å¦‚æœæ¯ä¸ªæ¶ˆæ¯éƒ½éœ€è¦å°†æ•´ä¸ªæ–¹æ³•åˆ—è¡¨éå†ä¸€æ¬¡è¿™å¹¶ä¸åˆç†ï¼Œååˆ†æŸè€—æ€§èƒ½ã€‚ä½†æ˜¯å¦‚æœæŠŠç»å¸¸è¢«è°ƒç”¨çš„å‡½æ•°ç¼“å­˜ä¸‹æ¥ï¼Œé‚£å¯ä»¥å¤§å¤§æé«˜å‡½æ•°æŸ¥è¯¢çš„æ•ˆç‡ã€‚è¿™ä¹Ÿå°±æ˜¯objc_classä¸­å¦ä¸€ä¸ªé‡è¦æˆå‘˜cache_t cacheåšçš„äº‹æƒ…ã€‚<br><br>åœ¨æ‰¾åˆ°fooä¹‹åï¼Œcache_tä¼šæŠŠfooçš„æ–¹æ³•åä½œä¸ºkey ï¼Œæ–¹æ³•å®ç°ä½œä¸ºvalueç»™å­˜èµ·æ¥ã€‚å½“å†æ¬¡æ”¶åˆ°fooæ¶ˆæ¯çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥åœ¨cacheé‡Œæ‰¾åˆ°ï¼Œé¿å…å»éå†ï¼Œå¤§å¤§æé«˜äº†æ•ˆç‡ã€‚<br></p><p>æ‰€ä»¥æ¶ˆæ¯å‘é€objc_msgSendçš„å…·ä½“çš„æµç¨‹åº”è¯¥æ˜¯ï¼š<br></p><ol><li>é¦–å…ˆï¼Œé€šè¿‡objçš„isaæŒ‡é’ˆæ‰¾åˆ°å®ƒçš„class;</li><li>å¿«é€ŸæŸ¥æ‰¾ï¼šåœ¨å½“å‰ç±»çš„cacheä¸­æŸ¥æ‰¾æ–¹æ³•ï¼Œå¦‚æœæ‰¾åˆ°åˆ™è°ƒç”¨æ–¹æ³•çš„å®ç°ï¼›</li><li>æ…¢é€ŸæŸ¥æ‰¾ï¼šå¦‚æœcacheä¸­æ²¡æœ‰ï¼Œåˆ™åœ¨å½“å‰ç±»çš„æ–¹æ³•åˆ—è¡¨ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœæ‰¾åˆ°åˆ™è°ƒç”¨æ–¹æ³•çš„å®ç°ï¼Œå¹¶ä¸”cacheä¼šä»¥è¯¥æ–¹æ³•çš„æ–¹æ³•åä¸ºkeyï¼Œæ–¹æ³•çš„å®ç°ä¸ºvalueè¿›è¡Œç¼“å­˜ï¼›</li><li>å¦‚æœå½“å‰ç±»ä¸­ä¹Ÿæ²¡æœ‰æŸ¥æ‰¾åˆ°è¯¥æ–¹æ³•ï¼Œä¼šé€šè¿‡classçš„superclassæŒ‡é’ˆæ‰¾åˆ°å…¶çˆ¶ç±»ï¼Œåœ¨çˆ¶ç±»ä¸­é‡å¤ç¬¬2ï¼Œ3æ­¥éª¤ï¼Œç›´åˆ°æ‰¾åˆ°ä¸ºæ­¢ã€‚</li><li>å¦‚æœä»å½“å‰ç±»å¼€å§‹ï¼Œæ•´æ¡ç»§æ‰¿å…³ç³»é“¾çš„æ‰€æœ‰ç›¸å…³ç±»ä¸­éƒ½æ²¡æœ‰æ‰¾åˆ°è¯¥æ–¹æ³•ï¼Œåˆ™ä¼šè¿›å…¥Runtimeçš„ä¸‹ä¸€ä¸ªé˜¶æ®µ<strong>ã€Œæ¶ˆæ¯è½¬å‘ã€</strong></li></ol><img src="/runtime-3-%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/msgSend1.png" class=""><br>        <h3 id="ä¸‰ã€æ¶ˆæ¯è½¬å‘"   >          <a href="#ä¸‰ã€æ¶ˆæ¯è½¬å‘" class="heading-link"><i class="fas fa-link"></i></a>ä¸‰ã€æ¶ˆæ¯è½¬å‘</h3>      <p><strong>ã€Œæ¶ˆæ¯å‘é€ã€</strong>ä¸­æ²¡æœ‰æ‰¾åˆ°æ–¹æ³•çš„å®ç°æ—¶ï¼Œä¼šè¿›å…¥<strong>ã€Œæ¶ˆæ¯è½¬å‘ã€</strong>é˜¶æ®µã€‚<br><br>æ¶ˆæ¯è½¬å‘ä¸»è¦ç»å†ä¸‰å¤§é˜¶æ®µï¼š<strong>ã€ŒåŠ¨æ€æ–¹æ³•è§£æã€</strong>ã€<strong>ã€Œå¤‡ç”¨æ¥æ”¶è€…ã€</strong>ã€<strong>ã€Œå®Œæ•´çš„æ¶ˆæ¯è½¬å‘ã€</strong><br></p><p>1ï¼‰é¦–å…ˆæ˜¯<strong>ã€ŒåŠ¨æ€æ–¹æ³•è§£æã€</strong>ï¼ŒObjective-Cè¿è¡Œæ—¶ä¼šè°ƒç”¨ <code>+resolveInstanceMethod:</code>æˆ–è€… <code>+resolveClassMethod:</code>ï¼Œè®©ä½ æœ‰æœºä¼šæä¾›ä¸€ä¸ªå‡½æ•°å®ç°ã€‚å¦‚æœä½ æ·»åŠ äº†å‡½æ•°å¹¶è¿”å›YESï¼Œ é‚£è¿è¡Œæ—¶ç³»ç»Ÿå°±ä¼šé‡æ–°å¯åŠ¨ä¸€æ¬¡æ¶ˆæ¯å‘é€çš„è¿‡ç¨‹ã€‚<br></p><p>2ï¼‰ç„¶åæ˜¯<strong>ã€Œå¤‡ç”¨æ¥æ”¶è€…ã€</strong>ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡å®ç°äº†<code>-forwardingTargetForSelector:</code>ï¼ŒRunTime è¿™æ—¶å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œç»™ä½ æŠŠè¿™ä¸ªæ¶ˆæ¯è½¬å‘ç»™å…¶ä»–å¯¹è±¡çš„æœºä¼šã€‚<br></p><p>3ï¼‰æœ€åæ˜¯<strong>ã€Œå®Œæ•´çš„æ¶ˆæ¯è½¬å‘ã€</strong>ï¼Œé¦–å…ˆå®ƒä¼šå‘é€<code>-methodSignatureForSelector:</code>æ¶ˆæ¯è·å¾—å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹ã€‚å¦‚æœ<code>-methodSignatureForSelector:</code>è¿”å›<code>nil</code> ï¼Œ<code>Runtime</code>åˆ™ä¼šå‘å‡º <code>-doesNotRecognizeSelector:</code>æ¶ˆæ¯ï¼Œç¨‹åºè¿™æ—¶ä¹Ÿå°±æŒ‚æ‰äº†ã€‚å¦‚æœè¿”å›äº†ä¸€ä¸ªå‡½æ•°ç­¾åï¼ŒRuntimeå°±ä¼šåˆ›å»ºä¸€ä¸ª<code>NSInvocation</code> å¯¹è±¡å¹¶å‘é€ <code>-forwardInvocation:</code>æ¶ˆæ¯ç»™ç›®æ ‡å¯¹è±¡ã€‚<br></p><img src="/runtime-3-%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/msgSend2.jpg" class=""><br>        <h4 id="1ã€åŠ¨æ€æ–¹æ³•è§£æ"   >          <a href="#1ã€åŠ¨æ€æ–¹æ³•è§£æ" class="heading-link"><i class="fas fa-link"></i></a>1ã€åŠ¨æ€æ–¹æ³•è§£æ</h4>      <p>ä»£ç ç¤ºä¾‹ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SFPerson</span> : <span class="title">NSObject</span></span></span><br><span class="line">- (<span class="keyword">void</span>)run;</span><br><span class="line">+ (<span class="keyword">void</span>)run;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .m</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;SFPerson.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> resolvedMethod(<span class="keyword">id</span> obj, SEL _cmd) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;resolvedMethod&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SFPerson</span></span></span><br><span class="line"><span class="comment">//- (void)run &#123;</span></span><br><span class="line"><span class="comment">//    NSLog(@&quot;%s&quot;, __func__);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//+ (void)run &#123;</span></span><br><span class="line"><span class="comment">//    NSLog(@&quot;%s&quot;, __func__);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è±¡æ–¹æ³•</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)resolveInstanceMethod:(SEL)sel &#123;</span><br><span class="line">    <span class="keyword">if</span> (sel == <span class="keyword">@selector</span>(run)) &#123;</span><br><span class="line">        class_addMethod([<span class="keyword">self</span> <span class="keyword">class</span>], sel, (IMP)resolvedMethod, <span class="string">&quot;v@:&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> resolveInstanceMethod:sel];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»æ–¹æ³•</span></span><br><span class="line">+ (<span class="built_in">BOOL</span>)resolveClassMethod:(SEL)sel &#123;</span><br><span class="line">    <span class="keyword">if</span> (sel == <span class="keyword">@selector</span>(run)) &#123;</span><br><span class="line">        Class metaClass = objc_getMetaClass([<span class="built_in">NSStringFromClass</span>(<span class="keyword">self</span>) UTF8String]);</span><br><span class="line">        class_addMethod(metaClass , sel, (IMP)resolvedMethod, <span class="string">&quot;v@:&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> resolveClassMethod:sel];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><p>åœ¨ViewControllerä¸­ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    SFPerson *person = [SFPerson alloc];</span><br><span class="line">    [person run];</span><br><span class="line">    [SFPerson run];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°å¦‚ä¸‹ï¼š</span></span><br><span class="line">TestDemo[<span class="number">25114</span>:<span class="number">980378</span>] resolvedMethod</span><br><span class="line">TestDemo[<span class="number">25114</span>:<span class="number">980378</span>] resolvedMethod</span><br></pre></td></tr></table></div></figure>        <h4 id="2ã€å¤‡ç”¨æ¥æ”¶è€…"   >          <a href="#2ã€å¤‡ç”¨æ¥æ”¶è€…" class="heading-link"><i class="fas fa-link"></i></a>2ã€å¤‡ç”¨æ¥æ”¶è€…</h4>      <p>ä»£ç ç¤ºä¾‹ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SFAnimal</span></span></span><br><span class="line">- (<span class="keyword">void</span>)run &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">void</span>)run &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SFPerson</span> : <span class="title">NSObject</span></span></span><br><span class="line">- (<span class="keyword">void</span>)run;</span><br><span class="line">+ (<span class="keyword">void</span>)run;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .m</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;SFPerson.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;SFAnimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SFPerson</span></span></span><br><span class="line"><span class="comment">//- (void)run &#123;</span></span><br><span class="line"><span class="comment">//    NSLog(@&quot;%s&quot;, __func__);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//+ (void)run &#123;</span></span><br><span class="line"><span class="comment">//    NSLog(@&quot;%s&quot;, __func__);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è±¡æ–¹æ³•</span></span><br><span class="line">- (<span class="keyword">id</span>)forwardingTargetForSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="keyword">if</span> (aSelector == <span class="keyword">@selector</span>(run)) &#123;</span><br><span class="line">        <span class="keyword">return</span> [[SFAnimal alloc]init];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> forwardingTargetForSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç±»æ–¹æ³•</span></span><br><span class="line">+ (<span class="keyword">id</span>)forwardingTargetForSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="keyword">if</span> (aSelector == <span class="keyword">@selector</span>(run)) &#123;</span><br><span class="line">        <span class="keyword">return</span> [SFAnimal <span class="keyword">class</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> forwardingTargetForSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><p>åœ¨ViewControllerä¸­ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    SFPerson *person = [SFPerson alloc];</span><br><span class="line">    [person run];</span><br><span class="line">    [SFPerson run];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°å¦‚ä¸‹ï¼š</span></span><br><span class="line">TestDemo[<span class="number">25114</span>:<span class="number">980378</span>] -[SFAnimal run]</span><br><span class="line">TestDemo[<span class="number">25114</span>:<span class="number">980378</span>] +[SFAnimal run]</span><br></pre></td></tr></table></div></figure>        <h4 id="3ã€å®Œæ•´çš„æ¶ˆæ¯è½¬å‘"   >          <a href="#3ã€å®Œæ•´çš„æ¶ˆæ¯è½¬å‘" class="heading-link"><i class="fas fa-link"></i></a>3ã€å®Œæ•´çš„æ¶ˆæ¯è½¬å‘</h4>      <p>ä»£ç ç¤ºä¾‹ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .m</span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;SFPerson.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;SFAnimal.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SFPerson</span></span></span><br><span class="line"><span class="comment">//- (void)run &#123;</span></span><br><span class="line"><span class="comment">//    NSLog(@&quot;%s&quot;, __func__);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//+ (void)run &#123;</span></span><br><span class="line"><span class="comment">//    NSLog(@&quot;%s&quot;, __func__);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹è±¡æ–¹æ³•</span></span><br><span class="line">- (<span class="built_in">NSMethodSignature</span> *)methodSignatureForSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="keyword">if</span> (aSelector == <span class="keyword">@selector</span>(run)) &#123;</span><br><span class="line">        <span class="built_in">NSMethodSignature</span> *sign = [<span class="built_in">NSMethodSignature</span> signatureWithObjCTypes:<span class="string">&quot;v@:&quot;</span>];</span><br><span class="line">        <span class="keyword">return</span> sign;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> methodSignatureForSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)forwardInvocation:(<span class="built_in">NSInvocation</span> *)anInvocation &#123;</span><br><span class="line">    SEL sel = anInvocation.selector;</span><br><span class="line">    <span class="keyword">id</span> target = [[SFAnimal alloc]init];</span><br><span class="line">    <span class="keyword">if</span>([target respondsToSelector:sel]) &#123;</span><br><span class="line">        [anInvocation invokeWithTarget:target];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç±»æ–¹æ³•</span></span><br><span class="line">+ (<span class="built_in">NSMethodSignature</span> *)methodSignatureForSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="keyword">if</span> (aSelector == <span class="keyword">@selector</span>(run)) &#123;</span><br><span class="line">        <span class="built_in">NSMethodSignature</span> *sign = [<span class="built_in">NSMethodSignature</span> signatureWithObjCTypes:<span class="string">&quot;v@:&quot;</span>];</span><br><span class="line">        <span class="keyword">return</span> sign;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> methodSignatureForSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">void</span>)forwardInvocation:(<span class="built_in">NSInvocation</span> *)anInvocation &#123;</span><br><span class="line">    SEL sel = anInvocation.selector;</span><br><span class="line">    <span class="keyword">id</span> target = [SFAnimal <span class="keyword">class</span>];</span><br><span class="line">    <span class="keyword">if</span>([target respondsToSelector:sel]) &#123;</span><br><span class="line">        [anInvocation invokeWithTarget:target];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><p>åœ¨ViewControllerä¸­ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    SFPerson *person = [SFPerson alloc];</span><br><span class="line">    [person run];</span><br><span class="line">    [SFPerson run];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°å¦‚ä¸‹ï¼š</span></span><br><span class="line">TestDemo[<span class="number">25114</span>:<span class="number">980378</span>] -[SFAnimal run]</span><br><span class="line">TestDemo[<span class="number">25114</span>:<span class="number">980378</span>] +[SFAnimal run]</span><br></pre></td></tr></table></div></figure>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/runtime-3-%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/%E9%87%8D%E6%8B%BEiOS.jpg&quot; class=&quot;&quot;&gt;

&lt;blockquote&gt;
&lt;p&gt;å…³é”®è¯ï¼šRunTime&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="é‡æ‹¾iOS" scheme="https://jack110530.github.io/categories/%E9%87%8D%E6%8B%BEiOS/"/>
    
    
    <category term="runtime" scheme="https://jack110530.github.io/tags/runtime/"/>
    
  </entry>
  
  <entry>
    <title>RunTime(2)-Classç»“æ„åˆ†æ</title>
    <link href="https://jack110530.github.io/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/"/>
    <id>https://jack110530.github.io/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/</id>
    <published>2020-10-28T03:40:59.000Z</published>
    <updated>2020-11-10T07:26:27.668Z</updated>
    
    <content type="html"><![CDATA[<img src="/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/%E9%87%8D%E6%8B%BEiOS.jpg" class=""><blockquote><p>å…³é”®è¯ï¼šRunTime</p></blockquote><a id="more"></a><p>RunTimeç³»åˆ—æ–‡ç« :<br></p><ul><li><a href="https://jack110530.github.io/runtime-1-oc%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/">RunTime(1)-OCå¯¹è±¡çš„æœ¬è´¨</a></li><li><a href="https://jack110530.github.io/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/">RunTime(2)-Classç»“æ„åˆ†æ</a></li><li><a href="https://jack110530.github.io/runtime-3-%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/">RunTime(3)-æ¶ˆæ¯æœºåˆ¶</a></li><li><a href="https://jack110530.github.io/runtime-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/">RunTime(4)-Cacheæ–¹æ³•ç¼“å­˜</a></li><li><a href="https://jack110530.github.io/runtime-5-super%E7%9A%84%E6%9C%AC%E8%B4%A8/">RunTime(5)-superçš„æœ¬è´¨</a></li><li><a href="https://jack110530.github.io/runtime-6-%E5%AE%9E%E9%99%85%E8%BF%90%E7%94%A8/">RunTime(6)-å®é™…è¿ç”¨</a></li><li><a href="https://jack110530.github.io/runtime-7-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80/">RunTime(7)-é¢è¯•é¢˜ä¸€</a></li><li><a href="https://jack110530.github.io/runtime-8-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%BA%8C/">RunTime(8)-é¢è¯•é¢˜äºŒ</a></li></ul>        <h3 id="å‰è¨€"   >          <a href="#å‰è¨€" class="heading-link"><i class="fas fa-link"></i></a>å‰è¨€</h3>      <p>ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¬é€šè¿‡clangå°†main.mè½¬åŒ–æˆäº†main.cppï¼Œé€šè¿‡ç ”ç©¶C++ä»£ç æ¥ç ”ç©¶OCå¯¹è±¡çš„åº•å±‚ç»“æ„ã€‚<br></p><p>æˆ‘ä»¬çŸ¥é“ï¼šå®ä¾‹å¯¹è±¡ã€ç±»å¯¹è±¡ã€å…ƒç±»å¯¹è±¡ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š<br></p><img src="/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/isa.png" class=""><p>ç”±å›¾ï¼Œæˆ‘ä»¬å¯ä»¥çŒœæµ‹åˆ°ï¼š<br><br>é¦–å…ˆï¼Œä¸ç®¡å®ä¾‹å¯¹è±¡ã€ç±»å¯¹è±¡è¿˜æ˜¯å…ƒç±»å¯¹è±¡ï¼Œéƒ½æœ‰isaæŒ‡é’ˆã€‚<br><br>å…¶æ¬¡ï¼Œç±»å¯¹è±¡å’Œå…ƒç±»å¯¹è±¡ä¸­è¿˜æœ‰superclassæŒ‡é’ˆï¼ŒæŒ‡å‘çˆ¶ç±»ã€‚<br></p><p>é‚£ä¹ˆï¼ŒClasså¯¹è±¡çš„åº•å±‚ç»“æ„ï¼Œå…·ä½“æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ<br></p>        <h3 id="ä¸€ã€Classçš„ç»“æ„"   >          <a href="#ä¸€ã€Classçš„ç»“æ„" class="heading-link"><i class="fas fa-link"></i></a>ä¸€ã€Classçš„ç»“æ„</h3>      <p>Classçš„ç»“æ„å¦‚ä¸‹ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_class *Class;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_object &#123;</span><br><span class="line">Class isa;</span><br><span class="line">&#125; *<span class="keyword">id</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">struct</span> objc_class : objc_object &#123;</span><br><span class="line">    <span class="comment">// Class ISA;</span></span><br><span class="line">    Class superclass;           <span class="comment">// æŒ‡å‘çˆ¶ç±»</span></span><br><span class="line">    cache_t cache;              <span class="comment">// ç”¨äºæ–¹æ³•ç¼“å­˜</span></span><br><span class="line">    class_data_bits_t bits;     <span class="comment">// ç”¨äºè·å–å…·ä½“çš„ç±»ä¿¡æ¯</span></span><br><span class="line"></span><br><span class="line">    class_rw_t *data() &#123; </span><br><span class="line">        <span class="keyword">return</span> bits.data();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">void</span> setData(class_rw_t *newData) &#123;</span><br><span class="line">        bits.setData(newData);</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="comment">//......ä¸‹é¢çš„ä¸€å †æ–¹æ³•/å‡½æ•°ä»£ç å¯ä»¥æš‚æ—¶ä¸ç”¨å…³æ³¨</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p><strong>Class ISA</strong><br><br>objc_classç»“æ„ä½“å†…ISAæ˜¯è¢«æ³¨é‡Šçš„ï¼Œä¸ä»£è¡¨ç»“æ„ä½“å†…ä¸åŒ…å«å®ƒï¼Œå› ä¸ºobjc_classç»§æ‰¿objc_objectï¼Œæ‰€ä»¥ISAæ˜¯æ¥è‡ªäºçˆ¶ç±»ã€‚<br></p><p><strong>Class superclass</strong><br><br>æŒ‡å‘çˆ¶ç±»çš„æŒ‡é’ˆï¼Œsuperclassçš„ç»“æ„åŒæ ·æ˜¯objc_classï¼Œå› ä¸ºå®ƒæ˜¯ç»“æ„ä½“æŒ‡é’ˆï¼Œå æœ‰8ä¸ªå­—èŠ‚ã€‚<br></p><p><strong>cache_t cache</strong><br><br>cacheæ˜¯æ–¹æ³•ç¼“å­˜,æ–¹æ³•ç¼“å­˜æ¶‰åŠåˆ°æ–¹æ³•æŸ¥æ‰¾æµç¨‹ï¼Œç¼“å­˜ç­–ç•¥ï¼ŒåŠ¨æ€æ‰©å®¹ç­‰ï¼Œç‚¹å‡»<a href="https://jack110530.github.io/runtime-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/">RunTime(4)-Cacheæ–¹æ³•ç¼“å­˜</a>å¯æŸ¥çœ‹è¯¦ç»†è¯´æ˜ï¼Œè¿™é‡Œä¸å±•å¼€è®¨è®ºã€‚<br></p><p><strong>class_data_bits_t bits</strong><br><br>é‡ç‚¹è®¨è®ºè¿™éƒ¨åˆ†å†…å®¹ã€‚<br></p><p>åœ¨Classçš„ç»“æ„ä¸­ï¼Œæˆ‘ä»¬å‘ç°ï¼š<strong>bits</strong>ç”¨äºè·å–å…·ä½“çš„ç±»ä¿¡æ¯ï¼Œæœ‰æ²¡æœ‰å¾ˆçœ¼ç†Ÿçš„æ„Ÿè§‰ã€‚<br></p><p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹åœ¨Classçš„ç»“æ„ä¸­çš„è¿™ä¸€å¯¹setter/getteræ–¹æ³•:<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class_rw_t *data() &#123; </span><br><span class="line">    <span class="keyword">return</span> bits.data();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> setData(class_rw_t *newData) &#123;</span><br><span class="line">    bits.setData(newData);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ç‚¹å‡»æŸ¥çœ‹bits.data()æ–¹æ³•ï¼Œå‘ç°ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class_rw_t* data() &#123;</span><br><span class="line">    <span class="keyword">return</span> (class_rw_t *)(bits &amp; FAST_DATA_MASK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>çœ‹åˆ°è¿™é‡Œï¼Œä½ æˆ–è®¸å·²ç»å‘ç°äº†ç‚¹ç«¯å€ª<br><br>æ²¡é”™ï¼Œå’Œisa_tç±»ä¼¼ï¼Œä½¿ç”¨çš„æ˜¯å…±ç”¨ä½“+ä½åŸŸæ¥å­˜å‚¨æ›´å¤šçš„ä¿¡æ¯ã€‚<br></p><p>è·Ÿæˆ‘ä»¬ä¹‹å‰é€šè¿‡isaè·å–å¯¹è±¡åœ°å€æ“ä½œå¾ˆåƒï¼Œè¿™é‡Œæ˜¯å°†ç±»å¯¹è±¡é‡Œé¢çš„class_data_bits_t bitså’Œä¸€ä¸ªFAST_DATA_MASKè¿›è¡Œ&amp;è¿ç®—å–å¾—ã€‚è¿”å›çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œç±»å‹ä¸ºclass_rw_t *ï¼ŒæŸ¥çœ‹è¯¥ç±»å‹çš„æºç å¦‚ä¸‹ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> class_rw_t &#123;</span><br><span class="line">    <span class="comment">// Be warned that Symbolication knows the layout of this structure.</span></span><br><span class="line">    uint32_t flags;</span><br><span class="line">    uint32_t version;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> class_ro_t *ro;</span><br><span class="line"></span><br><span class="line">    method_array_t methods;         <span class="comment">// æ–¹æ³•åˆ—è¡¨</span></span><br><span class="line">    property_array_t properties;    <span class="comment">// å±æ€§åˆ—è¡¨</span></span><br><span class="line">    protocol_array_t protocols;     <span class="comment">// åè®®åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line">    Class firstSubclass;</span><br><span class="line">    Class nextSiblingClass;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *demangledName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>æˆ‘ä»¬çŸ¥é“ï¼ŒOCç±»çš„æ–¹æ³•ã€å±æ€§ã€åè®®éƒ½æ˜¯å¯ä»¥åŠ¨æ€æ·»åŠ ï¼Œä¹Ÿå°±æ˜¯å¯è¯»å¯å†™çš„ï¼Œä»ä¸Šé¢çš„æºç ä¸­ï¼Œå¯ä»¥å‘ç°ç¡®å®æ˜¯æœ‰å¯¹åº”çš„æˆå‘˜æ¥ä¿å­˜æ–¹æ³•ã€å±æ€§ã€åè®®çš„ä¿¡æ¯ã€‚è€Œä»è¯¥ç»“æ„ä½“çš„åå­—class_rw_tï¼Œä¹Ÿæš—å«äº†ä¸Šè¿°çš„æ–¹æ³•ã€å±æ€§ã€åè®®ä¿¡æ¯ï¼Œæ˜¯å¯è¯»å¯å†™çš„ã€‚<br></p><p>å¦å¤–ï¼Œæˆ‘ä»¬çŸ¥é“Classç±»é‡Œé¢çš„æˆå‘˜å˜é‡æ˜¯ä¸å¯ä»¥åŠ¨æ€æ·»åŠ çš„ï¼Œä¹Ÿå°±æ˜¯å±äºåªè¯»å†…å®¹ï¼Œç›¸åº”çš„ï¼Œå¯ä»¥æ¨æ–­const class_ro_t *ro;å°±æ˜¯æŒ‡å‘äº†è¯¥éƒ¨åˆ†å†…å®¹ä¿¡æ¯çš„æŒ‡é’ˆã€‚åŒæ ·ï¼ŒæŸ¥çœ‹å…¶æºç ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> class_ro_t &#123;</span><br><span class="line">    uint32_t flags;</span><br><span class="line">    uint32_t instanceStart;</span><br><span class="line">    uint32_t instanceSize;          <span class="comment">// instanceå¯¹è±¡å ç”¨çš„å†…å­˜ç©ºé—´</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifdef</span> __LP64__</span></span><br><span class="line">    uint32_t reserved;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> uint8_t * ivarLayout;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> * name;              <span class="comment">// ç±»å</span></span><br><span class="line">    method_list_t * baseMethodList; <span class="comment">// æ–¹æ³•åˆ—è¡¨</span></span><br><span class="line">    protocol_list_t * baseProtocols;<span class="comment">// åè®®åˆ—è¡¨</span></span><br><span class="line">    <span class="keyword">const</span> ivar_list_t * ivars;      <span class="comment">// æˆå‘˜å˜é‡åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> uint8_t * weakIvarLayout;</span><br><span class="line">    property_list_t *baseProperties;<span class="comment">//å±æ€§åˆ—è¡¨</span></span><br><span class="line"></span><br><span class="line">    method_list_t *baseMethods() <span class="keyword">const</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> baseMethodList;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ä»¥ä¸Šçš„å‘ç°éƒ½ç¬¦åˆé€»è¾‘ï¼Œä½†æ˜¯å‘ç°è¿™é‡Œé¢ä¹Ÿæœ‰è·Ÿç±»çš„æ–¹æ³•ã€å±æ€§ã€åè®®ç›¸å…³çš„ä¿¡æ¯ï¼š</p><ul><li>method_list_t * baseMethodList;</li><li>protocol_list_t * baseProtocols;</li><li>property_list_t *baseProperties;ï¼Œ</li></ul><p>è¿™è·Ÿæˆ‘ä»¬å‰é¢åœ¨class_rw_tä¸­çœ‹åˆ°çš„ï¼š</p><ul><li>method_array_t methods;</li><li>property_array_t properties;</li><li>protocol_array_t protocols;</li></ul><p>æœ‰ä½•å…³è”ï¼Ÿæœ‰ä½•ä¸åŒå‘¢ï¼Ÿå¸¦ç€è¿™äº›ç–‘é—®ï¼Œç»§ç»­å¾€ä¸‹åˆ†æã€‚<br></p><p>é¦–å…ˆï¼Œç”¨ä¸€å¼ å›¾æ€»ç»“ä¸€ä¸‹Classçš„ç»“æ„ï¼š<br></p><img src="/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/class.png" class=""><br><p>è¿™ä¸ªå›¾å¯ä»¥ç†è§£æˆç¨³å®šçŠ¶æ€ä¸‹ï¼ŒClassçš„å†…éƒ¨ç»“æ„ã€‚ä½†äº‹å®ä¸Šï¼Œåœ¨ç¨‹åºå¯åŠ¨å’Œåˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼ŒClasså¹¶ä¸æ˜¯è¿™æ ·çš„ç»“æ„ã€‚<br></p><p>åŸå› åœ¨äºï¼Œç”±äºRuntimeç‰¹æ€§ï¼ŒOCç±»çš„æ–¹æ³•ã€å±æ€§ã€åè®®éƒ½æ˜¯å¯ä»¥åŠ¨æ€æ·»åŠ çš„ã€‚æ¯”å¦‚Categoryçš„å®ç°åŸç†ã€‚<br></p><blockquote><p>é‚£ä¹ˆï¼ŒClassåœ¨ä¸åŒçŠ¶æ€ä¸‹çš„ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ</p></blockquote><p>1ã€æœ€å¼€å§‹çš„æ—¶å€™ï¼ŒClassæ˜¯æ²¡æœ‰è¯»å†™éƒ¨åˆ†çš„ï¼Œåªæœ‰åªè¯»éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯ro = (const class_ro_t *)cls-&gt;data();</p><img src="/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/rw1.png" class=""><br><p>2ã€æ¥ä¸‹æ¥ï¼Œæ‰ä¼šåˆ†é…ç©ºé—´ç»™è¯»å†™ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯rwï¼Œç„¶åé€šè¿‡rw-&gt;ro = ro;å°†class_rw_tè‡ªèº«çš„roæŒ‡é’ˆæŒ‡å‘çœŸæ­£çš„roä¿¡æ¯ã€‚</p><img src="/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/rw2.png" class=""><br><p>3ã€é€šè¿‡cls-&gt;setData(rw);å°†cls-&gt;data()è¿›è¡Œä¿®æ”¹ï¼Œå¹¶æœ€ç»ˆé€šè¿‡FAST_DATA_MASKä½œç”¨æŒ‡å‘rwã€‚</p><img src="/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/rw3.png" class=""><br><p>å›åˆ°æˆ‘ä»¬ä¸Šé¢çš„é—®é¢˜ï¼š</p><blockquote><p>class_ro_tå’Œclass_rw_tä¸­éƒ½æœ‰æ–¹æ³•åˆ—è¡¨ï¼Œå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ</p></blockquote>        <h3 id="äºŒã€class-ro-t"   >          <a href="#äºŒã€class-ro-t" class="heading-link"><i class="fas fa-link"></i></a>äºŒã€class_ro_t</h3>      <p>å®é™…ä¸Šï¼Œclass_ro_tä»£è¡¨Classçš„åªè¯»ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯Classæœ¬èº«çš„å›ºæœ‰ä¿¡æ¯ï¼Œå†ç›´æ¥ä¸€ç‚¹å°±æ˜¯æ˜¯å†™åœ¨å®ƒçš„@interfaceå’Œ@endä¹‹é—´çš„æ–¹æ³•ï¼Œå±æ€§ï¼Œç­‰ä¿¡æ¯ï¼Œå½“ç„¶æœ€é‡è¦çš„ä½œç”¨è¿˜æ˜¯å­˜æ”¾ç±»çš„æˆå‘˜å˜é‡ä¿¡æ¯ivarsï¼Œè€Œä¸”æ˜¯è¢«constä¿®é¥°è¯´æ˜æ˜¯ä¸å¯ä¿®æ”¹çš„ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆRuntimeæ— æ³•åŠ¨æ€å¢åŠ æˆå‘˜å˜é‡ï¼Œåº•å±‚ç»“æ„å†³å®šçš„ã€‚æˆ‘ä¸ªäººå°†è¿™éƒ¨åˆ†ç†è§£æˆOCçš„é™æ€ä¿¡æ¯ã€‚<br></p><p>class_ro_tä¸­çš„method_list_t * baseMethodList;//æ–¹æ³•åˆ—è¡¨ï¼Œæ˜¯ä¸€ä¸ªä¸€ç»´æ•°ç»„ï¼Œé‡Œé¢è£…çš„å°±æ˜¯è¿™ä¸ªClassæœ¬èº«çš„æ–¹æ³•ã€‚</p><img src="/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/class_ro_t.png" class=""><br>        <h3 id="ä¸‰ã€class-rw-t"   >          <a href="#ä¸‰ã€class-rw-t" class="heading-link"><i class="fas fa-link"></i></a>ä¸‰ã€class_rw_t</h3>      <p>åœ¨æœ‰äº†class_rw_tä¹‹åï¼Œä¾¿ä¼šè¿›è¡Œcategoryçš„å¤„ç†ï¼Œå°†Classæœ¬èº«çš„æ–¹æ³•åˆ—è¡¨å’Œcategoryé‡Œé¢çš„æ–¹æ³•åˆ—è¡¨å…ˆåæ”¾åˆ°class_rw_tçš„method_array_t methodsé‡Œé¢ï¼ŒClassè‡ªèº«çš„æ–¹æ³•åˆ—è¡¨ä¼šè¢«æœ€å…ˆæ”¾å…¥å…¶ä¸­ï¼Œå¹¶ä¸”ç½®äºåˆ—è¡¨çš„å°¾éƒ¨ï¼Œcategoryæ–¹æ³•åˆ—è¡¨çš„åŠ å…¥é¡ºåºç­‰åŒä¸categoryæ–‡ä»¶å‚ä¸ç¼–è¯‘çš„é¡ºåº(å¯åœ¨XCodeä¸­Build Phaseä¸­æŸ¥çœ‹)ã€‚<br></p><p>å› æ­¤ï¼Œmethod_array_t methods;æ˜¯ä¸€ä¸ªäºŒç»´æ•°ç»„ï¼Œå¦‚ä¸‹å›¾ï¼š</p><img src="/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/class_rw_t.png" class=""><br>        <h3 id="å››ã€method-t"   >          <a href="#å››ã€method-t" class="heading-link"><i class="fas fa-link"></i></a>å››ã€method_t</h3>      <p>ä¸Šé¢æˆ‘ä»¬å‰–æäº†class_rw_tã€class_ro_tè¿™ä¸¤ä¸ªé‡è¦éƒ¨åˆ†çš„ç»“æ„ï¼Œå¹¶ä¸”ä¸»è¦å…³æ³¨äº†å…¶ä¸­çš„æ–¹æ³•åˆ—è¡¨éƒ¨åˆ†ï¼Œè€Œä»ä¸Šé¢çš„åˆ†æï¼Œå¯å‘ç°é‡Œé¢æœ€åŸºæœ¬ä¹Ÿæ˜¯é‡è¦çš„å•ä½æ˜¯method_tï¼Œè¿™ä¸ªç»“æ„ä½“åŒ…å«äº†æè¿°ä¸€ä¸ªæ–¹æ³•æ‰€éœ€è¦çš„å„ç§ä¿¡æ¯ã€‚ä¸‹é¢ï¼Œå°±å¯¹å®ƒè¿›è¡Œä¸€æ¬¡å½»åº•çš„æ‰«æã€‚<br>é¦–å…ˆçœ‹ä¸€ä¸‹æºç é‡Œé¢å¯¹å®ƒçš„å®šä¹‰</p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> method_t &#123;</span><br><span class="line">    SEL name;           <span class="comment">// æ–¹æ³•å</span></span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span> *types;  <span class="comment">// å‡½æ•°ç±»å‹ç¼–ç </span></span><br><span class="line">    IMP imp;            <span class="comment">// å‡½æ•°å®ç°</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure><p><strong>IMP imp</strong><br><br>æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆï¼ˆä¹Ÿå°±æ˜¯æ–¹æ³•/å‡½æ•°å®ç°çš„åœ°å€)ï¼Œå®ƒä¹Ÿæ˜¯åœ¨objc.h é‡Œé¢è¢«å®šä¹‰çš„ï¼štypedef id _Nullable (*IMP)(id _Nonnull, SEL _Nonnull, â€¦);<br></p><p><strong>SEL name</strong><br><br>æˆ‘ä»¬éƒ½çŸ¥åˆ°SELæ˜¯æ–¹æ³•é€‰æ‹©å™¨ï¼Œå¯ä»¥ç†è§£æˆæ–¹æ³•çš„åå­—ï¼Œä½†æ˜¯å®ƒåˆ°åº•æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿå…¶å®ï¼Œä»–æ˜¯åœ¨objc.h é‡Œé¢è¢«å®šä¹‰çš„ï¼štypedef struct objc_selector *SEL;ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆç±»å‹ï¼ŒæŒ‡å‘äº†ç»“æ„ä½“ç±»å‹struct objc_selectorï¼Œå¾ˆé—æ†¾è‹¹æœæ²¡æœ‰å¯¹å…¶å¼€æºï¼Œä½†æ˜¯è¯·çœ‹ä¸‹é¢çš„ä»£ç <br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,<span class="keyword">@selector</span>(test));</span><br><span class="line">&#125;</span><br><span class="line">-(<span class="keyword">void</span>)test &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,__func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°ï¼š</span></span><br><span class="line">TestDemo[<span class="number">14522</span>:<span class="number">434952</span>] test</span><br></pre></td></tr></table></div></figure><p>ä»ç»“æœçœ‹ï¼Œåˆ©ç”¨testæ–¹æ³•çš„SELæŒ‡é’ˆè¿›è¡Œæ‰“å°ï¼Œè¾“å‡ºäº†testå­—ç¬¦ä¸²ï¼Œè¯´æ˜ç»“æ„ä½“struct objc_selectorå†…éƒ¨åŒ…å«äº†ä¸€ä¸ªchar *çš„æˆå‘˜å˜é‡ï¼Œå¹¶ä¸”åº”è¯¥æ˜¯è¯¥ç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªæˆå‘˜ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥ç”¨å­—ç¬¦ä¸²æ¥ç†è§£SELï¼Œå®ƒä¸»è¦çš„ä½œç”¨å°±æ˜¯ç”¨æ¥è¡¨ç¤ºæ–¹æ³•çš„åå­—ã€‚å®ƒä¸å­—ç¬¦ä¸²ä¹‹é—´å¯é€šè¿‡å¦‚ä¸‹æ–¹æ³•è½¬æ¢ï¼š</p><ul><li>å¯ä»¥é€šè¿‡@selector()å’Œsel_registerName()å°†å­—ç¬¦ä¸²è½¬æ¢æˆSELï¼›</li><li>å¯ä»¥é€šè¿‡sel_getName()å’ŒNSStringFromSelector()å°†SELè½¬æ¢æˆå­—ç¬¦ä¸²ï¼›</li><li>ä¸åŒç±»ä¸­çš„ç›¸åŒåå­—çš„æ–¹æ³•ï¼Œæ‰€å¯¹åº”çš„SELæ˜¯ç›¸åŒçš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¯¹äºXXXæ–¹æ³•æ¥è¯´ï¼Œå®ƒä»¬çš„SELéƒ½æŒ‡å‘å†…å­˜é‡ŒåŒä¸€ä¸ªstruct objc_selectorç»“æ„ä½“å¯¹è±¡ï¼Œä¸è®ºæœ‰å¤šå°‘ä¸ªç±»é‡Œé¢å®šä¹‰äº†è¯¥XXXæ–¹æ³•ï¼›</li></ul><p>const char *types<br><br>å‡½æ•°ç±»å‹ç¼–ç ï¼ˆåŒ…æ‹¬è¿”å›å€¼ç±»å‹ã€å‚æ•°ç±»å‹ï¼‰ï¼ŒiOSæä¾›äº†ä¸€ä¸ª@encodeæŒ‡ä»¤ï¼Œå¯ä»¥å°†å…·ä½“çš„ç±»å‹è¡¨ç¤ºæˆå­—ç¬¦ä¸²ç¼–ç ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡å­—ç¬¦ä¸²æ¥è¡¨ç¤ºç±»å‹ã€‚ä¸»è¦ç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿è¿è¡Œæ—¶ï¼Œå°†å‡½æ•°çš„è¿”å›å€¼å’Œå‚æ•°çš„ç±»å‹é€šè¿‡å­—ç¬¦ä¸²æ¥æè¿°å¹¶ä¸”å­˜å‚¨ã€‚è¯·çœ‹å¦‚ä¸‹ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"> <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,<span class="keyword">@encode</span>(<span class="keyword">int</span>));</span><br><span class="line"> <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,<span class="keyword">@encode</span>(<span class="keyword">float</span>));</span><br><span class="line"> <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,<span class="keyword">@encode</span>(<span class="keyword">int</span> *));</span><br><span class="line"> <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,<span class="keyword">@encode</span>(<span class="keyword">id</span>));</span><br><span class="line"> <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,<span class="keyword">@encode</span>(<span class="keyword">void</span>));</span><br><span class="line"> <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,<span class="keyword">@encode</span>(SEL));</span><br><span class="line"> <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>,<span class="keyword">@encode</span>(<span class="keyword">float</span> *));</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰“å°å¦‚ä¸‹ï¼š</span></span><br><span class="line">TestDemo[<span class="number">14620</span>:<span class="number">442479</span>] i</span><br><span class="line">TestDemo[<span class="number">14620</span>:<span class="number">442479</span>] f</span><br><span class="line">TestDemo[<span class="number">14620</span>:<span class="number">442479</span>] ^i</span><br><span class="line">TestDemo[<span class="number">14620</span>:<span class="number">442479</span>] @</span><br><span class="line">TestDemo[<span class="number">14620</span>:<span class="number">442479</span>] v</span><br><span class="line">TestDemo[<span class="number">14620</span>:<span class="number">442479</span>] :</span><br><span class="line">TestDemo[<span class="number">14620</span>:<span class="number">442479</span>] ^f</span><br></pre></td></tr></table></div></figure><p>ä»ä¸Šé¢çš„æ‰“å°å¯ä»¥çœ‹å‡ºå„ç§ä¸åŒçš„ç±»å‹æ‰€å¯¹åº”çš„å­—ç¬¦ä¸²è¡¨è¾¾ã€‚OCçš„æ–¹æ³•çš„ç±»å‹ä¹Ÿæ˜¯æŒ‰ç…§è¿™ä¸ªæ–¹æ³•æ¥è¡¨ç¤ºçš„ï¼Œåªä¸è¿‡æ˜¯æŠŠæ–¹æ³•é‡Œé¢çš„è¿”å›å€¼å’Œå‚æ•°çš„ç±»å‹ç»„åˆèµ·æ¥è¡¨ç¤ºã€‚<br></p><p>ä¾‹å¦‚<code>- (int)test:(int)age height:(float)height</code>ï¼Œæˆ‘ä»¬çŸ¥é“OCæ–¹æ³•å¯¹åº”çš„åº•å±‚å‡½æ•°å‰ä¸¤ä¸ªæ˜¯é»˜è®¤å‚æ•°id self å’ŒSEL cmdï¼Œé‚£ä¹ˆåˆšæ‰çš„æ–¹æ³•ä»å·¦åˆ°å³ï¼Œè¿”å›å€¼å’Œå‚æ•°çš„ç±»å‹åˆ†åˆ«ä¸ºint-&gt;id-&gt;SEL-&gt;int-&gt;floatï¼Œè½¬æ¢æˆç±»å‹ç¼–ç ï¼Œå°±æ˜¯i-@-:-i-fï¼Œè€Œæœ€ç»ˆç³»ç»Ÿæ˜¯è¿™æ ·è¡¨ç¤ºçš„i24@0:8i16f20ï¼Œä½ åº”è¯¥ä¼šå¥½å¥‡ï¼Œé‡Œé¢æ€ä¹ˆå¤šäº†ä¸€äº›æ•°å­—ï¼Œå…¶å®å®ƒä»¬æ˜¯ç”¨æ¥æè¿°å‡½æ•°çš„å‚æ•°çš„é•¿åº¦å’Œä½ç½®çš„çš„ï¼Œä»å·¦åˆ°å³å¯ä»¥è¿™ä¹ˆè§£è¯»ï¼š</p><figure class="highlight plain"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">i â€”â€” å‡½æ•°çš„è¿”å›å€¼ç±»å‹ä¸ºint</span><br><span class="line">24 â€”â€” å‚æ•°æ‰€å çš„æ€»é•¿åº¦ï¼ˆ24å­—èŠ‚ï¼‰</span><br><span class="line">@ â€”â€” ç¬¬ä¸€ä¸ªå‚æ•°id</span><br><span class="line">0 â€”â€” ç¬¬ä¸€ä¸ªå‚æ•°åœ¨å†…å­˜ä¸­çš„èµ·å§‹åç§»é‡ï¼ˆ0å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯ä»ç¬¬0ä¸ªå­—èŠ‚å¼€å§‹ç®—èµ·ï¼‰</span><br><span class="line">: â€”â€” ç¬¬äºŒä¸ªå‚æ•°SEL</span><br><span class="line">8 â€”â€” ç¬¬äºŒä¸ªå‚æ•°åœ¨å†…å­˜ä¸­çš„èµ·å§‹åç§»é‡ï¼ˆ8å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯ä»ç¬¬8ä¸ªå­—èŠ‚å¼€å§‹ç®—èµ·,å› æ­¤ä¸Šé¢çš„idå‚æ•°å ä¹‹å‰çš„8ä¸ªå­—èŠ‚ï¼‰</span><br><span class="line">i â€”â€” ç¬¬ä¸‰ä¸ªå‚æ•°int</span><br><span class="line">16 â€”â€” ç¬¬ä¸‰ä¸ªå‚æ•°åœ¨å†…å­˜ä¸­çš„èµ·å§‹åç§»é‡ï¼ˆ16å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯ä»ç¬¬16ä¸ªå­—èŠ‚å¼€å§‹ç®—èµ·ï¼Œå› æ­¤ä¸Šé¢çš„SELå‚æ•°å ç”¨äº†ä¹‹å‰çš„8ä¸ªå­—èŠ‚ï¼‰</span><br><span class="line">f â€”â€” ç¬¬å››ä¸ªå‚æ•°float</span><br><span class="line">20 â€”â€” ç¬¬å››ä¸ªå‚æ•°åœ¨å†…å­˜ä¸­çš„èµ·å§‹åç§»é‡ï¼ˆ20å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯ä»ç¬¬20ä¸ªå­—èŠ‚å¼€å§‹ç®—èµ·ï¼Œå› æ­¤ä¸Šé¢çš„intå‚æ•°å ç”¨äº†å‰é¢çš„4ä¸ªå­—èŠ‚ï¼Œè€Œæ€»é•¿åº¦ä¸º24ï¼Œå› æ­¤æœ€åçš„4ä¸ªå­—èŠ‚æ˜¯ç»™floatå‚æ•°ç”¨çš„ï¼‰</span><br></pre></td></tr></table></div></figure><p>å¦‚æ­¤ä¸€æ¥ï¼Œå¯¹äºä»»æ„çš„OCæ–¹æ³•ï¼Œå®ƒçš„method_té‡Œé¢çš„typeså­—ç¬¦ä¸²çš„å€¼éƒ½å¯ä»¥ä¾ç…§ä¸Šé¢çš„è¿‡ç¨‹æ¨å¯¼å‡ºæ¥äº†ã€‚ä½ åœ¨è‹¹æœå®˜æ–¹æ–‡æ¡£æœç´¢Type Encodingå°±å¯ä»¥æ‰¾åˆ°æ›´å…·ä½“çš„ä»‹ç»ï¼Œé‡Œé¢æœ‰æ‰€æœ‰å‚æ•°ç±»å‹å¯¹åº”çš„å­—ç¬¦ä¸²è¡¨è¾¾å¯¹ç…§è¡¨ã€‚</p><img src="/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/encoding.png" class=""><br><p>æ ¹æ®ä¸Šé¢çš„ç ”ç©¶ï¼Œmethod_té‡Œé¢çš„ä¸‰ä¸ªæˆå‘˜å˜é‡å°±æä¾›äº†æˆ‘ä»¬å¯¹äºä¸€ä¸ªOCæ–¹æ³•æ‰€éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå…³äºmethod_tçš„è§£è¯»å°±æš‚åˆ°è¿™é‡Œã€‚</p><hr><p>[ç›¸å…³å‚è€ƒ]<br/></p><ol><li><span class="exturl"><a class="exturl__link"   href="https://blog.csdn.net/u013480070/article/details/100155849" >Runtimeç¬”è®°ï¼ˆäºŒï¼‰â€”â€” Classç»“æ„çš„æ·±å…¥åˆ†æ</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> </li></ol>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/%E9%87%8D%E6%8B%BEiOS.jpg&quot; class=&quot;&quot;&gt;

&lt;blockquote&gt;
&lt;p&gt;å…³é”®è¯ï¼šRunTime&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="é‡æ‹¾iOS" scheme="https://jack110530.github.io/categories/%E9%87%8D%E6%8B%BEiOS/"/>
    
    
    <category term="runtime" scheme="https://jack110530.github.io/tags/runtime/"/>
    
  </entry>
  
  <entry>
    <title>RunTime(1)-OCå¯¹è±¡çš„æœ¬è´¨</title>
    <link href="https://jack110530.github.io/runtime-1-oc%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/"/>
    <id>https://jack110530.github.io/runtime-1-oc%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/</id>
    <published>2020-10-28T03:40:43.000Z</published>
    <updated>2020-11-10T07:26:27.693Z</updated>
    
    <content type="html"><![CDATA[<img src="/runtime-1-oc%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/%E9%87%8D%E6%8B%BEiOS.jpg" class=""><blockquote><p>å…³é”®è¯ï¼šRunTime</p></blockquote><a id="more"></a><p>RunTimeç³»åˆ—æ–‡ç« :<br></p><ul><li><a href="https://jack110530.github.io/runtime-1-oc%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/">RunTime(1)-OCå¯¹è±¡çš„æœ¬è´¨</a></li><li><a href="https://jack110530.github.io/runtime-2-class%E7%BB%93%E6%9E%84%E5%88%86%E6%9E%90/">RunTime(2)-Classç»“æ„åˆ†æ</a></li><li><a href="https://jack110530.github.io/runtime-3-%E6%B6%88%E6%81%AF%E6%9C%BA%E5%88%B6/">RunTime(3)-æ¶ˆæ¯æœºåˆ¶</a></li><li><a href="https://jack110530.github.io/runtime-cache%E6%96%B9%E6%B3%95%E7%BC%93%E5%AD%98/">RunTime(4)-Cacheæ–¹æ³•ç¼“å­˜</a></li><li><a href="https://jack110530.github.io/runtime-5-super%E7%9A%84%E6%9C%AC%E8%B4%A8/">RunTime(5)-superçš„æœ¬è´¨</a></li><li><a href="https://jack110530.github.io/runtime-6-%E5%AE%9E%E9%99%85%E8%BF%90%E7%94%A8/">RunTime(6)-å®é™…è¿ç”¨</a></li><li><a href="https://jack110530.github.io/runtime-7-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%B8%80/">RunTime(7)-é¢è¯•é¢˜ä¸€</a></li><li><a href="https://jack110530.github.io/runtime-8-%E9%9D%A2%E8%AF%95%E9%A2%98%E4%BA%8C/">RunTime(8)-é¢è¯•é¢˜äºŒ</a></li></ul>        <h3 id="å‰è¨€"   >          <a href="#å‰è¨€" class="heading-link"><i class="fas fa-link"></i></a>å‰è¨€</h3>      <ol><li>OCå¯¹è±¡çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘å“ªé‡Œï¼Ÿ</li><li>ä¸€ä¸ªNSObjectå¯¹è±¡å ç”¨å¤šå°‘å†…å­˜ï¼Ÿ</li></ol>        <h3 id="ä¸€ã€RunTime-ç®€ä»‹"   >          <a href="#ä¸€ã€RunTime-ç®€ä»‹" class="heading-link"><i class="fas fa-link"></i></a>ä¸€ã€RunTime ç®€ä»‹</h3>      <p>é¦–å…ˆï¼ŒOCæ˜¯ä¸€ç§åŠ¨æ€æ€§æ¯”è¾ƒå¼ºçš„è¯­è¨€ï¼Œå®ƒæ˜¯å¯¹Cè¯­è¨€è¿›è¡Œäº†æ‰©å±•ï¼Œå¹¶é›†æˆäº†smalltalkçš„åŠ¨æ€è¯­è¨€ç‰¹æ€§ï¼Œèƒ½å¤Ÿè®©ç¨‹åºåœ¨è¿è¡Œæ—¶åšæ›´å¤šçš„äº‹æƒ…ã€‚<br></p><p>Runtimeé¡¾åæ€ä¹‰ï¼Œè¿è¡Œæ—¶ã€‚æ˜¯ç”±Cå’ŒC++ã€æ±‡ç¼–å®ç°çš„ä¸€å¥—APIï¼Œæ˜¯OCé¢å‘å¯¹è±¡å’ŒåŠ¨æ€æœºåˆ¶çš„åŸºçŸ³ã€‚<br></p>        <h3 id="äºŒã€OCå¯¹è±¡çš„æœ¬è´¨"   >          <a href="#äºŒã€OCå¯¹è±¡çš„æœ¬è´¨" class="heading-link"><i class="fas fa-link"></i></a>äºŒã€OCå¯¹è±¡çš„æœ¬è´¨</h3>      <p>æˆ‘ä»¬çŸ¥é“ä»»ä½•é«˜çº§è¯­è¨€å†™å‡ºæ¥çš„ç¨‹åºæƒ³è¦åœ¨æ‰‹æœº/ç”µè„‘ä¸­æ­£å¸¸è¿è¡Œï¼Œå°±å¿…é¡»å…ˆè½¬åŒ–ä¸ºæœºå™¨è¯­è¨€ï¼Œå› ä¸ºè®¾å¤‡åªè®¤è¯†æœºå™¨è¯­è¨€ã€‚<br></p><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ—¥å¸¸å†™çš„OCä»£ç ï¼Œæœ€ç»ˆæ˜¯æ€ä¹ˆåœ¨è®¾å¤‡ä¸­æ­£å¸¸è¿è¡Œçš„å‘¢ï¼Ÿ<br></p><p>å¯ä»¥ç®€å•çš„ç†è§£ä¸ºï¼š</p><blockquote><p>Objective-C  â¡ï¸  C/C++  â¡ï¸  æ±‡ç¼–è¯­è¨€  â¡ï¸  æœºå™¨è¯­è¨€</p></blockquote><p>æ‰€ä»¥Objective-Cçš„é¢å‘å¯¹è±¡éƒ½æ˜¯åŸºäºC/C++çš„æ•°æ®ç»“æ„å®ç°çš„ï¼ŒOCå¯¹è±¡å†…éƒ¨å¯ä»¥å®¹çº³ä¸åŒæ•°æ®ç±»å‹çš„æ•°æ®ï¼Œå› æ­¤å¯ä»¥æ¨æ–­OCå¯¹è±¡çš„åº•å±‚æ•°æ®ç»“æ„å°±æ˜¯<strong>ç»“æ„ä½“</strong>ã€‚<br></p><p>æ—¢ç„¶å¦‚æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨LLVMç¼–è¯‘å™¨å‰ç«¯clangä¸­-rewrite-objcå°†æˆ‘ä»¬çš„OCä»£ç è½¬ä¸ºC/C++å®ç°ï¼Œæ¥ç ”ç©¶OCå¯¹è±¡çš„æœ¬è´¨ã€‚<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">clang -rewrite-objc main.m -o main.cpp</span><br></pre></td></tr></table></div></figure><p>ç”±äºä¸åŒå¹³å°æ”¯æŒçš„ä»£ç è‚¯å®šæ˜¯ä¸ä¸€æ ·çš„ï¼Œç›®å‰æˆ‘ä»¬å…³æ³¨ç‚¹æ˜¯iOSå¼€å‘ï¼Œå»ºè®®åœ¨å°†OCä»£ç è½¬æˆC/C++ä»£ç æŒ‡å®šå¹³å°ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// -sdk:æŒ‡å®šsdk</span></span><br><span class="line"><span class="comment">// -arch:æŒ‡å®šæœºå™¨cpuæ¶æ„ï¼ˆæ¨¡æ‹Ÿå™¨-i386ã€32bitã€64bit-arm64 ï¼‰</span></span><br><span class="line"><span class="comment">// å¦‚æœéœ€è¦é“¾æ¥å…¶ä»–æ¡†æ¶ï¼Œä½¿ç”¨-frameworkå‚æ•°ï¼Œæ¯”å¦‚-framework UIKit</span></span><br><span class="line">xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc &lt;OCæºæ–‡ä»¶&gt; -o &lt;è¾“å‡ºçš„cppæ–‡ä»¶&gt;</span><br></pre></td></tr></table></div></figure><p>é€šè¿‡ç”Ÿæˆçš„C/C++ä»£ç ï¼Œæˆ‘ä»¬ç¼–å†™çš„OCå¯¹è±¡NSObjectçš„åº•å±‚å®ç°ä¸º:</p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_class *Class;</span><br><span class="line"><span class="comment">// NSObjectçš„åº•å±‚å®ç°</span></span><br><span class="line"><span class="keyword">struct</span> <span class="built_in">NSObject_IMPL</span> &#123;</span><br><span class="line">    Class isa;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>        <h3 id="ä¸‰ã€isaè¯¦è§£"   >          <a href="#ä¸‰ã€isaè¯¦è§£" class="heading-link"><i class="fas fa-link"></i></a>ä¸‰ã€isaè¯¦è§£</h3>      <p>å¼€å‘ä¸­ï¼Œå¸¸ç”¨çš„å¯¹è±¡æœ‰ä¸‰ç±»ï¼š</p><ul><li>å®ä¾‹å¯¹è±¡ï¼ˆinstanceï¼‰</li><li>ç±»å¯¹è±¡ï¼ˆclassï¼‰</li><li>å…ƒç±»å¯¹è±¡ï¼ˆmeta-classï¼‰</li></ul><p>ä¸ç®¡æ˜¯å“ªç§ç±»å‹çš„å¯¹è±¡ï¼Œå…¶æœ¬è´¨éƒ½æ˜¯objc_objectç»“æ„ä½“ï¼Œå†…éƒ¨éƒ½æœ‰ä¸€ä¸ªisaæŒ‡é’ˆã€‚<br></p><p>åœ¨æ—©æœŸçš„Runtimeé‡Œé¢ï¼ŒisaæŒ‡é’ˆç›´æ¥æŒ‡å‘class/meta-classå¯¹è±¡çš„åœ°å€ï¼Œisaå°±æ˜¯ä¸€ä¸ªæ™®é€šçš„æŒ‡é’ˆã€‚<br></p><p>åæ¥ï¼Œè‹¹æœä»ARM64ä½æ¶æ„å¼€å§‹ï¼Œå¯¹isaè¿›è¡Œäº†ä¼˜åŒ–ï¼Œå°†å…¶å®šä¹‰æˆä¸€ä¸ª<strong>å…±ç”¨ä½“</strong>ï¼ˆunionï¼‰ç»“æ„ï¼Œç»“åˆ <strong>ä½åŸŸ</strong> çš„æ¦‚å¿µä»¥åŠ ä½è¿ç®— çš„æ–¹å¼æ¥å­˜å‚¨æ›´å¤šç±»ç›¸å…³ä¿¡æ¯ã€‚isaæŒ‡é’ˆéœ€è¦é€šè¿‡ä¸ä¸€ä¸ªå«ISA_MASKçš„å€¼ï¼ˆæ©ç ï¼‰è¿›è¡ŒäºŒè¿›åˆ¶&amp;è¿ç®—ï¼Œæ‰èƒ½å¾—åˆ°çœŸå®çš„class/meta-classå¯¹è±¡çš„åœ°å€ã€‚<br></p><p>é¦–å…ˆä»æºç è§’åº¦ï¼Œå¯¹æ¯”ä¸€ä¸‹å˜åŒ–isaä¼˜åŒ–å‰åçš„å˜åŒ–ã€‚<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_class *Class;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">struct</span> objc_object &#123;</span><br><span class="line">Class isa;</span><br><span class="line">&#125; *<span class="keyword">id</span>;</span><br></pre></td></tr></table></div></figure><p>ä¸Šé¢æ˜¯64ä½ä¹‹å‰ï¼Œobjc_objectçš„å®šä¹‰å¦‚ä¸Šï¼Œisaç›´æ¥æŒ‡å‘objc_classã€‚<br></p><p>å†çœ‹çœ‹ä¼˜åŒ–åobjc_objectçš„å®šä¹‰:<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">struct</span> objc_object &#123;</span><br><span class="line">private:</span><br><span class="line">    isa_t isa;</span><br><span class="line"></span><br><span class="line">public:</span><br><span class="line"><span class="comment">// ....</span></span><br></pre></td></tr></table></div></figure><p>arm64å¼€å§‹ï¼Œisaçš„ç±»å‹å˜æˆäº†isa_tï¼Œè¿™æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿè¿™ä¸ªå°±æ˜¯æ¥ä¸‹æ¥è®¨è®ºçš„é‡ç‚¹ï¼Œå…ˆçœ‹ä¸€ä¸‹å®ƒçš„æºç ã€‚<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span> isa_t </span><br><span class="line">&#123;</span><br><span class="line">    isa_t() &#123; &#125;</span><br><span class="line">    isa_t(uintptr_t value) : bits(value) &#123; &#125;</span><br><span class="line"></span><br><span class="line">    Class cls;</span><br><span class="line">    uintptr_t bits;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> SUPPORT_PACKED_ISA</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># <span class="meta-keyword">if</span> __arm64__</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_MASK        0x0000000ffffffff8ULL</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_MAGIC_MASK  0x000003f000000001ULL</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_MAGIC_VALUE 0x000001a000000001ULL</span></span><br><span class="line">    <span class="keyword">struct</span> &#123;</span><br><span class="line">        uintptr_t nonpointer        : <span class="number">1</span>;</span><br><span class="line">        uintptr_t has_assoc         : <span class="number">1</span>;</span><br><span class="line">        uintptr_t has_cxx_dtor      : <span class="number">1</span>;</span><br><span class="line">        uintptr_t shiftcls          : <span class="number">33</span>; <span class="comment">// MACH_VM_MAX_ADDRESS 0x1000000000</span></span><br><span class="line">        uintptr_t magic             : <span class="number">6</span>;</span><br><span class="line">        uintptr_t weakly_referenced : <span class="number">1</span>;</span><br><span class="line">        uintptr_t deallocating      : <span class="number">1</span>;</span><br><span class="line">        uintptr_t has_sidetable_rc  : <span class="number">1</span>;</span><br><span class="line">        uintptr_t extra_rc          : <span class="number">19</span>;</span><br><span class="line"><span class="meta">#       <span class="meta-keyword">define</span> RC_ONE   (1ULL&lt;&lt;45)</span></span><br><span class="line"><span class="meta">#       <span class="meta-keyword">define</span> RC_HALF  (1ULL&lt;&lt;18)</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta"># <span class="meta-keyword">elif</span> __x86_64__</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_MASK        0x00007ffffffffff8ULL</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_MAGIC_MASK  0x001f800000000001ULL</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_MAGIC_VALUE 0x001d800000000001ULL</span></span><br><span class="line">    <span class="keyword">struct</span> &#123;</span><br><span class="line">        uintptr_t nonpointer        : <span class="number">1</span>;</span><br><span class="line">        uintptr_t has_assoc         : <span class="number">1</span>;</span><br><span class="line">        uintptr_t has_cxx_dtor      : <span class="number">1</span>;</span><br><span class="line">        uintptr_t shiftcls          : <span class="number">44</span>; <span class="comment">// MACH_VM_MAX_ADDRESS 0x7fffffe00000</span></span><br><span class="line">        uintptr_t magic             : <span class="number">6</span>;</span><br><span class="line">        uintptr_t weakly_referenced : <span class="number">1</span>;</span><br><span class="line">        uintptr_t deallocating      : <span class="number">1</span>;</span><br><span class="line">        uintptr_t has_sidetable_rc  : <span class="number">1</span>;</span><br><span class="line">        uintptr_t extra_rc          : <span class="number">8</span>;</span><br><span class="line"><span class="meta">#       <span class="meta-keyword">define</span> RC_ONE   (1ULL&lt;&lt;56)</span></span><br><span class="line"><span class="meta">#       <span class="meta-keyword">define</span> RC_HALF  (1ULL&lt;&lt;7)</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta"># <span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">error</span> unknown architecture for packed isa</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// SUPPORT_PACKED_ISA</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> SUPPORT_INDEXED_ISA</span></span><br><span class="line"></span><br><span class="line"><span class="meta"># <span class="meta-keyword">if</span>  __ARM_ARCH_7K__ &gt;= 2</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_INDEX_IS_NPI      1</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_INDEX_MASK        0x0001FFFC</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_INDEX_SHIFT       2</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_INDEX_BITS        15</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_INDEX_COUNT       (1 &lt;&lt; ISA_INDEX_BITS)</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_INDEX_MAGIC_MASK  0x001E0001</span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">define</span> ISA_INDEX_MAGIC_VALUE 0x001C0001</span></span><br><span class="line">    <span class="keyword">struct</span> &#123;</span><br><span class="line">        uintptr_t nonpointer        : <span class="number">1</span>;</span><br><span class="line">        uintptr_t has_assoc         : <span class="number">1</span>;</span><br><span class="line">        uintptr_t indexcls          : <span class="number">15</span>;</span><br><span class="line">        uintptr_t magic             : <span class="number">4</span>;</span><br><span class="line">        uintptr_t has_cxx_dtor      : <span class="number">1</span>;</span><br><span class="line">        uintptr_t weakly_referenced : <span class="number">1</span>;</span><br><span class="line">        uintptr_t deallocating      : <span class="number">1</span>;</span><br><span class="line">        uintptr_t has_sidetable_rc  : <span class="number">1</span>;</span><br><span class="line">        uintptr_t extra_rc          : <span class="number">7</span>;</span><br><span class="line"><span class="meta">#       <span class="meta-keyword">define</span> RC_ONE   (1ULL&lt;&lt;25)</span></span><br><span class="line"><span class="meta">#       <span class="meta-keyword">define</span> RC_HALF  (1ULL&lt;&lt;6)</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta"># <span class="meta-keyword">else</span></span></span><br><span class="line"><span class="meta">#   <span class="meta-keyword">error</span> unknown architecture for indexed isa</span></span><br><span class="line"><span class="meta"># <span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// SUPPORT_INDEXED_ISA</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></div></figure><p>é€šè¿‡ä½è¿ç®—å’Œä½åŸŸä»¥åŠè”åˆä½“æŠ€æœ¯ï¼Œæ›´åŠ å……åˆ†çš„åˆ©ç”¨äº†isaçš„å†…å­˜ç©ºé—´ï¼Œå°†å¯¹è±¡çš„çœŸæ­£çš„åœ°å€å­˜æ”¾åœ¨äº†isaå†…å­˜çš„å…¶ä¸­33ä½ä¸Šé¢ï¼Œå…¶ä½™çš„31ä½è¢«ç”¨æ¥å­˜æ”¾å¯¹è±¡ç›¸å…³çš„å…¶ä»–ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯isaå…¶ä»–ä½ä¸Šçš„ä½œç”¨è¯´æ˜ï¼š<br></p><ul><li><strong>nonpointer</strong> <ul><li>0ï¼Œä»£è¡¨æ™®é€šæŒ‡é’ˆï¼Œå­˜å‚¨ç€classã€meta-classå¯¹è±¡çš„å†…å­˜åœ°å€ï¼›</li><li>1ï¼Œä»£è¡¨ä¼˜åŒ–è¿‡ï¼Œä½¿ç”¨ä½åŸŸå­˜å‚¨æ›´å¤šä¿¡æ¯ï¼›</li></ul></li><li><strong>has_assoc</strong> æ˜¯å¦è®¾ç½®è¿‡å…³è”å¯¹è±¡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ–½æ”¾æ—¶ä¼šé€Ÿåº¦æ›´å¿«ï¼›</li><li><strong>has_cxx_dtor</strong> æ˜¯å¦æœ‰C++çš„ç¨€æ„å‡½æ•°ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ–½æ”¾æ—¶ä¼šæ›´å¿«ï¼›</li><li><strong>shiftcls</strong> è¿™ä¸ªéƒ¨åˆ†å­˜å‚¨çš„æ˜¯çœŸæ­£çš„Classã€Meta-Classå¯¹è±¡çš„å†…å­˜åœ°å€ä¿¡æ¯ï¼Œå› æ­¤è¦é€šè¿‡ isa &amp; ISA_MASKæ‰èƒ½å–å‡ºè¿™é‡Œ33ä½çš„å€¼ï¼Œå¾—åˆ°å¯¹è±¡çš„çœŸæ­£åœ°å€ï¼›</li><li><strong>magic</strong> ç”¨äºåœ¨è°ƒè¯•çš„æ—¶å€™åˆ†è¾¨å¯¹è±¡æ˜¯å¦å®Œæˆäº†åˆå§‹åŒ–ï¼›</li><li><strong>weekly_referenced</strong> æ˜¯å¦è¢«å¼±é¥®ç”¨æŒ‡é’ˆæŒ‡å‘è¿‡ï¼Œå¦‚æœæ²¡æœ‰ï¼Œé‡Šæ”¾æ—¶ä¼šæ›´å¿«ï¼›</li><li><strong>extra_rc</strong> é‡Œé¢å­˜å‚¨çš„å€¼æ˜¯ å¼•ç”¨è®¡æ•°å€¼-1ï¼›</li><li><strong>deallocating</strong> å¯¹è±¡æ˜¯å¦æ­£åœ¨è¢«é‡Šæ”¾ï¼›</li><li><strong>has_sidtable_rc</strong> å¼•ç”¨è®¡æ•°å™¨æ˜¯å¦è¿‡å¤§æ— æ³•å­˜å‚¨åœ¨isaä¸­ï¼Œè‹¥æœæ˜¯ï¼Œè¿™é‡Œå°±ä¸º1ï¼Œå¼•ç”¨è®¡æ•°å°±ä¼šè¢«å­˜å‚¨åœ¨ä¸€ä¸ªå«SideTableçš„ç±»çš„å±æ€§ä¸­ã€‚</li></ul><p><strong>è¡¥å……ï¼š</strong><br><br>ä¸ºä»€ä¹ˆä¸Šé¢çš„<strong>has_assoc</strong>ã€<strong>has_cxx_dtor</strong>ã€<strong>weekly_referenced</strong>ä¼šå½±å“å¯¹è±¡é‡Šæ”¾çš„é€Ÿåº¦å‘¢ï¼Ÿobjcæºç é‡Œé¢æœ‰ç­”æ¡ˆï¼šå¯¹è±¡åœ¨é‡Šæ”¾çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨void *objc_destructInstance(id obj)æ–¹æ³•ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/***********************************************************************</span></span><br><span class="line"><span class="comment">* objc_destructInstance</span></span><br><span class="line"><span class="comment">* Destroys an instance without freeing memory. </span></span><br><span class="line"><span class="comment">* Calls C++ destructors.</span></span><br><span class="line"><span class="comment">* Calls ARC ivar cleanup.</span></span><br><span class="line"><span class="comment">* Removes associative references.</span></span><br><span class="line"><span class="comment">* Returns `obj`. Does nothing if `obj` is nil.</span></span><br><span class="line"><span class="comment">**********************************************************************/</span></span><br><span class="line"><span class="keyword">void</span> *objc_destructInstance(<span class="keyword">id</span> obj) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (obj) &#123;</span><br><span class="line">        <span class="comment">// Read all of the flags at once for performance.</span></span><br><span class="line">        <span class="keyword">bool</span> cxx = obj-&gt;hasCxxDtor();</span><br><span class="line">        <span class="keyword">bool</span> assoc = obj-&gt;hasAssociatedObjects();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// This order is important.</span></span><br><span class="line">        <span class="keyword">if</span> (cxx) object_cxxDestruct(obj);</span><br><span class="line">        <span class="keyword">if</span> (assoc) _object_remove_assocations(obj);</span><br><span class="line">        obj-&gt;clearDeallocating();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> obj;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ä»æºç çš„æ³¨é‡Šä»¥åŠå®ç°é€»è¾‘ï¼Œå¾ˆå®¹æ˜“çœ‹å‡ºï¼Œç¨‹åºä¼š</p><ol><li>æ ¹æ®obj-&gt;hasCxxDtor()æ¥å†³å®šæ˜¯å¦è°ƒç”¨object_cxxDestruct(obj)è¿›è¡ŒC++ææ„ï¼Œ</li><li>æ ¹æ®obj-&gt;hasAssociatedObjects()æ¥å†³å®šæ˜¯å¦è°ƒç”¨_object_remove_assocations(obj)è¿›è¡Œå…³è”å¯¹è±¡å¼•ç”¨çš„ç§»é™¤ã€‚</li></ol><p>åœ¨obj-&gt;clearDeallocating();é‡Œé¢</p><p>isa.weakly_referencedå’Œisa.has_sidetable_rcä¼šå†³å®šæ˜¯å¦è¿›è¡Œweak_clear_no_lock(&amp;table.weak_table, (id)this);å’Œtable.refcnts.erase(this);æ“ä½œã€‚<br></p><p>å› æ­¤isaä¸­ä¸Šè¿°çš„è¿™å‡ ä¸ªå€¼ä¼šå½±å“åˆ°å¯¹è±¡é‡Šæ”¾çš„é€Ÿåº¦ã€‚<br></p><blockquote><p>é‚£ä¹ˆï¼Œå®ä¾‹å¯¹è±¡ï¼Œç±»å¯¹è±¡å’Œå…ƒç±»å¯¹è±¡ä¹‹é—´æœ‰ä»€ä¹ˆè”ç³»å—ï¼Ÿ</p></blockquote><img src="/runtime-1-oc%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/isa.png" class=""><p>isaæŒ‡é’ˆï¼š<br></p><ul><li>å®ä¾‹å¯¹è±¡çš„isaæŒ‡å‘ç±»å¯¹è±¡ï¼›</li><li>ç±»å¯¹è±¡çš„isaæŒ‡å‘å…ƒç±»å¯¹è±¡ï¼›</li><li>å…ƒç±»å¯¹è±¡çš„isaæŒ‡å‘åŸºç±»çš„å…ƒç±»å¯¹è±¡ï¼›</li><li>åŸºç±»å…ƒç±»å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘å®ƒè‡ªå·±ï¼›</li></ul><p>superclassæŒ‡é’ˆï¼š<br></p><ul><li>ç±»å¯¹è±¡çš„superclassæŒ‡å‘å…¶çˆ¶ç±»ç±»å¯¹è±¡ï¼›</li><li>å¦‚æœæ²¡æœ‰çˆ¶ç±»ï¼ŒsuperclassæŒ‡é’ˆä¸ºnilï¼›</li><li>å…ƒç±»å¯¹è±¡çš„superclassæŒ‡å‘å…¶çˆ¶ç±»å…ƒç±»å¯¹è±¡ï¼›</li><li>åŸºç±»çš„å…ƒç±»å¯¹è±¡çš„superclassæŒ‡å‘åŸºç±»çš„ç±»å¯¹è±¡ï¼›</li></ul>        <h3 id="å››ã€å¯¹è±¡çš„å†…å­˜å¤§å°"   >          <a href="#å››ã€å¯¹è±¡çš„å†…å­˜å¤§å°" class="heading-link"><i class="fas fa-link"></i></a>å››ã€å¯¹è±¡çš„å†…å­˜å¤§å°</h3>      <figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;malloc/malloc.h&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> main(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> * argv[]) &#123;</span><br><span class="line">    <span class="keyword">@autoreleasepool</span> &#123;</span><br><span class="line">        <span class="built_in">NSObject</span> *obj = [[<span class="built_in">NSObject</span> alloc] init];</span><br><span class="line">        <span class="comment">// è·å¾—NSObjectç±»çš„å®ä¾‹å¯¹è±¡çš„æˆå‘˜å˜é‡æ‰€å ç”¨çš„å¤§å°ï¼š8</span></span><br><span class="line">        size_t size1 = class_getInstanceSize([<span class="built_in">NSObject</span> <span class="keyword">class</span>]);</span><br><span class="line">        <span class="comment">// è·å–ä¸€ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘å†…å­˜ç©ºé—´çš„å¤§å°ï¼š16</span></span><br><span class="line">        size_t size2 =  malloc_size((__bridge <span class="keyword">const</span> <span class="keyword">void</span> *)(obj));</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;%zu, %zu&quot;</span>, size1, size2);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰“å°ï¼š8ï¼Œ16</span></span><br></pre></td></tr></table></div></figure><p><strong>æ€»ç»“ï¼š</strong><br></p><blockquote><p>class_getInstanceSize&amp;malloc_sizeçš„åŒºåˆ«?</p></blockquote><ul><li>class_getInstanceSize:è·å–ä¸€ä¸ªobjcç±»çš„å®ä¾‹çš„å®é™…å¤§å°ï¼Œè¿™ä¸ªå¤§å°å¯ä»¥ç†è§£ä¸ºåˆ›å»ºè¿™ä¸ªå®ä¾‹å¯¹è±¡è‡³å°‘éœ€è¦çš„ç©ºé—´ï¼ˆç³»ç»Ÿå®é™…ä¸ºè¿™ä¸ªå¯¹è±¡åˆ†é…çš„ç©ºé—´å¯èƒ½ä¼šæ¯”è¿™ä¸ªå¤§ï¼Œè¿™æ˜¯å‡ºäºç³»ç»Ÿå†…å­˜å¯¹é½çš„åŸå› ï¼‰ã€‚</li><li>malloc_size:å¾—åˆ°ä¸€ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜ç©ºé—´çš„å¤§å°ã€‚æˆ‘ä»¬çš„OCå¯¹è±¡å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œåˆ©ç”¨è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°è¯¥å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜å¤§å°ï¼Œä¹Ÿå°±æ˜¯ç³»ç»Ÿä¸ºè¿™ä¸ªå¯¹è±¡ï¼ˆæŒ‡é’ˆï¼‰æ‰€æŒ‡å‘å¯¹è±¡æ‰€å®é™…åˆ†é…çš„å†…å­˜å¤§å°ã€‚<br>sizeof()ï¼šè·å–ä¸€ä¸ªç±»å‹æˆ–è€…å˜é‡æ‰€å ç”¨çš„å­˜å‚¨ç©ºé—´ï¼Œè¿™æ˜¯ä¸€ä¸ªè¿ç®—ç¬¦ã€‚</li></ul><p>æ‰€ä»¥ï¼Œ[NSObject alloc]ä¹‹åï¼Œç³»ç»Ÿä¸ºå…¶åˆ†é…äº†16ä¸ªå­—èŠ‚çš„å†…å­˜ï¼Œæœ€ç»ˆobjå¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯struct NSObject_IMPLç»“æ„ä½“ï¼‰ï¼Œå®é™…ä½¿ç”¨äº†å…¶ä¸­çš„8ä¸ªå­—èŠ‚å†…å­˜ï¼Œï¼ˆä¹Ÿå°±æ˜¯å…¶å†…éƒ¨çš„é‚£ä¸ªisaæŒ‡é’ˆæ‰€ç”¨çš„8ä¸ªå­—èŠ‚ï¼Œè¿™é‡Œæˆ‘ä»¬æ˜¯åœ¨64ä½ç³»ç»Ÿä¸ºå‰æä¸‹æ¥è¯´çš„ï¼‰</p>        <h3 id="é¢è¯•é¢˜"   >          <a href="#é¢è¯•é¢˜" class="heading-link"><i class="fas fa-link"></i></a>é¢è¯•é¢˜</h3>      <hr><p>1ã€OCå¯¹è±¡çš„æœ¬è´¨æ˜¯ä»€ä¹ˆï¼Ÿ<br><br>ç­”ï¼š<br><br>åœ¨å¼€å‘ä¸­å¸¸è§çš„å¯¹è±¡æœ‰ä¸‰ç§ï¼š</p><ul><li>å®ä¾‹å¯¹è±¡ï¼ˆinstanceï¼‰</li><li>ç±»å¯¹è±¡ï¼ˆclassï¼‰</li><li>å…ƒç±»å¯¹è±¡ï¼ˆmeta-classï¼‰<br>ä¸ç®¡æ˜¯å“ªç§ç±»å‹çš„å¯¹è±¡ï¼Œå…¶æœ¬è´¨éƒ½æ˜¯objc_objectç»“æ„ä½“ï¼Œå†…éƒ¨éƒ½æœ‰ä¸€ä¸ªisaæŒ‡é’ˆã€‚</li></ul><hr><p>2ã€å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘å“ªé‡Œï¼Ÿ<br><br>ç­”ï¼š<br></p><ul><li>instanceå¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘classå¯¹è±¡</li><li>classå¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘meta-classå¯¹è±¡</li><li>meta-classå¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘åŸºç±»ï¼ˆä¹Ÿå°±æ˜¯NSObjectï¼‰çš„meta-classå¯¹è±¡</li></ul><hr><p>3ã€ä¸€ä¸ªNSObjectå¯¹è±¡å ç”¨å¤šå°‘å†…å­˜ï¼Ÿ<br><br>ç­”ï¼š<br><br>åœ¨64ä½ç³»ç»Ÿä¸­ï¼Œ[NSObject alloc]ä¹‹åï¼Œç³»ç»Ÿä¸ºå…¶åˆ†é…äº†16ä¸ªå­—èŠ‚çš„å†…å­˜ï¼Œä½†æ˜¯å®é™…ä½¿ç”¨äº†å…¶ä¸­çš„8ä¸ªå­—èŠ‚å†…å­˜ï¼Œä¹Ÿå°±æ˜¯isaæŒ‡é’ˆæ‰€ç”¨çš„8ä¸ªå­—èŠ‚ã€‚</p><hr><p>4ã€ä»¥ä¸‹ä»£ç è¾“å‡ºä»€ä¹ˆï¼Ÿ<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">BOOL</span> re1 = [(<span class="keyword">id</span>)[<span class="built_in">NSObject</span> <span class="keyword">class</span>] isKindOfClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]];</span><br><span class="line"><span class="built_in">BOOL</span> re2 = [(<span class="keyword">id</span>)[<span class="built_in">NSObject</span> <span class="keyword">class</span>] isMemberOfClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]];</span><br><span class="line"><span class="built_in">BOOL</span> re3 = [(<span class="keyword">id</span>)[SFPerson <span class="keyword">class</span>] isKindOfClass:[SFPerson <span class="keyword">class</span>]];</span><br><span class="line"><span class="built_in">BOOL</span> re4 = [(<span class="keyword">id</span>)[SFPerson <span class="keyword">class</span>] isMemberOfClass:[SFPerson <span class="keyword">class</span>]];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%hhd%hhd%hhd%hhd&quot;</span>,re1,re2,re3,re4);</span><br><span class="line"></span><br><span class="line"><span class="built_in">BOOL</span> re5 = [(<span class="keyword">id</span>)[<span class="built_in">NSObject</span> alloc] isKindOfClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]];</span><br><span class="line"><span class="built_in">BOOL</span> re6 = [(<span class="keyword">id</span>)[<span class="built_in">NSObject</span> alloc] isMemberOfClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]];</span><br><span class="line"><span class="built_in">BOOL</span> re7 = [(<span class="keyword">id</span>)[SFPerson alloc] isKindOfClass:[SFPerson <span class="keyword">class</span>]];</span><br><span class="line"><span class="built_in">BOOL</span> re8 = [(<span class="keyword">id</span>)[SFPerson alloc] isMemberOfClass:[SFPerson <span class="keyword">class</span>]];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@&quot;%hhd%hhd%hhd%hhd&quot;</span>,re5,re6,re7,re8);</span><br></pre></td></tr></table></div></figure><p>ç­”ï¼šè¾“å‡ºä¸ºï¼š1000ï¼Œ1111<br><br>é¦–å…ˆè¦çŸ¥é“isKindOfClass ä¸ isMemberOfClass çš„åŒºåˆ«ï¼š<br></p><ul><li>isKindOfClassæ¥ç¡®å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯ä¸€ä¸ªç±»çš„æˆå‘˜ï¼Œæˆ–è€…æ˜¯æ´¾ç”Ÿè‡ªè¯¥ç±»çš„æˆå‘˜;</li><li>isMemberOfClassåªèƒ½ç¡®å®šä¸€ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯å½“å‰ç±»çš„æˆå‘˜;</li></ul><p>å†æ ¹æ®isaå’Œsuperclassçš„å…³ç³»å›¾å³å¯å¾—å‡ºç­”æ¡ˆã€‚<br></p><img src="/runtime-1-oc%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/isa.png" class=""><br><p>æƒ³äº†è§£æ›´è¯¦ç»†çš„å†…å®¹è¯·ç‚¹å‡»ï¼š<a href="https://jack110530.github.io/iskindofclass%E4%B8%8Eismemberofclass%E7%9A%84%E5%8C%BA%E5%88%AB/">isKindOfClassä¸isMemberOfClassçš„åŒºåˆ«</a><br></p>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/runtime-1-oc%E5%AF%B9%E8%B1%A1%E7%9A%84%E6%9C%AC%E8%B4%A8/%E9%87%8D%E6%8B%BEiOS.jpg&quot; class=&quot;&quot;&gt;

&lt;blockquote&gt;
&lt;p&gt;å…³é”®è¯ï¼šRunTime&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="é‡æ‹¾iOS" scheme="https://jack110530.github.io/categories/%E9%87%8D%E6%8B%BEiOS/"/>
    
    
    <category term="runtime" scheme="https://jack110530.github.io/tags/runtime/"/>
    
  </entry>
  
  <entry>
    <title>Crashé˜²æŠ¤(4)-NSTimer</title>
    <link href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-4-nstimer/"/>
    <id>https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-4-nstimer/</id>
    <published>2020-10-27T05:44:15.000Z</published>
    <updated>2020-10-28T03:07:35.595Z</updated>
    
    <content type="html"><![CDATA[<img src="/crash%E9%98%B2%E6%8A%A4-4-nstimer/%E9%87%8D%E6%8B%BEiOS.jpg" class=""><br><blockquote><p>å…³é”®è¯ï¼šNSTimerã€Runloopã€å¾ªç¯å¼•ç”¨ã€NSProxy</p></blockquote><a id="more"></a><p>Crashé˜²æŠ¤ç³»åˆ—æ–‡ç« :<br></p><ul><li><a href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-1-unrecognized-selector/">Crashé˜²æŠ¤(1)-Unrecognized Selector</a></li><li><a href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-2-kvo/">Crashé˜²æŠ¤(2)-KVO</a></li><li><a href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-3-kvc/">Crashé˜²æŠ¤(3)-KVC</a></li><li><a href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-4-nstimer/">Crashé˜²æŠ¤(4)-NSTimer</a></li></ul>        <h3 id="å‰è¨€"   >          <a href="#å‰è¨€" class="heading-link"><i class="fas fa-link"></i></a>å‰è¨€</h3>      <ol><li>å¼€å‘ä¸­åˆé‡åˆ°NSTimerç›¸å…³çš„é—®é¢˜å—ï¼Œæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿ</li><li>NSTimerå¾ªç¯å¼•ç”¨æ–¹æ¡ˆ</li></ol>        <h3 id="NSTimer-Crash-çš„äº§ç”ŸåŸå› "   >          <a href="#NSTimer-Crash-çš„äº§ç”ŸåŸå› " class="heading-link"><i class="fas fa-link"></i></a>NSTimer Crash çš„äº§ç”ŸåŸå› </h3>      <p>åœ¨ç¨‹åºå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¤§å®¶ä¼šç»å¸¸ä½¿ç”¨å®šæ—¶ä»»åŠ¡ï¼Œä½†ä½¿ç”¨NSTimerçš„ scheduledTimerWithTimeInterval:target:selector:userInfo:repeats:æ¥å£åšé‡å¤æ€§çš„å®šæ—¶ä»»åŠ¡æ—¶å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šNSTimerä¼šå¼ºå¼•ç”¨targetå®ä¾‹ï¼Œæ‰€ä»¥éœ€è¦åœ¨åˆé€‚çš„æ—¶æœºinvalidateå®šæ—¶å™¨ï¼Œå¦åˆ™å°±ä¼šç”±äºå®šæ—¶å™¨timerå¼ºå¼•ç”¨targetçš„å…³ç³»å¯¼è‡´targetä¸èƒ½è¢«é‡Šæ”¾ï¼Œé€ æˆå†…å­˜æ³„éœ²ï¼Œç”šè‡³åœ¨å®šæ—¶ä»»åŠ¡è§¦å‘æ—¶å¯¼è‡´crashã€‚crashçš„å±•ç°å½¢å¼å’Œå…·ä½“çš„targetæ‰§è¡Œçš„selectoræœ‰å…³ã€‚<br></p><p>ä¸æ­¤åŒæ—¶ï¼Œå¦‚æœNSTimeræ˜¯æ— é™é‡å¤çš„æ‰§è¡Œä¸€ä¸ªä»»åŠ¡çš„è¯ï¼Œä¹Ÿæœ‰å¯èƒ½å¯¼è‡´targetçš„selectorä¸€ç›´è¢«é‡å¤è°ƒç”¨ä¸”å¤„äºæ— æ•ˆçŠ¶æ€ï¼Œå¯¹appçš„CPUï¼Œå†…å­˜ç­‰æ€§èƒ½æ–¹é¢å‡æ˜¯æ²¡æœ‰å¿…è¦çš„æµªè´¹ã€‚<br></p><p><strong>ä»£ç ç¤ºä¾‹</strong>ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&quot;TimerCrashTestVC.h&quot;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TimerCrashTestVC</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSTimer</span> *timer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">TimerCrashTestVC</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> timerWithTimeInterval:<span class="number">1</span> target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(timerEvent) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</span><br><span class="line">    [[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:<span class="keyword">self</span>.timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)timerEvent&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;å®šæ—¶å™¨äº‹ä»¶&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><p>åœ¨ViewControllerä¸­ï¼Œç‚¹å‡»æŒ‰é’®pushåˆ°TimerCrashTestVCã€‚<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TimerCrashTestVC *vc = [[TimerCrashTestVC alloc]init];</span><br><span class="line">[<span class="keyword">self</span>.navigationController pushViewController:vc animated:<span class="literal">YES</span>];</span><br></pre></td></tr></table></div></figure><p>æ§åˆ¶å°æ‰“å°å®šæ—¶å™¨äº‹ä»¶:<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span><span class="number">-10</span><span class="number">-21</span> <span class="number">10</span>:<span class="number">16</span>:<span class="number">37.877364</span>+<span class="number">0800</span> TestDemo[<span class="number">39003</span>:<span class="number">883014</span>] å®šæ—¶å™¨äº‹ä»¶</span><br><span class="line"><span class="number">2020</span><span class="number">-10</span><span class="number">-21</span> <span class="number">10</span>:<span class="number">16</span>:<span class="number">38.876337</span>+<span class="number">0800</span> TestDemo[<span class="number">39003</span>:<span class="number">883014</span>] å®šæ—¶å™¨äº‹ä»¶</span><br><span class="line"><span class="number">2020</span><span class="number">-10</span><span class="number">-21</span> <span class="number">10</span>:<span class="number">16</span>:<span class="number">39.877408</span>+<span class="number">0800</span> TestDemo[<span class="number">39003</span>:<span class="number">883014</span>] å®šæ—¶å™¨äº‹ä»¶</span><br><span class="line">...</span><br></pre></td></tr></table></div></figure><p>æ­¤æ—¶ï¼Œè‹¥popï¼ŒæŒ‰æˆ‘ä»¬æƒ³è±¡çš„æ¥è¯´ï¼ŒTimerCrashTestVCåº”è¯¥dealloc å¹¶ä¸”NSTimerä¹Ÿåº”è¯¥åœæ­¢ã€‚<br><br>ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬popæ—¶ï¼Œäº‹å®å´ä¸æˆ‘ä»¬æƒ³è±¡çš„ä¸ä¸€æ ·ï¼Œæ‰“å°å¦‚ä¸‹ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span><span class="number">-10</span><span class="number">-21</span> <span class="number">10</span>:<span class="number">16</span>:<span class="number">40.877086</span>+<span class="number">0800</span> TestDemo[<span class="number">39003</span>:<span class="number">883014</span>] å®šæ—¶å™¨äº‹ä»¶</span><br><span class="line"><span class="number">2020</span><span class="number">-10</span><span class="number">-21</span> <span class="number">10</span>:<span class="number">16</span>:<span class="number">41.877532</span>+<span class="number">0800</span> TestDemo[<span class="number">39003</span>:<span class="number">883014</span>] å®šæ—¶å™¨äº‹ä»¶</span><br><span class="line"><span class="number">2020</span><span class="number">-10</span><span class="number">-21</span> <span class="number">10</span>:<span class="number">16</span>:<span class="number">42.877496</span>+<span class="number">0800</span> TestDemo[<span class="number">39003</span>:<span class="number">883014</span>] å®šæ—¶å™¨äº‹ä»¶</span><br><span class="line">...</span><br></pre></td></tr></table></div></figure><p>TimerCrashTestVCå¹¶æ²¡æœ‰deallocï¼Œå¹¶ä¸”NSTimerä¹Ÿæ²¡æœ‰åœæ­¢ï¼ï¼ï¼<br></p><p>æœ‰äººè¯´ï¼Œéœ€è¦åœ¨deallocä¸­å°†NSTImer invalidateã€‚æ¯”å¦‚ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">    [<span class="keyword">self</span>.timer invalidate];</span><br><span class="line">    <span class="keyword">self</span>.timer = <span class="literal">nil</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>ä¸å¹¸çš„æ˜¯ï¼Œdeallocæ–¹æ³•å°†æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨ã€‚å› ä¸ºtimerçš„å¼•ç”¨ï¼ŒTimerCrashTestVCå¯¹è±¡çš„å¼•ç”¨è®¡æ•°æ°¸è¿œä¸ä¼šé™åˆ°0ï¼Œdeallocæ–¹æ³•ä¹Ÿå°±ä¸ä¼šè¢«è°ƒç”¨ï¼Œtimerä¹Ÿä¸€ç›´åœ¨æ‰§è¡Œäº‹ä»¶ã€‚<br></p><p>å…¶å®ï¼Œåœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­å¾ˆå®¹æ˜“å‡ºç°è¿™ç§é”™è¯¯ã€‚<br></p><p>æ‰€ä»¥ï¼Œå¾ˆæœ‰å¿…è¦è®¾è®¡å‡ºä¸€ç§æ–¹æ¡ˆï¼Œå¯ä»¥æœ‰æ•ˆçš„é˜²æŠ¤NSTimerçš„æ»¥ç”¨é—®é¢˜ã€‚</p>        <h3 id="NSTimer-Crash-é˜²æŠ¤æ–¹æ¡ˆ"   >          <a href="#NSTimer-Crash-é˜²æŠ¤æ–¹æ¡ˆ" class="heading-link"><i class="fas fa-link"></i></a>NSTimer Crash é˜²æŠ¤æ–¹æ¡ˆ</h3>      <p>è‹¹æœå®˜æ–¹æ–‡æ¡£ä¸­ï¼š<br></p><blockquote><p>This method is the only way to remove a timer from an NSRunLoop object. The NSRunLoop object removes its strong reference to the timer, either just before the invalidate method returns or at some later point.<br>If it was configured with target and user info objects, the receiver removes its strong references to those objects as well.<br>You must send this message from the thread on which the timer was installed. If you send this message from another thread, the input source associated with the timer may not be removed from its run loop, which could prevent the thread from exiting properly.</p></blockquote><p>å¯ä»¥çœ‹åˆ°ï¼Œå½“ä¸€ä¸ªtimerè¢«scheduleçš„æ—¶å€™ï¼Œtimerä¼šæŒæœ‰targetå¯¹è±¡ï¼ŒNSRunLoopå¯¹è±¡ä¼šæŒæœ‰timerã€‚å½“invalidateè¢«è°ƒç”¨æ—¶ï¼ŒNSRunLoopå¯¹è±¡ä¼šé‡Šæ”¾å¯¹timerçš„æŒæœ‰ï¼Œtimerä¼šé‡Šæ”¾å¯¹targetçš„æŒæœ‰ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬æ²¡æœ‰é€”å¾„å¯ä»¥é‡Šæ”¾timerå¯¹targetçš„æŒæœ‰ã€‚æ‰€ä»¥è§£å†³å†…å­˜æ³„éœ²å°±å¿…é¡»æ’¤é”€timerï¼Œè‹¥ä¸æ’¤é”€ï¼Œtargetå¯¹è±¡å°†æ°¸è¿œæ— æ³•é‡Šæ”¾ã€‚<br></p><p>ä¸Šé¢çš„åˆ†æå¯è§ï¼ŒNSTimeræ‰€äº§ç”Ÿçš„é—®é¢˜çš„ä¸»è¦åŸå› æ˜¯å› ä¸ºå…¶æ²¡æœ‰å†ä¸€ä¸ªåˆé€‚çš„æ—¶æœºinvalidateï¼ŒåŒæ—¶è¿˜æœ‰NSTimerå¯¹targetçš„å¼ºå¼•ç”¨å¯¼è‡´çš„å†…å­˜æ³„æ¼é—®é¢˜ã€‚<br></p><p>é‚£ä¹ˆè§£å†³NSTimerçš„é—®é¢˜çš„å…³é”®ç‚¹åœ¨äºä»¥ä¸‹ä¸¤ç‚¹ï¼š<br></p><ol><li>STimerå¯¹å…¶targetæ˜¯å¦å¯ä»¥ä¸å¼ºå¼•ç”¨ï¼›</li><li>æ˜¯å¦æ‰¾åˆ°ä¸€ä¸ªåˆé€‚çš„æ—¶æœºï¼Œåœ¨ç¡®å®šNSTimerå·²ç»å¤±æ•ˆçš„æƒ…å†µä¸‹ï¼Œè®©NSTimerè‡ªåŠ¨invalidateï¼›</li></ol><p>é’ˆå¯¹ç¬¬ä¸€ç‚¹ï¼Œå¯ä»¥ä½¿ç”¨NSProxyæ¶ˆæ¯è½¬å‘å®ç°ã€‚<br><br>åœ¨NSTimerå’Œtargetä¹‹é—´åŠ å…¥ä¸€å±‚proxyï¼Œproxyä¸»è¦åšä¸ºä¸€ä¸ªæ¡¥æ¥å±‚ï¼Œè´Ÿè´£NSTimerå’Œtargetä¹‹é—´çš„é€šä¿¡ã€‚<br><br>è®©NSProxyä½œä¸ºNSTimerçš„targetï¼ŒNSTimerå¼ºå¼•ç”¨ç€proxyï¼ŒåŒæ—¶proxyå¼±å¼•ç”¨çœŸæ­£çš„targetï¼Œå¹¶æŠŠæ‰€æœ‰çš„æ¶ˆæ¯è½¬å‘åˆ°çœŸæ­£çš„targetä¸Šã€‚è¿™æ ·å°±è§£å†³äº†å¾ªç¯å¼•ç”¨çš„é—®é¢˜äº†ã€‚<br></p><p>é’ˆå¯¹ç¬¬äºŒç‚¹ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸­é—´å±‚ï¼Œåœ¨æ‰§è¡Œå®šæ—¶å™¨çš„æ–¹æ³•selectorå‰åˆ¤æ–­NSTimeræ˜¯å¦å·²ç»å¤±æ•ˆã€‚<br></p><p>ç»“åˆç¬¬ä¸€ç‚¹å’Œç¬¬äºŒç‚¹æ€»ç»“ï¼Œæœ‰å¦‚ä¸‹ä»£ç ï¼š<br><br>é¦–å…ˆï¼Œå­ç±»åŒ–ä¸€ä¸ªNSProxyç”¨äºåšæ¶ˆæ¯è½¬å‘ã€‚<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SFProxy</span> : <span class="title">NSProxy</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="built_in">NSObject</span> *target;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithTarget:(<span class="keyword">id</span>)target;</span><br><span class="line">+ (<span class="keyword">instancetype</span>)proxyWithTarget:(<span class="keyword">id</span>)target;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .m</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SFProxy</span></span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithTarget:(<span class="keyword">id</span>)target &#123;</span><br><span class="line">    _target = target;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">instancetype</span>)proxyWithTarget:(<span class="keyword">id</span>)target &#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithTarget:target];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆæ¯è½¬å‘</span></span><br><span class="line">- (<span class="built_in">NSMethodSignature</span> *)methodSignatureForSelector:(SEL)aSelector&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.target &amp;&amp; [<span class="keyword">self</span>.target respondsToSelector:aSelector]) &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="keyword">self</span>.target methodSignatureForSelector:aSelector];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> methodSignatureForSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)forwardInvocation:(<span class="built_in">NSInvocation</span> *)anInvocation&#123;</span><br><span class="line">    SEL aSelector = [anInvocation selector];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.target &amp;&amp; [<span class="keyword">self</span>.target respondsToSelector:aSelector]) &#123;</span><br><span class="line">        [anInvocation invokeWithTarget:<span class="keyword">self</span>.target];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        [<span class="keyword">super</span> forwardInvocation:anInvocation];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><p>ç„¶åï¼Œå†å­ç±»åŒ–SFProxyï¼Œç”¨äºæ¥æ”¶aTargetçš„aSelectorï¼Œåœ¨æ‰§è¡Œå‰åˆ¤æ–­timeræ˜¯å¦åº”è¯¥invalidateã€‚<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SFTimerProxy</span> : <span class="title">SFProxy</span></span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithTarget:(<span class="keyword">id</span>)target aSelector:(SEL)aSelector;</span><br><span class="line">+ (<span class="keyword">instancetype</span>)proxyWithTarget:(<span class="keyword">id</span>)target aSelector:(SEL)aSelector;</span><br><span class="line">- (<span class="keyword">void</span>)fireProxyTimer:(<span class="built_in">NSTimer</span> *)timer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .m</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SFTimerProxy</span></span></span><br><span class="line">&#123;</span><br><span class="line">    SEL _aSelector;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithTarget:(<span class="keyword">id</span>)target aSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithTarget:target];</span><br><span class="line">    _aSelector = aSelector;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">instancetype</span>)proxyWithTarget:(<span class="keyword">id</span>)target aSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithTarget:target aSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)fireProxyTimer:(<span class="built_in">NSTimer</span> *)timer &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.target) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([<span class="keyword">self</span>.target respondsToSelector:_aSelector]) &#123;</span><br><span class="line">            [<span class="keyword">self</span>.target performSelector:_aSelector withObject:timer];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        [timer invalidate];</span><br><span class="line">        timer = <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span><span class="class"><span class="keyword">@implementation</span> <span class="title">SFTimerProxy</span></span></span><br><span class="line">&#123;</span><br><span class="line">    SEL _aSelector;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithTarget:(<span class="keyword">id</span>)target aSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="keyword">self</span> = [<span class="keyword">super</span> initWithTarget:target];</span><br><span class="line">    _aSelector = aSelector;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">instancetype</span>)proxyWithTarget:(<span class="keyword">id</span>)target aSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithTarget:target aSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)fireProxyTimer:(<span class="built_in">NSTimer</span> *)timer &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.target) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([<span class="keyword">self</span>.target respondsToSelector:_aSelector]) &#123;</span><br><span class="line">            [<span class="keyword">self</span>.target performSelector:_aSelector withObject:timer];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        [timer invalidate];</span><br><span class="line">        timer = <span class="literal">nil</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><p>ç¬¬ä¸‰æ­¥ï¼Œæ–°å»ºä¸€ä¸ªåˆ†ç±»NSTimer+TimerCrashã€‚<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&quot;NSTimer+TimerCrash.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;NSObject+MethodSwizzling.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;SFCrachInspector.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;SFTimerProxy.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSTimer</span> (<span class="title">TimerCrash</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// äº¤æ¢timerWithTimeInterval:target:selector:userInfo:repeats:æ–¹æ³•</span></span><br><span class="line">        [<span class="built_in">NSObject</span> sf_swizzlingClassMethod:<span class="keyword">@selector</span>(timerWithTimeInterval:target:selector:userInfo:repeats:) swizzledMethod:<span class="keyword">@selector</span>(sf_timerWithTimeInterval:target:selector:userInfo:repeats:) withClass:[<span class="built_in">NSTimer</span> <span class="keyword">class</span>]];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// äº¤æ¢scheduledTimerWithTimeInterval:target:selector:userInfo:repeats:æ–¹æ³•</span></span><br><span class="line">        [<span class="built_in">NSObject</span> sf_swizzlingClassMethod:<span class="keyword">@selector</span>(scheduledTimerWithTimeInterval:target:selector:userInfo:repeats:) swizzledMethod:<span class="keyword">@selector</span>(sf_scheduledTimerWithTimeInterval:target:selector:userInfo:repeats:) withClass:[<span class="built_in">NSTimer</span> <span class="keyword">class</span>]];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSTimer</span> *)sf_timerWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)ti target:(<span class="keyword">id</span>)aTarget selector:(SEL)aSelector userInfo:(<span class="keyword">nullable</span> <span class="keyword">id</span>)userInfo repeats:(<span class="built_in">BOOL</span>)yesOrNo &#123;</span><br><span class="line">    SFTimerProxy *proxy = [SFTimerProxy proxyWithTarget:aTarget aSelector:aSelector];</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> sf_timerWithTimeInterval:ti target:proxy selector:<span class="keyword">@selector</span>(fireProxyTimer:) userInfo:userInfo repeats:yesOrNo];</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="built_in">NSTimer</span> *)sf_scheduledTimerWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)ti target:(<span class="keyword">id</span>)aTarget selector:(SEL)aSelector userInfo:(<span class="keyword">nullable</span> <span class="keyword">id</span>)userInfo repeats:(<span class="built_in">BOOL</span>)yesOrNo &#123;</span><br><span class="line">    SFTimerProxy *proxy = [SFTimerProxy proxyWithTarget:aTarget aSelector:aSelector];</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> sf_scheduledTimerWithTimeInterval:ti target:proxy selector:<span class="keyword">@selector</span>(fireProxyTimer:) userInfo:userInfo repeats:yesOrNo];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><p>è‡³æ­¤ï¼ŒNSTimerçš„å¾ªç¯å¼•ç”¨é—®é¢˜å’ŒNSTimerçš„invalidateæ—¶æœºé—®é¢˜å°±è§£å†³äº†ã€‚<br></p><p>é‡æ–°è¿è¡Œåï¼Œpushåpopï¼Œæ‰“å°å¦‚ä¸‹ï¼š<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span><span class="number">-10</span><span class="number">-21</span> <span class="number">10</span>:<span class="number">41</span>:<span class="number">18.160033</span>+<span class="number">0800</span> TestDemo[<span class="number">39207</span>:<span class="number">898748</span>] å®šæ—¶å™¨äº‹ä»¶</span><br><span class="line"><span class="number">2020</span><span class="number">-10</span><span class="number">-21</span> <span class="number">10</span>:<span class="number">41</span>:<span class="number">19.160044</span>+<span class="number">0800</span> TestDemo[<span class="number">39207</span>:<span class="number">898748</span>] å®šæ—¶å™¨äº‹ä»¶</span><br><span class="line"><span class="number">2020</span><span class="number">-10</span><span class="number">-21</span> <span class="number">10</span>:<span class="number">41</span>:<span class="number">20.160049</span>+<span class="number">0800</span> TestDemo[<span class="number">39207</span>:<span class="number">898748</span>] å®šæ—¶å™¨äº‹ä»¶</span><br><span class="line"><span class="number">2020</span><span class="number">-10</span><span class="number">-21</span> <span class="number">10</span>:<span class="number">41</span>:<span class="number">21.100760</span>+<span class="number">0800</span> TestDemo[<span class="number">39207</span>:<span class="number">898748</span>] -[TimerCrashTestVC dealloc]</span><br></pre></td></tr></table></div></figure><p>æ­¤æ—¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦åœ¨deallocä¸­å†™NSTImer invalidateæ–¹æ³•ï¼ŒTimerCrashTestVCä¹ŸæˆåŠŸdeallocï¼ŒNSTimerä¹Ÿinvalidateäº†ã€‚<br></p><hr><p>[ä»£ç é“¾æ¥]<br/><br>GitHubï¼š<span class="exturl"><a class="exturl__link"   href="https://github.com/jack110530/SFCrash" >https://github.com/jack110530/SFCrash</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><hr><p>[ç›¸å…³å‚è€ƒ]<br/></p><ol><li><span class="exturl"><a class="exturl__link"   href="https://www.jianshu.com/p/f63395599633" >ç½‘æ˜“iOS Appè¿è¡Œæ—¶Crashè‡ªåŠ¨é˜²æŠ¤å®è·µ</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/crash%E9%98%B2%E6%8A%A4-4-nstimer/%E9%87%8D%E6%8B%BEiOS.jpg&quot; class=&quot;&quot;&gt;
&lt;br&gt;

&lt;blockquote&gt;
&lt;p&gt;å…³é”®è¯ï¼šNSTimerã€Runloopã€å¾ªç¯å¼•ç”¨ã€NSProxy&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>Crashé˜²æŠ¤(3)-KVC</title>
    <link href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-3-kvc/"/>
    <id>https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-3-kvc/</id>
    <published>2020-10-27T04:52:18.000Z</published>
    <updated>2020-10-28T03:07:35.596Z</updated>
    
    <content type="html"><![CDATA[<img src="/crash%E9%98%B2%E6%8A%A4-3-kvc/%E9%87%8D%E6%8B%BEiOS.jpg" class=""><br><blockquote><p>å…³é”®è¯ï¼šKVCã€Runtime</p></blockquote><a id="more"></a><p>Crashé˜²æŠ¤ç³»åˆ—æ–‡ç« :<br></p><ul><li><a href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-1-unrecognized-selector/">Crashé˜²æŠ¤(1)-Unrecognized Selector</a></li><li><a href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-2-kvo/">Crashé˜²æŠ¤(2)-KVO</a></li><li><a href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-3-kvc/">Crashé˜²æŠ¤(3)-KVC</a></li><li><a href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-4-nstimer/">Crashé˜²æŠ¤(4)-NSTimer</a></li></ul>        <h3 id="å‰è¨€"   >          <a href="#å‰è¨€" class="heading-link"><i class="fas fa-link"></i></a>å‰è¨€</h3>      <ol><li>æ—¥å¸¸å¼€å‘ä¸­æœ‰æ²¡æœ‰é‡åˆ°è¿‡å› ä¸ºKVCè€Œå¥”æºƒçš„é—®é¢˜ï¼Ÿ</li></ol>        <h3 id="KVC-Crash-çš„äº§ç”ŸåŸå› "   >          <a href="#KVC-Crash-çš„äº§ç”ŸåŸå› " class="heading-link"><i class="fas fa-link"></i></a>KVC Crash çš„äº§ç”ŸåŸå› </h3>      <p>KVC æ—¥å¸¸ä½¿ç”¨é€ æˆå´©æºƒçš„åŸå› é€šå¸¸æœ‰ä»¥ä¸‹å‡ ä¸ªï¼š</p><ol><li>key ä¸æ˜¯å¯¹è±¡çš„å±æ€§ï¼Œé€ æˆå´©æºƒã€‚</li><li>keyPath ä¸æ­£ç¡®ï¼Œé€ æˆå´©æºƒã€‚</li><li>key ä¸º nilï¼Œé€ æˆå´©æºƒã€‚</li><li>value ä¸º nilï¼Œä¸ºéå¯¹è±¡è®¾å€¼ï¼Œé€ æˆå´©æºƒã€‚</li></ol>        <h3 id="KVC-Crash-é˜²æŠ¤æ–¹æ¡ˆ"   >          <a href="#KVC-Crash-é˜²æŠ¤æ–¹æ¡ˆ" class="heading-link"><i class="fas fa-link"></i></a>KVC Crash é˜²æŠ¤æ–¹æ¡ˆ</h3>              <h4 id="1ã€æ€è·¯"   >          <a href="#1ã€æ€è·¯" class="heading-link"><i class="fas fa-link"></i></a>1ã€æ€è·¯</h4>      <p>ç†è§£äº†KVCçš„è®¾å€¼å–å€¼åŸç†çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬çŸ¥é“ï¼š<br></p><ul><li>setValue:forKey: æ‰§è¡Œå¤±è´¥ä¼šè°ƒç”¨ setValue: forUndefinedKey: æ–¹æ³•ï¼Œå¹¶å¼•å‘å´©æºƒã€‚</li><li>valueForKey: æ‰§è¡Œå¤±è´¥ä¼šè°ƒç”¨ valueForUndefinedKey: æ–¹æ³•ï¼Œå¹¶å¼•å‘å´©æºƒã€‚</li></ul><p>æ‰€ä»¥ï¼Œä¸ºäº†è¿›è¡Œ KVC Crash é˜²æŠ¤ï¼Œæˆ‘ä»¬å°±éœ€è¦é‡å†™ setValue: forUndefinedKey: æ–¹æ³•å’Œ valueForUndefinedKey: æ–¹æ³•ã€‚é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•ä¹‹åï¼Œå°±å¯ä»¥é˜²æŠ¤ <strong>1. key ä¸æ˜¯å¯¹è±¡çš„å±æ€§</strong> å’Œ <strong>2. keyPath ä¸æ­£ç¡® è¿™ä¸¤ç§å´©æºƒæƒ…å†µäº†</strong>ã€‚<br></p><p>é‚£ä¹ˆ <strong>3. key ä¸º nilï¼Œé€ æˆå´©æºƒ</strong> çš„æƒ…å†µï¼Œè¯¥æ€ä¹ˆé˜²æŠ¤å‘¢ï¼Ÿ<br><br>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Method Swizzling æ–¹æ³•ï¼Œåœ¨ NSObject çš„åˆ†ç±»ä¸­å°† setValue:forKey: å’Œ sf_setValue:forKey: è¿›è¡Œæ–¹æ³•äº¤æ¢ã€‚ç„¶ååœ¨è‡ªå®šä¹‰çš„æ–¹æ³•ä¸­ï¼Œæ·»åŠ å¯¹ key ä¸º nil è¿™ç§ç±»å‹çš„åˆ¤æ–­ã€‚<br></p><p>è¿˜æœ‰æœ€åä¸€ç§ <strong>4. value ä¸º nilï¼Œä¸ºéå¯¹è±¡è®¾å€¼ï¼Œé€ æˆå´©æºƒ</strong> çš„æƒ…å†µã€‚<br><br>åœ¨ NSKeyValueCoding.h æ–‡ä»¶ä¸­ï¼Œæœ‰ä¸€ä¸ª setNilValueForKey: æ–¹æ³•ã€‚ä¸Šè¾¹çš„å®˜æ–¹æ³¨é‡Šç»™äº†æˆ‘ä»¬ç­”æ¡ˆã€‚<br><br>åœ¨è°ƒç”¨ setValue:forKey: æ–¹æ³•æ—¶ï¼Œç³»ç»Ÿå¦‚æœæŸ¥æ‰¾åˆ°åä¸º set<Key>: æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå»æ£€æµ‹ value çš„å‚æ•°ç±»å‹ï¼Œå¦‚æœå‚æ•°ç±»å‹ä¸º NSNmber çš„æ ‡é‡ç±»å‹æˆ–è€…æ˜¯ NSValue çš„ç»“æ„ç±»å‹ï¼Œä½†æ˜¯ value ä¸º nil æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ setNilValueForKey: æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•çš„é»˜è®¤å®ç°ä¼šå¼•å‘å´©æºƒã€‚<br><br>æ‰€ä»¥ä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µå¯¼è‡´çš„å´©æºƒï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™ setNilValueForKey: æ¥è§£å†³ã€‚</p>        <h4 id="2ã€ä»£ç "   >          <a href="#2ã€ä»£ç " class="heading-link"><i class="fas fa-link"></i></a>2ã€ä»£ç </h4>      <p>æ–°å»ºåˆ†ç±»NSObject+KvoCrash<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">KvcCrash</span>)</span></span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        <span class="comment">// äº¤æ¢setValue:forKey:æ–¹æ³•(å®ä¾‹æ–¹æ³•å’Œå¯¹è±¡æ–¹æ³•)</span></span><br><span class="line">        [<span class="built_in">NSObject</span> sf_swizzlingInstanceMethod:<span class="keyword">@selector</span>(setValue:forKey:) swizzledMethod:<span class="keyword">@selector</span>(sf_setValue:forKey:) withClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]];</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)sf_setValue:(<span class="keyword">id</span>)value forKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="built_in">BOOL</span> isOpen = [SFCrachInspector checkIsOpenWithOption:SFCrashInspectorOptionKVC];</span><br><span class="line">    <span class="keyword">if</span> (isOpen) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!key) &#123;</span><br><span class="line">            <span class="built_in">NSString</span> *msg = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;ã€KVCã€‘[&lt;%@ %p&gt; setValue:forKey:]: attempt to set a value for a nil key. &quot;</span>,<span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>]),<span class="keyword">self</span>];</span><br><span class="line">            [SFCrachInspector log:msg];</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    [<span class="keyword">self</span> sf_setValue:value forKey:key];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setNilValueForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="built_in">BOOL</span> isOpen = [SFCrachInspector  checkIsOpenWithOption:SFCrashInspectorOptionKVC];</span><br><span class="line">    <span class="keyword">if</span> (isOpen) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *msg = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;ã€KVCã€‘[&lt;%@ %p&gt; setNilValueForKey]: could not set nil as the value for the key %@.&quot;</span>,<span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>]),<span class="keyword">self</span>,key];</span><br><span class="line">        [SFCrachInspector log:msg];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)setValue:(<span class="keyword">id</span>)value forUndefinedKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="built_in">BOOL</span> isOpen = [SFCrachInspector checkIsOpenWithOption:SFCrashInspectorOptionKVC];</span><br><span class="line">    <span class="keyword">if</span> (isOpen) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *msg = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;ã€KVCã€‘[&lt;%@ %p&gt; setValue:forUndefinedKey:]: this class is not key value coding-compliant for the key: %@,value:%@&#x27;.&quot;</span>,<span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>]),<span class="keyword">self</span>,key,value];</span><br><span class="line">        [SFCrachInspector log:msg];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">nullable</span> <span class="keyword">id</span>)valueForUndefinedKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">    <span class="built_in">BOOL</span> isOpen = [SFCrachInspector checkIsOpenWithOption:SFCrashInspectorOptionKVC];</span><br><span class="line">    <span class="keyword">if</span> (isOpen) &#123;</span><br><span class="line">        <span class="built_in">NSString</span> *msg = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@&quot;ã€KVCã€‘[&lt;%@ %p&gt; valueForUndefinedKey:]: this class is not key value coding-compliant for the key: %@.&quot;</span>,<span class="built_in">NSStringFromClass</span>([<span class="keyword">self</span> <span class="keyword">class</span>]),<span class="keyword">self</span>,key];</span><br><span class="line">        [SFCrachInspector log:msg];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><hr><p>[ä»£ç é“¾æ¥]<br/><br>GitHubï¼š<span class="exturl"><a class="exturl__link"   href="https://github.com/jack110530/SFCrash" >https://github.com/jack110530/SFCrash</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><hr><p>[ç›¸å…³å‚è€ƒ]<br/></p><ol><li><span class="exturl"><a class="exturl__link"   href="https://juejin.im/post/6844903934662803464" >iOS å¼€å‘ï¼šã€Crash é˜²æŠ¤ç³»ç»Ÿã€ï¼ˆä¸‰ï¼‰KVC é˜²æŠ¤</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> </li><li><span class="exturl"><a class="exturl__link"   href="https://www.jianshu.com/p/f63395599633" >ç½‘æ˜“iOS Appè¿è¡Œæ—¶Crashè‡ªåŠ¨é˜²æŠ¤å®è·µ</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/crash%E9%98%B2%E6%8A%A4-3-kvc/%E9%87%8D%E6%8B%BEiOS.jpg&quot; class=&quot;&quot;&gt;
&lt;br&gt;

&lt;blockquote&gt;
&lt;p&gt;å…³é”®è¯ï¼šKVCã€Runtime&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    
  </entry>
  
  <entry>
    <title>Crashé˜²æŠ¤(2)-KVO</title>
    <link href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-2-kvo/"/>
    <id>https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-2-kvo/</id>
    <published>2020-10-27T04:41:33.000Z</published>
    <updated>2020-10-28T03:07:35.595Z</updated>
    
    <content type="html"><![CDATA[<img src="/crash%E9%98%B2%E6%8A%A4-2-kvo/%E9%87%8D%E6%8B%BEiOS.jpg" class=""><br><blockquote><p>å…³é”®è¯ï¼šKVOã€HashMapã€Swizzling</p></blockquote><a id="more"></a><p>Crashé˜²æŠ¤ç³»åˆ—æ–‡ç« :<br></p><ul><li><a href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-1-unrecognized-selector/">Crashé˜²æŠ¤(1)-Unrecognized Selector</a></li><li><a href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-2-kvo/">Crashé˜²æŠ¤(2)-KVO</a></li><li><a href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-3-kvc/">Crashé˜²æŠ¤(3)-KVC</a></li><li><a href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-4-nstimer/">Crashé˜²æŠ¤(4)-NSTimer</a></li></ul>        <h3 id="å‰è¨€"   >          <a href="#å‰è¨€" class="heading-link"><i class="fas fa-link"></i></a>å‰è¨€</h3>      <ol><li>å¼€å‘ä¸­KVOç”¨çš„å¤šå—ï¼Œæœ‰æ²¡æœ‰é‡åˆ°è¿‡å› ä¸ºKVOå¼•å‘çš„bugï¼Ÿ</li><li>é’ˆå¯¹KVO crashé˜²æŠ¤ï¼Œæ€ä¹ˆåšï¼Ÿ</li></ol>        <h3 id="KVOé€ æˆå´©æºƒçš„åŸå› "   >          <a href="#KVOé€ æˆå´©æºƒçš„åŸå› " class="heading-link"><i class="fas fa-link"></i></a>KVOé€ æˆå´©æºƒçš„åŸå› </h3>      <ol><li>KVO æ·»åŠ æ¬¡æ•°å’Œç§»é™¤æ¬¡æ•°ä¸åŒ¹é…ï¼š<ul><li>ç§»é™¤äº†æœªæ³¨å†Œçš„è§‚å¯Ÿè€…ï¼Œå¯¼è‡´å´©æºƒã€‚</li><li>é‡å¤ç§»é™¤å¤šæ¬¡ï¼Œç§»é™¤æ¬¡æ•°å¤šäºæ·»åŠ æ¬¡æ•°ï¼Œå¯¼è‡´å´©æºƒã€‚</li><li>é‡å¤æ·»åŠ å¤šæ¬¡ï¼Œè™½ç„¶ä¸ä¼šå´©æºƒï¼Œä½†æ˜¯å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¹ŸåŒæ—¶ä¼šè¢«è§‚å¯Ÿå¤šæ¬¡ã€‚</li></ul></li><li>è¢«è§‚å¯Ÿè€…æå‰è¢«é‡Šæ”¾ï¼Œè¢«è§‚å¯Ÿè€…åœ¨ dealloc æ—¶ä»ç„¶æ³¨å†Œç€ KVOï¼Œå¯¼è‡´å´©æºƒã€‚ ä¾‹å¦‚ï¼šè¢«è§‚å¯Ÿè€…æ˜¯å±€éƒ¨å˜é‡çš„æƒ…å†µï¼ˆiOS 10 åŠä¹‹å‰ä¼šå´©æºƒï¼‰ã€‚</li><li>æ·»åŠ äº†è§‚å¯Ÿè€…ï¼Œä½†æœªå®ç° observeValueForKeyPath:ofObject:change:context: æ–¹æ³•ï¼Œå¯¼è‡´å´©æºƒã€‚</li><li>æ·»åŠ æˆ–è€…ç§»é™¤æ—¶ keypath == nilï¼Œå¯¼è‡´å´©æºƒã€‚</li></ol>        <h3 id="KVO-Crashé˜²æŠ¤æ–¹æ¡ˆ"   >          <a href="#KVO-Crashé˜²æŠ¤æ–¹æ¡ˆ" class="heading-link"><i class="fas fa-link"></i></a>KVO Crashé˜²æŠ¤æ–¹æ¡ˆ</h3>      <p>ä¸ºäº†é¿å…ä¸Šé¢æåˆ°çš„ä½¿ç”¨ KVO é€ æˆå´©æºƒçš„é—®é¢˜ï¼Œäºæ˜¯å‡ºç°äº†å¾ˆå¤šå…³äº KVO çš„ç¬¬ä¸‰æ–¹åº“ï¼Œæ¯”å¦‚æœ€å‡ºåçš„å°±æ˜¯ FaceBook å¼€æºçš„ç¬¬ä¸‰æ–¹åº“ <span class="exturl"><a class="exturl__link"   href="https://github.com/facebook/KVOController" >facebook / KVOController</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span>ã€‚<br></p><p>FBKVOController å¯¹ KVO æœºåˆ¶è¿›è¡Œäº†é¢å¤–çš„ä¸€å±‚å°è£…ï¼Œæ¡†æ¶ä¸ä½†å¯ä»¥è‡ªåŠ¨å¸®æˆ‘ä»¬ç§»é™¤è§‚å¯Ÿè€…ï¼Œè¿˜æä¾›äº† block æˆ–è€… selector çš„æ–¹å¼ä¾›æˆ‘ä»¬è¿›è¡Œè§‚å¯Ÿå¤„ç†ã€‚ä¸å¯å¦è®¤çš„æ˜¯ï¼ŒFBKVOController ä¸ºæˆ‘ä»¬çš„å¼€å‘æä¾›äº†å¾ˆå¤§çš„ä¾¿åˆ©æ€§ã€‚ä½†æ˜¯ç›¸å¯¹è€Œè¨€ï¼Œè¿™ç§æ–¹å¼å¯¹é¡¹ç›®ä»£ç çš„ä¾µå…¥æ€§æ¯”è¾ƒå¤§ï¼Œå¿…é¡»ä¾é ç¼–ç è§„èŒƒæ¥å¼ºåˆ¶çº¦æŸå›¢é˜Ÿäººå‘˜ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚<br></p><p>é‚£ä¹ˆæœ‰æ²¡æœ‰ä¸€ç§å¯¹é¡¹ç›®ä»£ç ä¾µå…¥æ€§å°ï¼ŒåŒæ—¶è¿˜èƒ½æœ‰æ•ˆé˜²æŠ¤ KVO å´©æºƒçš„é˜²æŠ¤æœºåˆ¶å‘¢ï¼Ÿ<br>å…·ä½“å¯ä»¥å‚è€ƒä¸€ä¸‹ iOS å¼€å‘ï¼šã€Crash é˜²æŠ¤ç³»ç»Ÿã€ï¼ˆäºŒï¼‰KVO é˜²æŠ¤ è¿™ç¯‡æ–‡ç« ã€‚<br></p><p>ä½†æ˜¯ï¼ŒæŸ¥é˜…YSC-Avoid-Crashå’ŒBayMaxProtector æºç åï¼Œå‘ç°è¿˜å­˜åœ¨äº›é—®é¢˜ï¼Œæ‰€ä»¥åœ¨â€œå‰äººâ€çš„åŸºç¡€ä¸Šæ·»åŠ äº†è‡ªå·±çš„æ”¹è¿›ä»£ç ï¼š<br><br>æœ¬æ¥æ˜¯æŠŠæºç ä¸­çš„ä¸€äº›é—®é¢˜å†™äº†ä¸‹æ¥ï¼Œå‘ç°ä¼¼ä¹æœ‰äº›ä¸å¦¥ï¼Œå°±åˆ æ‰äº†ã€‚æƒ³è¯¦ç»†äº†è§£çš„æœ‹å‹å¯ä»¥ç§ä¿¡æˆ‘ã€‚</p><hr><p>[ä»£ç é“¾æ¥]<br/><br>GitHubï¼š<span class="exturl"><a class="exturl__link"   href="https://github.com/jack110530/SFCrash" >https://github.com/jack110530/SFCrash</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><hr><p>[ç›¸å…³å‚è€ƒ]<br/></p><ol><li><span class="exturl"><a class="exturl__link"   href="https://juejin.im/post/6844903927469588488" >iOS å¼€å‘ï¼šã€Crash é˜²æŠ¤ç³»ç»Ÿã€ï¼ˆäºŒï¼‰KVO é˜²æŠ¤</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> </li><li><span class="exturl"><a class="exturl__link"   href="https://www.jianshu.com/p/f63395599633" >ç½‘æ˜“iOS Appè¿è¡Œæ—¶Crashè‡ªåŠ¨é˜²æŠ¤å®è·µ</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/crash%E9%98%B2%E6%8A%A4-2-kvo/%E9%87%8D%E6%8B%BEiOS.jpg&quot; class=&quot;&quot;&gt;
&lt;br&gt;

&lt;blockquote&gt;
&lt;p&gt;å…³é”®è¯ï¼šKVOã€HashMapã€Swizzling&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="é‡æ‹¾iOS" scheme="https://jack110530.github.io/categories/%E9%87%8D%E6%8B%BEiOS/"/>
    
    
    <category term="crash" scheme="https://jack110530.github.io/tags/crash/"/>
    
  </entry>
  
  <entry>
    <title>Crashé˜²æŠ¤(1)-Unrecognized Selector</title>
    <link href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-1-unrecognized-selector/"/>
    <id>https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-1-unrecognized-selector/</id>
    <published>2020-10-27T03:33:52.000Z</published>
    <updated>2020-12-14T07:37:38.639Z</updated>
    
    <content type="html"><![CDATA[<img src="/crash%E9%98%B2%E6%8A%A4-1-unrecognized-selector/%E9%87%8D%E6%8B%BEiOS.jpg" class=""><br><blockquote><p>å…³é”®è¯ï¼šUnrecognized Selectorã€Runtimeã€Swizzling</p></blockquote><a id="more"></a><p>Crashé˜²æŠ¤ç³»åˆ—æ–‡ç« :<br></p><ul><li><a href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-1-unrecognized-selector/">Crashé˜²æŠ¤(1)-Unrecognized Selector</a></li><li><a href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-2-kvo/">Crashé˜²æŠ¤(2)-KVO</a></li><li><a href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-3-kvc/">Crashé˜²æŠ¤(3)-KVC</a></li><li><a href="https://jack110530.github.io/crash%E9%98%B2%E6%8A%A4-4-nstimer/">Crashé˜²æŠ¤(4)-NSTimer</a></li></ul>        <h3 id="å‰è¨€"   >          <a href="#å‰è¨€" class="heading-link"><i class="fas fa-link"></i></a>å‰è¨€</h3>      <p>APP çš„å´©æºƒé—®é¢˜ï¼Œä¸€ç›´ä»¥æ¥éƒ½æ˜¯å¼€å‘è¿‡ç¨‹ä¸­é‡ä¸­ä¹‹é‡çš„é—®é¢˜ã€‚æ—¥å¸¸å¼€å‘é˜¶æ®µçš„å´©æºƒï¼Œå‘ç°åè¿˜èƒ½å¤Ÿç«‹å³å¤„ç†ã€‚ä½†æ˜¯ä¸€æ—¦å‘å¸ƒä¸Šæ¶çš„ç‰ˆæœ¬å‡ºç°é—®é¢˜ï¼Œå°±éœ€è¦ç´§æ€¥åŠ ç­ä¿®å¤ BUGï¼Œå†æ›´æ–°ä¸Šæ¶æ–°ç‰ˆæœ¬äº†ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ è¯´ä¸å®šä¼šå› ä¸ºå´©æºƒè€Œå¯¼è‡´å…³é”®ä¸šåŠ¡ä¸­æ–­ã€ç”¨æˆ·å­˜ç•™ç‡ä¸‹é™ã€å“ç‰Œå£ç¢‘å˜å·®ã€ç”Ÿå‘½å‘¨æœŸä»·å€¼ä¸‹é™ç­‰ï¼Œæœ€ç»ˆå¯¼è‡´æµå¤±ç”¨æˆ·ï¼Œå½±å“åˆ°å…¬å¸çš„å‘å±•ã€‚<br></p><p>å½“ç„¶ï¼Œé¿å…å´©æºƒé—®é¢˜çš„æœ€å¥½åŠæ³•å°±æ˜¯ä¸äº§ç”Ÿå´©æºƒã€‚åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­å°±è¦å°½å¯èƒ½åœ°ä¿è¯ç¨‹åºçš„å¥å£®æ€§ã€‚ä½†æ˜¯ï¼Œäººåˆä¸æ˜¯æœºå™¨ï¼Œä¸å¯èƒ½ä¸çŠ¯é”™ã€‚ä¸å¯èƒ½å­˜åœ¨æ²¡æœ‰ BUG çš„ç¨‹åºã€‚ä½†æ˜¯å¦‚æœèƒ½å¤Ÿåˆ©ç”¨ä¸€äº›è¯­è¨€æœºåˆ¶å’Œç³»ç»Ÿæ–¹æ³•ï¼Œè®¾è®¡ä¸€å¥—é˜²æŠ¤ç³»ç»Ÿï¼Œä½¿ä¹‹èƒ½å¤Ÿæœ‰æ•ˆçš„é™ä½ APP çš„å´©æºƒç‡ï¼Œé‚£ä¹ˆä¸ä»… APP çš„ç¨³å®šæ€§å¾—åˆ°äº†ä¿éšœï¼Œè€Œä¸”æœ€é‡è¦çš„æ˜¯å¯ä»¥å‡å°‘ä¸å¿…è¦çš„åŠ ç­ã€‚<br></p><p><strong>ã€ä»£ç ç¤ºä¾‹ã€‘</strong><br><br>å¦‚æœè¢«è°ƒç”¨çš„å¯¹è±¡æ–¹æ³•æ²¡æœ‰å®ç°ï¼Œé‚£ä¹ˆç¨‹åºåœ¨è¿è¡Œä¸­è°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œå°±ä¼šå› ä¸ºæ‰¾ä¸åˆ°å¯¹åº”çš„æ–¹æ³•å®ç°ï¼Œä»è€Œå¯¼è‡´ APP å´©æºƒã€‚æ¯”å¦‚ä¸‹é¢è¿™æ ·çš„ä»£ç ï¼š<br></p><p>é¦–å…ˆï¼Œåœ¨Personç±»ä¸­ï¼Œå£°æ˜äº†ä¸€ä¸ªtestInstanceFuncå¯¹è±¡æ–¹æ³•å’Œä¸€ä¸ªtestClassFuncç±»æ–¹æ³•ï¼Œä½†æ˜¯å´æ²¡æœ‰ç»™å‡ºå®ç°ä»£ç ï¼ˆIMPï¼‰</p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">Person</span> : <span class="title">NSObject</span></span></span><br><span class="line">- (<span class="keyword">void</span>)testInstanceFunc;</span><br><span class="line">+ (<span class="keyword">void</span>)testClassFunc;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .m</span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">Person</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><p>ç„¶åï¼Œåœ¨ViewControllerä¸­ï¼š</p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯•å¯¹è±¡æ–¹æ³•</span></span><br><span class="line">Person *p = [[Person alloc]init];</span><br><span class="line">[p testInstanceFunc];</span><br><span class="line"><span class="comment">// æµ‹è¯•ç±»æ–¹æ³•</span></span><br><span class="line">[Person testClassFunc];</span><br></pre></td></tr></table></div></figure><p>è¿è¡Œåï¼Œä¼šå‘ç°å´©æºƒäº†ã€‚åˆ†åˆ«æŠ¥é”™ï¼š</p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯•å¯¹è±¡æ–¹æ³•</span></span><br><span class="line">TestDemo[<span class="number">11056</span>:<span class="number">518162</span>] -[Person testInstanceFunc]: unrecognized selector sent to instance <span class="number">0x600000c74340</span></span><br><span class="line"><span class="comment">// æµ‹è¯•ç±»æ–¹æ³•</span></span><br><span class="line">TestDemo[<span class="number">11082</span>:<span class="number">519535</span>] +[Person testClassFunc]: unrecognized selector sent to <span class="keyword">class</span> <span class="number">0x108897670</span></span><br></pre></td></tr></table></div></figure><p>é‚£ä¹ˆï¼Œåƒè¿™ç§ unrecognized selector çš„å¥”æºƒé—®é¢˜æ€ä¹ˆå»é¿å…å‘¢ï¼Ÿè‡³å°‘é¡¹ç›®ä¸Šçº¿åï¼Œåœ¨æ­£å¼ç¯å¢ƒä¸­ä¸å‘ç”Ÿå´©æºƒå§ã€‚</p>        <h3 id="ä¸€ã€Runtimeé¢„å¤‡çŸ¥è¯†"   >          <a href="#ä¸€ã€Runtimeé¢„å¤‡çŸ¥è¯†" class="heading-link"><i class="fas fa-link"></i></a>ä¸€ã€Runtimeé¢„å¤‡çŸ¥è¯†</h3>      <p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦çŸ¥é“æ–¹æ³•è°ƒç”¨çš„æœ¬è´¨æ˜¯ä»€ä¹ˆã€‚<br></p><p>åœ¨OCä¸­ï¼Œæ–¹æ³•è°ƒç”¨çš„æœ¬è´¨å°±æ˜¯æ¶ˆæ¯å‘é€objc_msgSendã€‚ç»™å¯¹è±¡å‘é€æ¶ˆæ¯ï¼Œå…ˆä¼šç»è¿‡æ–¹æ³•æŸ¥æ‰¾ï¼Œæ‰¾åˆ°äº†åˆ™æ‰§è¡Œæ–¹æ³•å®ç°ã€‚è‹¥æ²¡æœ‰æ‰¾åˆ°åˆ™ä¼šè¿›å…¥æ¶ˆæ¯è½¬å‘é˜¶æ®µã€‚è‹¥æ¶ˆæ¯è½¬å‘é˜¶æ®µä¹Ÿæ²¡æœ‰æ–¹æ³•å®ç°ï¼Œåˆ™å‘ç”Ÿå´©æºƒã€‚<br></p><p>å…¶ä¸­ï¼Œåœ¨æ¶ˆæ¯è½¬å‘ä¸­ä¸‰å¤§æ­¥éª¤ï¼šåŠ¨æ€æ–¹æ³•è§£æã€å¤‡ç”¨æ¥æ”¶è€…ã€å®Œæ•´çš„æ¶ˆæ¯è½¬å‘ã€‚é€šè¿‡è¿™ä¸‰å¤§æ­¥éª¤ï¼Œå¯ä»¥è®©æˆ‘ä»¬åœ¨ç¨‹åºæ‰¾ä¸åˆ°è°ƒç”¨æ–¹æ³•å´©æºƒä¹‹å‰ï¼Œæ‹¦æˆªæ–¹æ³•è°ƒç”¨ã€‚<br></p><ul><li><strong>åŠ¨æ€æ–¹æ³•è§£æ</strong>ï¼šObjective-C è¿è¡Œæ—¶ä¼šè°ƒç”¨ +resolveInstanceMethod: æˆ–è€… +resolveClassMethod:ï¼Œè®©ä½ æœ‰æœºä¼šæä¾›ä¸€ä¸ªå‡½æ•°å®ç°ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œæ·»åŠ å…¶ä»–å‡½æ•°å®ç°ï¼Œå¹¶è¿”å› YESï¼Œ é‚£è¿è¡Œæ—¶ç³»ç»Ÿå°±ä¼šé‡æ–°å¯åŠ¨ä¸€æ¬¡æ¶ˆæ¯å‘é€çš„è¿‡ç¨‹ã€‚è‹¥è¿”å› NO æˆ–è€…æ²¡æœ‰æ·»åŠ å…¶ä»–å‡½æ•°å®ç°ï¼Œåˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</li><li><strong>å¤‡ç”¨æ¥æ”¶è€…</strong>ï¼šå¦‚æœå½“å‰å¯¹è±¡å®ç°äº† forwardingTargetForSelector:ï¼ŒRuntime å°±ä¼šè°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œå…è®¸æˆ‘ä»¬å°†æ¶ˆæ¯çš„æ¥å—è€…è½¬å‘ç»™å…¶ä»–å¯¹è±¡ã€‚å¦‚æœè¿™ä¸€æ­¥æ–¹æ³•è¿”å› nilï¼Œåˆ™è¿›å…¥ä¸‹ä¸€æ­¥ã€‚</li><li><strong>å®Œæ•´çš„æ¶ˆæ¯è½¬å‘</strong>ï¼šRuntime ç³»ç»Ÿåˆ©ç”¨ methodSignatureForSelector: æ–¹æ³•è·å–å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹ã€‚<br>å¦‚æœ methodSignatureForSelector: è¿”å›äº†ä¸€ä¸ª NSMethodSignature å¯¹è±¡ï¼ˆå‡½æ•°ç­¾åï¼‰ï¼ŒRuntime ç³»ç»Ÿå°±ä¼šåˆ›å»ºä¸€ä¸ª NSInvocation å¯¹è±¡ï¼Œå¹¶é€šè¿‡ forwardInvocation: æ¶ˆæ¯é€šçŸ¥å½“å‰å¯¹è±¡ï¼Œç»™äºˆæ­¤æ¬¡æ¶ˆæ¯å‘é€æœ€åä¸€æ¬¡å¯»æ‰¾ IMP çš„æœºä¼šã€‚<br>å¦‚æœ methodSignatureForSelector: è¿”å› nilã€‚åˆ™ Runtime ç³»ç»Ÿä¼šå‘å‡º doesNotRecognizeSelector: æ¶ˆæ¯ï¼Œç¨‹åºä¹Ÿå°±å´©æºƒäº†ã€‚</li></ul><img src="/crash%E9%98%B2%E6%8A%A4-1-unrecognized-selector/%E6%B6%88%E6%81%AF%E8%BD%AC%E5%8F%91.jpg" class="">        <h3 id="äºŒã€Crashé˜²æŠ¤æ–¹æ¡ˆ"   >          <a href="#äºŒã€Crashé˜²æŠ¤æ–¹æ¡ˆ" class="heading-link"><i class="fas fa-link"></i></a>äºŒã€Crashé˜²æŠ¤æ–¹æ¡ˆ</h3>              <h4 id="1ã€æ€è·¯"   >          <a href="#1ã€æ€è·¯" class="heading-link"><i class="fas fa-link"></i></a>1ã€æ€è·¯</h4>      <p>Objective-C è¯­è¨€æ˜¯ä¸€é—¨åŠ¨æ€è¯­è¨€ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Objective-C è¯­è¨€çš„ Runtime è¿è¡Œæ—¶æœºåˆ¶ï¼Œå¯¹éœ€è¦ Hook çš„ç±»æ·»åŠ  Categoryï¼ˆåˆ†ç±»ï¼‰ï¼Œåœ¨å„ä¸ªåˆ†ç±»çš„ +(void)load; ä¸­é€šè¿‡ Method Swizzling æ‹¦æˆªå®¹æ˜“é€ æˆå´©æºƒçš„ç³»ç»Ÿæ–¹æ³•ï¼Œå°†ç³»ç»ŸåŸæœ‰æ–¹æ³•ä¸æ·»åŠ çš„é˜²æŠ¤æ–¹æ³•çš„ selectorï¼ˆæ–¹æ³•é€‰æ‹©å™¨ï¼‰ ä¸ IMPï¼ˆå‡½æ•°å®ç°æŒ‡é’ˆï¼‰è¿›è¡Œå¯¹è°ƒã€‚ç„¶ååœ¨æ›¿æ¢æ–¹æ³•ä¸­æ·»åŠ é˜²æŠ¤æ“ä½œï¼Œä»è€Œè¾¾åˆ°é¿å…ä»¥åŠä¿®å¤å´©æºƒçš„ç›®çš„ã€‚<br></p><p>è¿™é‡Œæˆ‘ä»¬é€‰æ‹©ç¬¬äºŒæ­¥ï¼ˆå¤‡ç”¨æ¥æ”¶è€…ï¼‰æ¥è¿›è¡Œæ‹¦æˆªã€‚å› ä¸º -forwardingTargetForSelector æ–¹æ³•å¯ä»¥å°†æ¶ˆæ¯è½¬å‘ç»™ä¸€ä¸ªå¯¹è±¡ï¼Œå¼€é”€è¾ƒå°ï¼Œå¹¶ä¸”è¢«é‡å†™çš„æ¦‚ç‡è¾ƒä½ï¼Œé€‚åˆé‡å†™ã€‚<br></p>        <h4 id="2ã€ä»£ç "   >          <a href="#2ã€ä»£ç " class="heading-link"><i class="fas fa-link"></i></a>2ã€ä»£ç </h4>              <h5 id="1ï¼Œç»™NSObjectæ–°å»ºä¸ªCategoryç”¨äºæ–¹æ³•äº¤æ¢ï¼ˆNSObject-MethodSwizzlingï¼‰"   >          <a href="#1ï¼Œç»™NSObjectæ–°å»ºä¸ªCategoryç”¨äºæ–¹æ³•äº¤æ¢ï¼ˆNSObject-MethodSwizzlingï¼‰" class="heading-link"><i class="fas fa-link"></i></a>1ï¼Œç»™NSObjectæ–°å»ºä¸ªCategoryç”¨äºæ–¹æ³•äº¤æ¢ï¼ˆNSObject+MethodSwizzlingï¼‰</h5>      <figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&quot;NSObject+MethodSwizzling.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">MethodSwizzling</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)sf_swizzlingClassMethod:(SEL)originalSel swizzledMethod:(SEL)swizzledMethod withClass:(Class)targetClass &#123;</span><br><span class="line">    swizzlingMethod(targetClass, <span class="literal">YES</span>, originalSel, swizzledMethod);</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">void</span>)sf_swizzlingInstanceMethod:(SEL)originalSel swizzledMethod:(SEL)swizzledMethod withClass:(Class)targetClass &#123;</span><br><span class="line">    swizzlingMethod(targetClass, <span class="literal">NO</span>, originalSel, swizzledMethod);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// äº¤æ¢ç±»æ–¹æ³•</span></span><br><span class="line"><span class="comment">/// @param class ç±»/å…ƒç±»</span></span><br><span class="line"><span class="comment">/// @param originalSel åŸæ–¹æ³•</span></span><br><span class="line"><span class="comment">/// @param swizzledSel äº¤æ¢æ–¹æ³•</span></span><br><span class="line"><span class="keyword">void</span> swizzlingMethod(Class <span class="keyword">class</span>, <span class="built_in">BOOL</span> isMetaClass, SEL originalSel, SEL swizzledSel) &#123;</span><br><span class="line">    Method originalMethod;</span><br><span class="line">    Method swizzledMethod;</span><br><span class="line">    <span class="keyword">if</span> (isMetaClass) &#123;</span><br><span class="line">        originalMethod = class_getClassMethod(<span class="keyword">class</span>, originalSel);</span><br><span class="line">        swizzledMethod = class_getClassMethod(<span class="keyword">class</span>, swizzledSel);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        originalMethod = class_getInstanceMethod(<span class="keyword">class</span>, originalSel);</span><br><span class="line">        swizzledMethod = class_getInstanceMethod(<span class="keyword">class</span>, swizzledSel);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!originalMethod || !swizzledMethod) &#123;<span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="built_in">BOOL</span> didAddMethod = class_addMethod(<span class="keyword">class</span>,</span><br><span class="line">                                         originalSel,</span><br><span class="line">                                         method_getImplementation(swizzledMethod),</span><br><span class="line">                                         method_getTypeEncoding(swizzledMethod));</span><br><span class="line">    <span class="keyword">if</span> (didAddMethod) &#123;</span><br><span class="line">        class_replaceMethod(<span class="keyword">class</span>,</span><br><span class="line">                            swizzledSel,</span><br><span class="line">                            method_getImplementation(originalMethod),</span><br><span class="line">                            method_getTypeEncoding(originalMethod));</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        method_exchangeImplementations(originalMethod, swizzledMethod);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure>        <h5 id="2ã€ç»™NSObjectæ–°å»ºä¸ªCategoryç”¨äºCrashé˜²æŠ¤ï¼ˆNSObject-UnrecognizedSelectorCrashï¼‰"   >          <a href="#2ã€ç»™NSObjectæ–°å»ºä¸ªCategoryç”¨äºCrashé˜²æŠ¤ï¼ˆNSObject-UnrecognizedSelectorCrashï¼‰" class="heading-link"><i class="fas fa-link"></i></a>2ã€ç»™NSObjectæ–°å»ºä¸ªCategoryç”¨äºCrashé˜²æŠ¤ï¼ˆNSObject+UnrecognizedSelectorCrashï¼‰</h5>      <figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&quot;NSObject+UnrecognizedSelectorCrash.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&quot;NSObject+MethodSwizzling.h&quot;</span></span></span><br><span class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSObject</span> (<span class="title">UnrecognizedSelectorCrash</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)load &#123;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">if</span> DEBUG</span></span><br><span class="line">        </span><br><span class="line"><span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        <span class="comment">// äº¤æ¢forwardingTargetForSelector:æ–¹æ³•(å®ä¾‹æ–¹æ³•å’Œå¯¹è±¡æ–¹æ³•)</span></span><br><span class="line">        [<span class="built_in">NSObject</span> sf_swizzlingInstanceMethod:<span class="keyword">@selector</span>(forwardingTargetForSelector:) swizzledMethod:<span class="keyword">@selector</span>(sf_forwardingTargetForSelector:) withClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]];</span><br><span class="line">        [<span class="built_in">NSObject</span> sf_swizzlingClassMethod:<span class="keyword">@selector</span>(forwardingTargetForSelector:) swizzledMethod:<span class="keyword">@selector</span>(sf_forwardingTargetForSelector:) withClass:[<span class="built_in">NSObject</span> <span class="keyword">class</span>]];</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">id</span>)sf_forwardingTargetForSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="comment">// 1ï¼Œåˆ¤æ–­å½“å‰ç±»æœ‰æ²¡æœ‰é‡å†™forwardingTargetForSelector:æ–¹æ³•</span></span><br><span class="line">    SEL forwarding_sel = <span class="keyword">@selector</span>(forwardingTargetForSelector:);</span><br><span class="line">    <span class="built_in">BOOL</span> override_forwarding = checkMethodOverride([<span class="keyword">self</span> <span class="keyword">class</span>], <span class="literal">NO</span>, forwarding_sel);</span><br><span class="line">    <span class="keyword">if</span> (!override_forwarding) &#123;</span><br><span class="line">        <span class="comment">// æ²¡æœ‰é‡å†™ã€Œå¤‡ç”¨æ¥å—è€…ã€</span></span><br><span class="line">        <span class="comment">// 2ï¼Œåˆ¤æ–­å½“å‰ç±»æœ‰æ²¡æœ‰é‡å†™methodSignatureForSelector:æ–¹æ³•</span></span><br><span class="line">        SEL methodSignature_sel = <span class="keyword">@selector</span>(methodSignatureForSelector:);</span><br><span class="line">        <span class="built_in">BOOL</span> override_methodSignature = checkMethodOverride([<span class="keyword">self</span> <span class="keyword">class</span>], <span class="literal">NO</span>, methodSignature_sel);</span><br><span class="line">        <span class="keyword">if</span> (!override_methodSignature) &#123;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰é‡å†™ã€Œæ–¹æ³•ç­¾åã€</span></span><br><span class="line">            <span class="comment">// 3ï¼ŒæŠŠæ¶ˆæ¯è½¬å‘åˆ°å½“å‰åŠ¨æ€ç”Ÿæˆç±»çš„å®ä¾‹å¯¹è±¡ä¸Š</span></span><br><span class="line">            <span class="built_in">NSString</span> *className = <span class="string">@&quot;SFCrachInspector&quot;</span>;</span><br><span class="line">            Class cls = <span class="built_in">NSClassFromString</span>(className);</span><br><span class="line">            <span class="comment">// å¦‚æœç±»ä¸å­˜åœ¨ åŠ¨æ€åˆ›å»ºä¸€ä¸ªç±»</span></span><br><span class="line">            <span class="keyword">if</span> (!cls) &#123;</span><br><span class="line">                Class superClsss = [<span class="built_in">NSObject</span> <span class="keyword">class</span>];</span><br><span class="line">                cls = objc_allocateClassPair(superClsss, className.UTF8String, <span class="number">0</span>);</span><br><span class="line">                <span class="comment">// æ³¨å†Œç±»</span></span><br><span class="line">                objc_registerClassPair(cls);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦‚æœç±»æ²¡æœ‰å¯¹åº”çš„æ–¹æ³•ï¼Œåˆ™åŠ¨æ€æ·»åŠ ä¸€ä¸ª</span></span><br><span class="line">            <span class="keyword">if</span> (!class_getInstanceMethod(<span class="built_in">NSClassFromString</span>(className), aSelector)) &#123;</span><br><span class="line">                class_addMethod(cls, aSelector, (IMP)crash, <span class="string">&quot;@@:@&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ‰“å°æ—¥å¿—</span></span><br><span class="line">            printCrachMessage(<span class="keyword">self</span>, <span class="literal">NO</span>, aSelector);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> [[cls alloc] init];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> sf_forwardingTargetForSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">id</span>)sf_forwardingTargetForSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="comment">// 1ï¼Œåˆ¤æ–­å½“å‰ç±»æœ‰æ²¡æœ‰é‡å†™forwardingTargetForSelector:æ–¹æ³•</span></span><br><span class="line">    SEL forwarding_sel = <span class="keyword">@selector</span>(forwardingTargetForSelector:);</span><br><span class="line">    <span class="built_in">BOOL</span> override_forwarding = checkMethodOverride([<span class="keyword">self</span> <span class="keyword">class</span>], <span class="literal">YES</span>, forwarding_sel);</span><br><span class="line">    <span class="keyword">if</span> (!override_forwarding) &#123;</span><br><span class="line">        <span class="comment">// æ²¡æœ‰é‡å†™ã€Œå¤‡ç”¨æ¥å—è€…ã€</span></span><br><span class="line">        <span class="comment">// 2ï¼Œåˆ¤æ–­å½“å‰ç±»æœ‰æ²¡æœ‰é‡å†™methodSignatureForSelector:æ–¹æ³•</span></span><br><span class="line">        SEL methodSignature_sel = <span class="keyword">@selector</span>(methodSignatureForSelector:);</span><br><span class="line">        <span class="built_in">BOOL</span> override_methodSignature = checkMethodOverride([<span class="keyword">self</span> <span class="keyword">class</span>], <span class="literal">YES</span>, methodSignature_sel);</span><br><span class="line">        <span class="keyword">if</span> (!override_methodSignature) &#123;</span><br><span class="line">            <span class="comment">// æ²¡æœ‰é‡å†™ã€Œæ–¹æ³•ç­¾åã€</span></span><br><span class="line">            <span class="comment">// 3ï¼ŒæŠŠæ¶ˆæ¯è½¬å‘åˆ°å½“å‰åŠ¨æ€ç”Ÿæˆç±»çš„å®ä¾‹å¯¹è±¡ä¸Š</span></span><br><span class="line">            <span class="built_in">NSString</span> *className = <span class="string">@&quot;SFCrachInspector&quot;</span>;</span><br><span class="line">            Class cls = <span class="built_in">NSClassFromString</span>(className);</span><br><span class="line">            <span class="comment">// å¦‚æœç±»ä¸å­˜åœ¨ åŠ¨æ€åˆ›å»ºä¸€ä¸ªç±»</span></span><br><span class="line">            <span class="keyword">if</span> (!cls) &#123;</span><br><span class="line">                Class superClsss = [<span class="built_in">NSObject</span> <span class="keyword">class</span>];</span><br><span class="line">                cls = objc_allocateClassPair(superClsss, className.UTF8String, <span class="number">0</span>);</span><br><span class="line">                <span class="comment">// æ³¨å†Œç±»</span></span><br><span class="line">                objc_registerClassPair(cls);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦‚æœç±»æ²¡æœ‰å¯¹åº”çš„æ–¹æ³•ï¼Œåˆ™åŠ¨æ€æ·»åŠ ä¸€ä¸ª</span></span><br><span class="line">            <span class="keyword">if</span> (!class_getInstanceMethod(<span class="built_in">NSClassFromString</span>(className), aSelector)) &#123;</span><br><span class="line">                class_addMethod(cls, aSelector, (IMP)crash, <span class="string">&quot;@@:@&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ‰“å°æ—¥å¿—</span></span><br><span class="line">            printCrachMessage(<span class="keyword">self</span>, <span class="literal">YES</span>, aSelector);</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">return</span> [[cls alloc] init];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> sf_forwardingTargetForSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// åˆ¤æ–­æ–¹æ³•æ˜¯å¦é‡å†™è¿‡</span></span><br><span class="line"><span class="comment">/// @param class ç±»</span></span><br><span class="line"><span class="comment">/// @param isMetaClass æ˜¯å¦å…ƒç±»</span></span><br><span class="line"><span class="comment">/// @param aSelector æ–¹æ³•</span></span><br><span class="line"><span class="built_in">BOOL</span> checkMethodOverride(Class <span class="keyword">class</span>, <span class="built_in">BOOL</span> isMetaClass, SEL aSelector) &#123;</span><br><span class="line">    Method root_method;</span><br><span class="line">    Method current_method;</span><br><span class="line">    <span class="keyword">if</span> (isMetaClass) &#123;</span><br><span class="line">        root_method = class_getClassMethod([<span class="built_in">NSObject</span> <span class="keyword">class</span>], aSelector);</span><br><span class="line">        current_method = class_getClassMethod(<span class="keyword">class</span>, aSelector);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        root_method = class_getInstanceMethod([<span class="built_in">NSObject</span> <span class="keyword">class</span>], aSelector);</span><br><span class="line">        current_method = class_getInstanceMethod(<span class="keyword">class</span>, aSelector);</span><br><span class="line">    &#125;</span><br><span class="line">    IMP root_imp = method_getImplementation(root_method);</span><br><span class="line">    IMP current_imp = method_getImplementation(current_method);</span><br><span class="line">    <span class="keyword">return</span> root_imp != current_imp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ¨æ€æ·»åŠ çš„æ–¹æ³•å®ç°</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">int</span> crash(<span class="keyword">id</span> slf, SEL selector) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// æ‰“å°Crashæ—¥å¿—</span></span><br><span class="line"><span class="comment">/// @param obj å¯¹è±¡ï¼ˆå®ä¾‹å¯¹è±¡/ç±»å¯¹è±¡ï¼‰</span></span><br><span class="line"><span class="comment">/// @param isMetaClass æ˜¯å¦å…ƒç±»</span></span><br><span class="line"><span class="comment">/// @param aSelector æ–¹æ³•</span></span><br><span class="line"><span class="keyword">void</span> printCrachMessage(<span class="keyword">id</span> obj, <span class="built_in">BOOL</span> isMetaClass, SEL aSelector) &#123;</span><br><span class="line">    <span class="built_in">NSString</span> *errClassName = <span class="built_in">NSStringFromClass</span>([obj <span class="keyword">class</span>]);</span><br><span class="line">    <span class="built_in">NSString</span> *errSel = <span class="built_in">NSStringFromSelector</span>(aSelector);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;\n-------------------------SFCrash-------------------------\n Crash Message:\n %@[%@ %@]: unrecognized selector sent to %@ %p  \n---------------------------END---------------------------\n ***&quot;</span>,isMetaClass?<span class="string">@&quot;+&quot;</span>:<span class="string">@&quot;-&quot;</span>, errClassName, errSel, isMetaClass?<span class="string">@&quot;class&quot;</span>:<span class="string">@&quot;instance&quot;</span>, obj);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><hr><p>[ä»£ç é“¾æ¥]<br/><br>GitHubï¼š<span class="exturl"><a class="exturl__link"   href="https://github.com/jack110530/SFCrash" >https://github.com/jack110530/SFCrash</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><hr><p>[ç›¸å…³å‚è€ƒ]<br/></p><ol><li><span class="exturl"><a class="exturl__link"   href="https://juejin.im/post/6844903922667094023" >iOS å¼€å‘ï¼šã€Crash é˜²æŠ¤ç³»ç»Ÿã€ï¼ˆä¸€ï¼‰Unrecognized Selector</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> </li><li><span class="exturl"><a class="exturl__link"   href="https://www.jianshu.com/p/f63395599633" >ç½‘æ˜“iOS Appè¿è¡Œæ—¶Crashè‡ªåŠ¨é˜²æŠ¤å®è·µ</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/crash%E9%98%B2%E6%8A%A4-1-unrecognized-selector/%E9%87%8D%E6%8B%BEiOS.jpg&quot; class=&quot;&quot;&gt;
&lt;br&gt;

&lt;blockquote&gt;
&lt;p&gt;å…³é”®è¯ï¼šUnrecognized Selectorã€Runtimeã€Swizzling&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="é‡æ‹¾iOS" scheme="https://jack110530.github.io/categories/%E9%87%8D%E6%8B%BEiOS/"/>
    
    
    <category term="crash" scheme="https://jack110530.github.io/tags/crash/"/>
    
  </entry>
  
  <entry>
    <title>NSTimerå’Œç•Œé¢æ»‘åŠ¨å†²çª</title>
    <link href="https://jack110530.github.io/nstimer%E5%92%8C%E7%95%8C%E9%9D%A2%E6%BB%91%E5%8A%A8%E5%86%B2%E7%AA%81/"/>
    <id>https://jack110530.github.io/nstimer%E5%92%8C%E7%95%8C%E9%9D%A2%E6%BB%91%E5%8A%A8%E5%86%B2%E7%AA%81/</id>
    <published>2020-10-27T01:46:20.000Z</published>
    <updated>2020-10-27T02:08:47.259Z</updated>
    
    <content type="html"><![CDATA[<img src="/nstimer%E5%92%8C%E7%95%8C%E9%9D%A2%E6%BB%91%E5%8A%A8%E5%86%B2%E7%AA%81/%E9%87%8D%E6%8B%BEiOS.jpg" class=""><br><blockquote><p>å…³é”®è¯ï¼šNSTimerã€CADisplayLinkã€GCDã€RunLoopã€å¤šçº¿ç¨‹</p></blockquote><a id="more"></a>        <h3 id="å‰è¨€"   >          <a href="#å‰è¨€" class="heading-link"><i class="fas fa-link"></i></a>å‰è¨€</h3>      <ol><li>åœ¨æ»‘åŠ¨é¡µé¢ä¸Šçš„åˆ—è¡¨æ—¶ï¼ŒNSTimerä¼šæš‚åœï¼Œä¸ºä»€ä¹ˆï¼Ÿè¯¥å¦‚ä½•è§£å†³ï¼Ÿ</li></ol>        <h3 id="ä¸€ã€åŸå› "   >          <a href="#ä¸€ã€åŸå› " class="heading-link"><i class="fas fa-link"></i></a>ä¸€ã€åŸå› </h3>      <p>åŸå› åœ¨äºæ»‘åŠ¨æ—¶å½“å‰çº¿ç¨‹çš„runloopåˆ‡æ¢äº†modeç”¨äºåˆ—è¡¨æ»‘åŠ¨ï¼Œå¯¼è‡´timeræš‚åœã€‚<br></p><p>runloopä¸­çš„modeä¸»è¦ç”¨æ¥æŒ‡å®šäº‹ä»¶åœ¨runloopä¸­çš„ä¼˜å…ˆçº§ï¼Œæœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ul><li>Defaultï¼ˆNSDefaultRunLoopModeï¼‰ï¼šé»˜è®¤ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä½¿ç”¨ï¼›</li><li>Connectionï¼ˆNSConnectionReplyModeï¼‰ï¼šä¸€èˆ¬ç³»ç»Ÿç”¨æ¥å¤„ç†NSConnectionç›¸å…³äº‹ä»¶ï¼Œå¼€å‘è€…ä¸€èˆ¬ç”¨ä¸åˆ°ï¼›</li><li>Modalï¼ˆNSModalPanelRunLoopModeï¼‰ï¼šå¤„ç†modal panelsäº‹ä»¶ï¼›</li><li>Event Trackingï¼ˆNSEventTrackingRunLoopModeï¼‰ï¼šç”¨äºå¤„ç†æ‹–æ‹½å’Œç”¨æˆ·äº¤äº’çš„æ¨¡å¼ã€‚</li><li>Commonï¼ˆNSRunloopCommonModesï¼‰ï¼šæ¨¡å¼åˆé›†ã€‚é»˜è®¤åŒ…æ‹¬Defaultï¼ŒModalï¼ŒEvent Trackingä¸‰å¤§æ¨¡å¼ï¼Œå¯ä»¥å¤„ç†å‡ ä¹æ‰€æœ‰äº‹ä»¶ã€‚</li></ul><p>å›åˆ°é¢˜ä¸­çš„æƒ…å¢ƒã€‚æ»‘åŠ¨åˆ—è¡¨æ—¶ï¼Œrunloopçš„modeç”±åŸæ¥çš„Defaultæ¨¡å¼åˆ‡æ¢åˆ°äº†Event Trackingæ¨¡å¼ï¼ŒtimeråŸæ¥å¥½å¥½çš„è¿è¡Œåœ¨Defaultæ¨¡å¼ä¸­ï¼Œè¢«å…³é—­åè‡ªç„¶å°±åœæ­¢å·¥ä½œäº†ã€‚</p><p><strong>æ³¨æ„ï¼š</strong><br><br>åœ¨NSTimerçš„åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œä»¥scheduledå¼€å¤´çš„æ–¹æ³•ï¼Œtimeré»˜è®¤å·²ç»æ·»åŠ åˆ°äº†å½“å‰RunLoopä¸­ï¼ˆä»¥default modeå½¢å¼æ·»åŠ ï¼‰</p>        <h3 id="äºŒã€è§£å†³æ–¹æ¡ˆ"   >          <a href="#äºŒã€è§£å†³æ–¹æ¡ˆ" class="heading-link"><i class="fas fa-link"></i></a>äºŒã€è§£å†³æ–¹æ¡ˆ</h3>              <h4 id="1ã€å°†timeråŠ å…¥åˆ°NSRunloopCommonModesä¸­"   >          <a href="#1ã€å°†timeråŠ å…¥åˆ°NSRunloopCommonModesä¸­" class="heading-link"><i class="fas fa-link"></i></a>1ã€å°†timeråŠ å…¥åˆ°NSRunloopCommonModesä¸­</h4>      <figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[[<span class="built_in">NSRunLoop</span> currentRunLoop] addTimer:timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</span><br></pre></td></tr></table></div></figure>        <h4 id="2ã€å°†timeræ”¾åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œç„¶åå¼€å¯å¦ä¸€ä¸ªçº¿ç¨‹çš„runloopï¼Œè¿™æ ·å¯ä»¥ä¿è¯ä¸ä¸»çº¿ç¨‹äº’ä¸å¹²æ‰°"   >          <a href="#2ã€å°†timeræ”¾åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œç„¶åå¼€å¯å¦ä¸€ä¸ªçº¿ç¨‹çš„runloopï¼Œè¿™æ ·å¯ä»¥ä¿è¯ä¸ä¸»çº¿ç¨‹äº’ä¸å¹²æ‰°" class="heading-link"><i class="fas fa-link"></i></a>2ã€å°†timeræ”¾åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œç„¶åå¼€å¯å¦ä¸€ä¸ªçº¿ç¨‹çš„runloopï¼Œè¿™æ ·å¯ä»¥ä¿è¯ä¸ä¸»çº¿ç¨‹äº’ä¸å¹²æ‰°</h4>      <figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>), ^&#123;</span><br><span class="line">    timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1</span> target:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(repeat:) userInfo:<span class="literal">nil</span> repeats:<span class="literal">true</span>];</span><br><span class="line">    [[<span class="built_in">NSRunLoop</span> currentRunLoop] run];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></div></figure>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/nstimer%E5%92%8C%E7%95%8C%E9%9D%A2%E6%BB%91%E5%8A%A8%E5%86%B2%E7%AA%81/%E9%87%8D%E6%8B%BEiOS.jpg&quot; class=&quot;&quot;&gt;
&lt;br&gt;

&lt;blockquote&gt;
&lt;p&gt;å…³é”®è¯ï¼šNSTimerã€CADisplayLinkã€GCDã€RunLoopã€å¤šçº¿ç¨‹&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="é‡æ‹¾iOS" scheme="https://jack110530.github.io/categories/%E9%87%8D%E6%8B%BEiOS/"/>
    
    
    <category term="timer" scheme="https://jack110530.github.io/tags/timer/"/>
    
  </entry>
  
  <entry>
    <title>å®šæ—¶å™¨</title>
    <link href="https://jack110530.github.io/%E5%AE%9A%E6%97%B6%E5%99%A8/"/>
    <id>https://jack110530.github.io/%E5%AE%9A%E6%97%B6%E5%99%A8/</id>
    <published>2020-10-24T03:47:55.000Z</published>
    <updated>2020-10-27T03:54:53.920Z</updated>
    
    <content type="html"><![CDATA[<img src="/%E5%AE%9A%E6%97%B6%E5%99%A8/%E9%87%8D%E6%8B%BEiOS.jpg" class=""><br><blockquote><p>å…³é”®è¯ï¼šNSTimerã€CADisplayLinkã€GCDã€RunLoop</p></blockquote><a id="more"></a>        <h3 id="å‰è¨€"   >          <a href="#å‰è¨€" class="heading-link"><i class="fas fa-link"></i></a>å‰è¨€</h3>      <ol><li>å¼€å‘ä¸­å¸¸ç”¨çš„å®šæ—¶å™¨æœ‰å“ªäº›ï¼Œä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>å®šæ—¶å™¨çš„å¾ªç¯å¼•ç”¨é—®é¢˜æ€ä¹ˆè§£å†³ï¼Ÿ</li><li>CADisplayLinkã€NSTimeræ˜¯å¦å‡†æ—¶ï¼Ÿ</li></ol>        <h3 id="ä¸€ã€NSTimerå’ŒCADisplayLink"   >          <a href="#ä¸€ã€NSTimerå’ŒCADisplayLink" class="heading-link"><i class="fas fa-link"></i></a>ä¸€ã€NSTimerå’ŒCADisplayLink</h3>              <h4 id="1ã€NSTimer"   >          <a href="#1ã€NSTimer" class="heading-link"><i class="fas fa-link"></i></a>1ã€NSTimer</h4>      <p>å¸¸ç”¨apiæœ‰ï¼š</p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="built_in">NSTimer</span> *)timerWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)ti invocation:(<span class="built_in">NSInvocation</span> *)invocation repeats:(<span class="built_in">BOOL</span>)yesOrNo;</span><br><span class="line">+ (<span class="built_in">NSTimer</span> *)scheduledTimerWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)ti invocation:(<span class="built_in">NSInvocation</span> *)invocation repeats:(<span class="built_in">BOOL</span>)yesOrNo;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSTimer</span> *)timerWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)ti target:(<span class="keyword">id</span>)aTarget selector:(SEL)aSelector userInfo:(<span class="keyword">nullable</span> <span class="keyword">id</span>)userInfo repeats:(<span class="built_in">BOOL</span>)yesOrNo;</span><br><span class="line">+ (<span class="built_in">NSTimer</span> *)scheduledTimerWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)ti target:(<span class="keyword">id</span>)aTarget selector:(SEL)aSelector userInfo:(<span class="keyword">nullable</span> <span class="keyword">id</span>)userInfo repeats:(<span class="built_in">BOOL</span>)yesOrNo;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// Creates and returns a new NSTimer object initialized with the specified block object. This timer needs to be scheduled on a run loop (via -[NSRunLoop addTimer:]) before it will fire.</span></span><br><span class="line"><span class="comment">/// - parameter:  timeInterval  The number of seconds between firings of the timer. If seconds is less than or equal to 0.0, this method chooses the nonnegative value of 0.1 milliseconds instead</span></span><br><span class="line"><span class="comment">/// - parameter:  repeats  If YES, the timer will repeatedly reschedule itself until invalidated. If NO, the timer will be invalidated after it fires.</span></span><br><span class="line"><span class="comment">/// - parameter:  block  The execution body of the timer; the timer itself is passed as the parameter to this block when executed to aid in avoiding cyclical references</span></span><br><span class="line">+ (<span class="built_in">NSTimer</span> *)timerWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)interval repeats:(<span class="built_in">BOOL</span>)repeats block:(<span class="keyword">void</span> (^)(<span class="built_in">NSTimer</span> *timer))block API_AVAILABLE(macosx(<span class="number">10.12</span>), ios(<span class="number">10.0</span>), watchos(<span class="number">3.0</span>), tvos(<span class="number">10.0</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Creates and returns a new NSTimer object initialized with the specified block object and schedules it on the current run loop in the default mode.</span></span><br><span class="line"><span class="comment">/// - parameter:  ti    The number of seconds between firings of the timer. If seconds is less than or equal to 0.0, this method chooses the nonnegative value of 0.1 milliseconds instead</span></span><br><span class="line"><span class="comment">/// - parameter:  repeats  If YES, the timer will repeatedly reschedule itself until invalidated. If NO, the timer will be invalidated after it fires.</span></span><br><span class="line"><span class="comment">/// - parameter:  block  The execution body of the timer; the timer itself is passed as the parameter to this block when executed to aid in avoiding cyclical references</span></span><br><span class="line">+ (<span class="built_in">NSTimer</span> *)scheduledTimerWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)interval repeats:(<span class="built_in">BOOL</span>)repeats block:(<span class="keyword">void</span> (^)(<span class="built_in">NSTimer</span> *timer))block API_AVAILABLE(macosx(<span class="number">10.12</span>), ios(<span class="number">10.0</span>), watchos(<span class="number">3.0</span>), tvos(<span class="number">10.0</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/// Initializes a new NSTimer object using the block as the main body of execution for the timer. This timer needs to be scheduled on a run loop (via -[NSRunLoop addTimer:]) before it will fire.</span></span><br><span class="line"><span class="comment">/// - parameter:  fireDate   The time at which the timer should first fire.</span></span><br><span class="line"><span class="comment">/// - parameter:  interval  The number of seconds between firings of the timer. If seconds is less than or equal to 0.0, this method chooses the nonnegative value of 0.1 milliseconds instead</span></span><br><span class="line"><span class="comment">/// - parameter:  repeats  If YES, the timer will repeatedly reschedule itself until invalidated. If NO, the timer will be invalidated after it fires.</span></span><br><span class="line"><span class="comment">/// - parameter:  block  The execution body of the timer; the timer itself is passed as the parameter to this block when executed to aid in avoiding cyclical references</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithFireDate:(<span class="built_in">NSDate</span> *)date interval:(<span class="built_in">NSTimeInterval</span>)interval repeats:(<span class="built_in">BOOL</span>)repeats block:(<span class="keyword">void</span> (^)(<span class="built_in">NSTimer</span> *timer))block API_AVAILABLE(macosx(<span class="number">10.12</span>), ios(<span class="number">10.0</span>), watchos(<span class="number">3.0</span>), tvos(<span class="number">10.0</span>));</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithFireDate:(<span class="built_in">NSDate</span> *)date interval:(<span class="built_in">NSTimeInterval</span>)ti target:(<span class="keyword">id</span>)t selector:(SEL)s userInfo:(<span class="keyword">nullable</span> <span class="keyword">id</span>)ui repeats:(<span class="built_in">BOOL</span>)rep <span class="built_in">NS_DESIGNATED_INITIALIZER</span>;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)fire;</span><br></pre></td></tr></table></div></figure><p>åœ¨NSTimerçš„åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œä»¥scheduledå¼€å¤´çš„æ–¹æ³•ï¼Œtimeré»˜è®¤å·²ç»æ·»åŠ åˆ°äº†å½“å‰RunLoopä¸­ï¼ˆä»¥default modeå½¢å¼æ·»åŠ ï¼‰<br/></p>        <h4 id="2ã€CADisplayLink"   >          <a href="#2ã€CADisplayLink" class="heading-link"><i class="fas fa-link"></i></a>2ã€CADisplayLink</h4>      <p>å¸¸ç”¨apiæœ‰ï¼š</p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Create a new display link object for the main display. It will</span></span><br><span class="line"><span class="comment"> * invoke the method called &#x27;sel&#x27; on &#x27;target&#x27;, the method has the</span></span><br><span class="line"><span class="comment"> * signature &#x27;(void)selector:(CADisplayLink *)sender&#x27;. */</span></span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">CADisplayLink</span> *)displayLinkWithTarget:(<span class="keyword">id</span>)target selector:(SEL)sel;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Adds the receiver to the given run-loop and mode. Unless paused, it</span></span><br><span class="line"><span class="comment"> * will fire every vsync until removed. Each object may only be added</span></span><br><span class="line"><span class="comment"> * to a single run-loop, but it may be added in multiple modes at once.</span></span><br><span class="line"><span class="comment"> * While added to a run-loop it will implicitly be retained. */</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addToRunLoop:(<span class="built_in">NSRunLoop</span> *)runloop forMode:(<span class="built_in">NSRunLoopMode</span>)mode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Removes the receiver from the given mode of the runloop. This will</span></span><br><span class="line"><span class="comment"> * implicitly release it when removed from the last mode it has been</span></span><br><span class="line"><span class="comment"> * registered for. */</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)removeFromRunLoop:(<span class="built_in">NSRunLoop</span> *)runloop forMode:(<span class="built_in">NSRunLoopMode</span>)mode;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Removes the object from all runloop modes (releasing the receiver if</span></span><br><span class="line"><span class="comment"> * it has been implicitly retained) and releases the &#x27;target&#x27; object. */</span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)invalidate;</span><br></pre></td></tr></table></div></figure>        <h3 id="äºŒã€å®šæ—¶å™¨å¾ªç¯å¼•ç”¨é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ"   >          <a href="#äºŒã€å®šæ—¶å™¨å¾ªç¯å¼•ç”¨é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ" class="heading-link"><i class="fas fa-link"></i></a>äºŒã€å®šæ—¶å™¨å¾ªç¯å¼•ç”¨é—®é¢˜çš„è§£å†³æ–¹æ¡ˆ</h3>              <h4 id="1ã€ä½¿ç”¨blockæ–¹å¼åˆå§‹åŒ–NSTimerï¼›"   >          <a href="#1ã€ä½¿ç”¨blockæ–¹å¼åˆå§‹åŒ–NSTimerï¼›" class="heading-link"><i class="fas fa-link"></i></a>1ã€ä½¿ç”¨blockæ–¹å¼åˆå§‹åŒ–NSTimerï¼›</h4>              <h4 id="2ã€ä½¿ç”¨ä¸­é—´å±‚WeakContainerï¼›"   >          <a href="#2ã€ä½¿ç”¨ä¸­é—´å±‚WeakContainerï¼›" class="heading-link"><i class="fas fa-link"></i></a>2ã€ä½¿ç”¨ä¸­é—´å±‚WeakContainerï¼›</h4>      <p>ä»£ç ç¤ºä¾‹ï¼š<br/><br>æ–°å»ºSFWeakContainerç±»<br></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SFWeakContainer</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithTarget:(<span class="built_in">NSObject</span> *)target;</span><br><span class="line">+ (<span class="keyword">instancetype</span>)containerWithTarget:(<span class="built_in">NSObject</span> *)target;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .m</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SFWeakContainer</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="built_in">NSObject</span> *target;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SFWeakContainer</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithTarget:(<span class="built_in">NSObject</span> *)target &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">instancetype</span>)containerWithTarget:(<span class="built_in">NSObject</span> *)target &#123;</span><br><span class="line">    SFWeakContainer *container = [[SFWeakContainer alloc]initWithTarget:target];</span><br><span class="line">    <span class="keyword">return</span> container;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤‡ç”¨æ¥å—è€…</span></span><br><span class="line">- (<span class="keyword">id</span>)forwardingTargetForSelector:(SEL)aSelector &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.target &amp;&amp; [<span class="keyword">self</span>.target respondsToSelector:aSelector]) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">self</span>.target;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="keyword">super</span> forwardingTargetForSelector:aSelector];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    SFWeakContainer *weakContainer = [SFWeakContainer containerWithTarget:<span class="keyword">self</span>];</span><br><span class="line">    <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1</span> target:weakContainer selector:<span class="keyword">@selector</span>(timerEvent:) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)timerEvent:(<span class="built_in">NSTimer</span> *)timer &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;å®šæ—¶å™¨äº‹ä»¶&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    [<span class="keyword">self</span>.timer invalidate];</span><br><span class="line">    <span class="keyword">self</span>.timer = <span class="literal">nil</span>;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="3ã€NSProxyæ¶ˆæ¯è½¬å‘ï¼›"   >          <a href="#3ã€NSProxyæ¶ˆæ¯è½¬å‘ï¼›" class="heading-link"><i class="fas fa-link"></i></a>3ã€NSProxyæ¶ˆæ¯è½¬å‘ï¼›</h4>      <p>ä»£ç ç¤ºä¾‹ï¼š<br/><br>æ–°å»ºSFProxy<br/></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .h</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SFProxy</span> : <span class="title">NSProxy</span></span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithTarget:(<span class="keyword">id</span>)target;</span><br><span class="line">+ (<span class="keyword">instancetype</span>)proxyWithTarget:(<span class="keyword">id</span>)target;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// .m</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SFProxy</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="built_in">NSObject</span> *target;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SFProxy</span></span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithTarget:(<span class="keyword">id</span>)target &#123;</span><br><span class="line">    _target = target;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line">+ (<span class="keyword">instancetype</span>)proxyWithTarget:(<span class="keyword">id</span>)target &#123;</span><br><span class="line">    <span class="keyword">return</span> [[<span class="keyword">self</span> alloc] initWithTarget:target];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆæ¯è½¬å‘</span></span><br><span class="line">- (<span class="built_in">NSMethodSignature</span> *)methodSignatureForSelector:(SEL)aSelector&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.target &amp;&amp; [<span class="keyword">self</span>.target respondsToSelector:aSelector]) &#123;</span><br><span class="line">        <span class="keyword">return</span> [<span class="keyword">self</span>.target methodSignatureForSelector:aSelector];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> [<span class="keyword">super</span> methodSignatureForSelector:aSelector];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)forwardInvocation:(<span class="built_in">NSInvocation</span> *)anInvocation&#123;</span><br><span class="line">    SEL aSelector = [anInvocation selector];</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.target &amp;&amp; [<span class="keyword">self</span>.target respondsToSelector:aSelector]) &#123;</span><br><span class="line">        [anInvocation invokeWithTarget:<span class="keyword">self</span>.target];</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        [<span class="keyword">super</span> forwardInvocation:anInvocation];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    SFProxy *proxy = [SFProxy proxyWithTarget:<span class="keyword">self</span>];</span><br><span class="line">    <span class="keyword">self</span>.timer = [<span class="built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="number">1</span> target:proxy selector:<span class="keyword">@selector</span>(timerEvent:) userInfo:<span class="literal">nil</span> repeats:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)timerEvent:(<span class="built_in">NSTimer</span> *)timer &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;å®šæ—¶å™¨äº‹ä»¶&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)dealloc &#123;</span><br><span class="line">    [<span class="keyword">self</span>.timer invalidate];</span><br><span class="line">    <span class="keyword">self</span>.timer = <span class="literal">nil</span>;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@&quot;%s&quot;</span>, __func__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure><p>å…·ä½“æ€ä¹ˆåšï¼Œæ ¹æ®ä¸ªäººå–œå¥½é€‰æ‹©ï¼Œæˆ‘è¿™é‡Œæœ‰ä¸€ä¸ªå†™å¥½çš„æ–¹æ¡ˆï¼š<a href="">Crashé˜²æŠ¤(4)-NSTimer</a></p>        <h3 id="ä¸‰ã€CADisplayLinkã€NSTimeræ˜¯å¦å‡†æ—¶ï¼Ÿ"   >          <a href="#ä¸‰ã€CADisplayLinkã€NSTimeræ˜¯å¦å‡†æ—¶ï¼Ÿ" class="heading-link"><i class="fas fa-link"></i></a>ä¸‰ã€CADisplayLinkã€NSTimeræ˜¯å¦å‡†æ—¶ï¼Ÿ</h3>      <p>CADisplayLinkã€NSTimeråº•å±‚éƒ½æ˜¯é RunLoopæ¥å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æŠŠå®ƒä»¬ç†è§£æˆRunLoopæ‰€éœ€è¦å¤„ç†çš„äº‹ä»¶ã€‚æˆ‘ä»¬çŸ¥é“RunLoopå¯ä»¥æ‹¿æ¥åˆ·æ–°UIï¼Œå¤„ç†å®šæ—¶å™¨ï¼ˆCADisplayLinkã€NSTimerï¼‰ï¼Œå¤„ç†ç‚¹å‡»æ»‘åŠ¨äº‹ä»¶ç­‰éå¸¸å¤šçš„äº‹æƒ…ã€‚è¿™é‡Œï¼Œå°±éœ€è¦æ¥äº†è§£ä¸€ä¸‹RunLoopæ˜¯å¦‚ä½•è§¦å‘NSTimerä»»åŠ¡çš„ã€‚RunLoopæ¯å¾ªç¯ä¸€åœˆï¼Œéƒ½ä¼šå¤„ç†ä¸€å®šçš„äº‹ä»¶ï¼Œä¼šæ¶ˆè€—ä¸€å®šçš„æ—¶é—´ï¼Œä½†æ˜¯å…·ä½“è€—æ—¶å¤šå°‘è¿™ä¸ªæ˜¯æ— æ³•ç¡®å®šçš„ã€‚<br/></p><p>å‡å¦‚ä½ å¼€å¯ä¸€ä¸ªtimerï¼Œéš”1ç§’è§¦å‘å®šæ—¶å™¨äº‹ä»¶ï¼ŒRunLoopä¼šå¼€å§‹ç´¯è®¡æ¯ä¸€åœˆå¾ªç¯çš„ç”¨æ—¶ï¼Œå½“æ—¶é—´ç´¯è®¡å¤Ÿ1ç§’ï¼Œå°±ä¼šè§¦å‘å®šæ—¶å™¨äº‹ä»¶ã€‚ä½ æœ‰å…´è¶£çš„è¯ï¼Œæ˜¯å¯ä»¥åœ¨RunLoopçš„æºç é‡Œé¢æ‰¾åˆ°æ—¶é—´ç´¯åŠ ç›¸å…³ä»£ç çš„ã€‚å¯ä»¥å€ŸåŠ©ä¸‹å›¾æ¥åŠ æ·±ç†è§£:<br/></p><img src="/%E5%AE%9A%E6%97%B6%E5%99%A8/runloop1.png" class=""><p>å¦‚æœRunLoopåœ¨æŸä¸€åœˆä»»åŠ¡è¿‡äºç¹é‡ï¼Œå°±å¯èƒ½å‡ºç°å¦‚ä¸‹æƒ…å†µ</p><img src="/%E5%AE%9A%E6%97%B6%E5%99%A8/runloop2.png" class=""><p>æ‰€ä»¥CADisplayLinkã€NSTimeræ˜¯æ— æ³•ä¿è¯å‡†æ—¶æ€§çš„ã€‚</p>        <h3 id="å››ã€GCD-Timer"   >          <a href="#å››ã€GCD-Timer" class="heading-link"><i class="fas fa-link"></i></a>å››ã€GCD Timer</h3>              <h4 id="1ã€GCD-Timer-çš„ç®€å•ä½¿ç”¨"   >          <a href="#1ã€GCD-Timer-çš„ç®€å•ä½¿ç”¨" class="heading-link"><i class="fas fa-link"></i></a>1ã€GCD Timer çš„ç®€å•ä½¿ç”¨</h4>      <figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) dispatch_source_t timer;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–å®šæ—¶å™¨</span></span><br><span class="line">    <span class="keyword">self</span>.timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, <span class="number">0</span>, <span class="number">0</span>, dispatch_get_main_queue());</span><br><span class="line">    <span class="comment">// é—´éš”æ—¶é—´</span></span><br><span class="line">    uint64_t intervalTime = <span class="number">1.0</span>;</span><br><span class="line">    <span class="comment">//è¯¯å·®æ—¶é—´</span></span><br><span class="line">    uint64_t leewayTime = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// å»¶è¿Ÿæ—¶é—´</span></span><br><span class="line">    uint64_t delayTime = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">// å¼€å§‹æ—¶é—´</span></span><br><span class="line">    dispatch_time_t startTime = dispatch_time(DISPATCH_TIME_NOW, delayTime*<span class="built_in">NSEC_PER_SEC</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®å®šæ—¶å™¨æ—¶é—´</span></span><br><span class="line">    dispatch_source_set_timer(<span class="keyword">self</span>.timer, startTime, intervalTime * <span class="built_in">NSEC_PER_SEC</span>, leewayTime * <span class="built_in">NSEC_PER_SEC</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®å®šæ—¶å™¨å›è°ƒäº‹ä»¶</span></span><br><span class="line">    dispatch_source_set_event_handler(<span class="keyword">self</span>.timer, ^&#123;</span><br><span class="line">        <span class="comment">// å®šæ—¶å™¨äº‹ä»¶ä»£ç </span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;GCDå®šæ—¶å™¨äº‹ä»¶&quot;</span>);</span><br><span class="line">        <span class="comment">// å¦‚æœå®šæ—¶å™¨ä¸éœ€è¦é‡å¤ï¼Œå¯ä»¥åœ¨è¿™é‡Œå–æ¶ˆå®šæ—¶å™¨</span></span><br><span class="line">        dispatch_source_cancel(<span class="keyword">self</span>.timer);</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// è¿è¡Œå®šæ—¶å™¨</span></span><br><span class="line">    dispatch_resume(<span class="keyword">self</span>.timer);</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>        <h4 id="2ã€GCD-Timer-çš„å°è£…"   >          <a href="#2ã€GCD-Timer-çš„å°è£…" class="heading-link"><i class="fas fa-link"></i></a>2ã€GCD Timer çš„å°è£…</h4>      <p>ä»£ç å¦‚ä¸‹ï¼š<br/></p><figure class="highlight objc"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&quot;SFGcdTimer.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">SFGcdTimer</span> ()</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) dispatch_source_t timer;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">dispatch_queue_t</span> queue;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æé—®ï¼šè‹¹æœä¸ºä»€ä¹ˆè¦æŠŠNSTimerä¸­çš„targetè®¾è®¡æˆå¼ºå¼•ç”¨å…³ç³»ï¼Œæ—¢ç„¶ä»–ä¼šå¯¼è‡´å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œä¸ºä»€ä¹ˆè‹¹æœä¸ç›´æ¥å°†NSTimerçš„targetè®¾è®¡æˆå¼±å¼•ç”¨å…³ç³»ï¼Ÿ</span></span><br><span class="line"><span class="comment"> * æ‰€ä»¥è¿™é‡Œä¿ç•™è·ŸNSTimerç±»ä¼¼çš„è®¾è®¡</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSObject</span> *target;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nullable</span>, <span class="keyword">retain</span>) <span class="keyword">id</span> userInfo;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSTimeInterval</span> timeInterval;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">SFGcdTimer</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: targetæ–¹å¼</span></span><br><span class="line"><span class="comment">/// åˆå§‹åŒ–æ–¹æ³•ï¼ˆtargetï¼‰</span></span><br><span class="line"><span class="comment">/// @param interval æ—¶é—´é—´éš”</span></span><br><span class="line"><span class="comment">/// @param delay å»¶è¿Ÿæ—¶é—´</span></span><br><span class="line"><span class="comment">/// @param aTarget æ‰§è¡Œå¯¹è±¡</span></span><br><span class="line"><span class="comment">/// @param aSelector æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line"><span class="comment">/// @param userInfo é™„å¸¦ä¿¡æ¯</span></span><br><span class="line"><span class="comment">/// @param repeats æ˜¯å¦é‡å¤</span></span><br><span class="line">+ (SFGcdTimer *)timerWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)interval delay:(<span class="built_in">NSTimeInterval</span>)delay target:(<span class="keyword">id</span>)aTarget selector:(SEL)aSelector userInfo:(<span class="keyword">nullable</span> <span class="keyword">id</span>)userInfo repeats:(<span class="built_in">BOOL</span>)repeats  &#123;</span><br><span class="line">    SFGcdTimer *timer = [[SFGcdTimer alloc] initWithTimeInterval:interval delay:delay target:aTarget selector:aSelector userInfo:userInfo repeats:repeats queue:<span class="literal">nil</span>];</span><br><span class="line">    <span class="keyword">return</span> timer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// åˆå§‹åŒ–æ–¹æ³•ï¼ˆtargetï¼‰</span></span><br><span class="line"><span class="comment">/// @param interval æ—¶é—´é—´éš”</span></span><br><span class="line"><span class="comment">/// @param delay å»¶è¿Ÿæ—¶é—´</span></span><br><span class="line"><span class="comment">/// @param aTarget æ‰§è¡Œå¯¹è±¡</span></span><br><span class="line"><span class="comment">/// @param aSelector æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line"><span class="comment">/// @param userInfo é™„å¸¦ä¿¡æ¯</span></span><br><span class="line"><span class="comment">/// @param repeats æ˜¯å¦é‡å¤</span></span><br><span class="line"><span class="comment">/// @param queue æŒ‡å®šé˜Ÿåˆ—ï¼ˆé»˜è®¤ä¸»é˜Ÿåˆ—ï¼‰</span></span><br><span class="line">+ (SFGcdTimer *)timerWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)interval delay:(<span class="built_in">NSTimeInterval</span>)delay target:(<span class="keyword">id</span>)aTarget selector:(SEL)aSelector userInfo:(<span class="keyword">nullable</span> <span class="keyword">id</span>)userInfo repeats:(<span class="built_in">BOOL</span>)repeats queue:(<span class="built_in">dispatch_queue_t</span>)queue &#123;</span><br><span class="line">    SFGcdTimer *timer = [[SFGcdTimer alloc] initWithTimeInterval:interval delay:delay target:aTarget selector:aSelector userInfo:userInfo repeats:repeats queue:queue];</span><br><span class="line">    <span class="keyword">return</span> timer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// åˆå§‹åŒ–æ–¹æ³•ï¼ˆtargetï¼‰</span></span><br><span class="line"><span class="comment">/// @param interval æ—¶é—´é—´éš”</span></span><br><span class="line"><span class="comment">/// @param delay å»¶è¿Ÿæ—¶é—´</span></span><br><span class="line"><span class="comment">/// @param aTarget æ‰§è¡Œå¯¹è±¡</span></span><br><span class="line"><span class="comment">/// @param aSelector æ‰§è¡Œæ–¹æ³•</span></span><br><span class="line"><span class="comment">/// @param userInfo é™„å¸¦ä¿¡æ¯</span></span><br><span class="line"><span class="comment">/// @param repeats æ˜¯å¦é‡å¤</span></span><br><span class="line"><span class="comment">/// @param queue æŒ‡å®šé˜Ÿåˆ—ï¼ˆé»˜è®¤ä¸»é˜Ÿåˆ—ï¼‰</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)interval delay:(<span class="built_in">NSTimeInterval</span>)delay target:(<span class="keyword">id</span>)aTarget selector:(SEL)aSelector userInfo:(<span class="keyword">nullable</span> <span class="keyword">id</span>)userInfo repeats:(<span class="built_in">BOOL</span>)repeats queue:(<span class="built_in">dispatch_queue_t</span>)queue &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.timeInterval = interval;</span><br><span class="line">        <span class="keyword">self</span>.queue = queue;</span><br><span class="line">        <span class="keyword">self</span>.target = aTarget;</span><br><span class="line">        <span class="keyword">self</span>.userInfo = userInfo;</span><br><span class="line">        <span class="keyword">self</span>.timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span>.queue);</span><br><span class="line">        dispatch_source_set_timer(<span class="keyword">self</span>.timer,</span><br><span class="line">                                  dispatch_time(DISPATCH_TIME_NOW, delay * <span class="built_in">NSEC_PER_SEC</span>), <span class="comment">// å¼€å§‹æ—¶é—´</span></span><br><span class="line">                                  interval * <span class="built_in">NSEC_PER_SEC</span>, <span class="comment">// é—´éš”</span></span><br><span class="line">                                  <span class="number">0</span> <span class="comment">// è¯¯å·®</span></span><br><span class="line">                                  );</span><br><span class="line">        dispatch_source_set_event_handler(<span class="keyword">self</span>.timer, ^&#123;</span><br><span class="line">            <span class="keyword">if</span> ([<span class="keyword">self</span>.target respondsToSelector:aSelector]) &#123;</span><br><span class="line">                [<span class="keyword">self</span>.target performSelector:aSelector withObject:<span class="keyword">self</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!repeats) &#123;</span><br><span class="line">                [<span class="keyword">self</span> invalidate];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// MARK: blockæ–¹å¼</span></span><br><span class="line"><span class="comment">/// åˆå§‹åŒ–æ–¹æ³•ï¼ˆblockï¼‰</span></span><br><span class="line"><span class="comment">/// @param interval æ—¶é—´é—´éš”</span></span><br><span class="line"><span class="comment">/// @param delay å»¶è¿Ÿæ—¶é—´</span></span><br><span class="line"><span class="comment">/// @param repeats æ˜¯å¦é‡å¤</span></span><br><span class="line"><span class="comment">/// @param block æ‰§è¡Œblock</span></span><br><span class="line">+ (SFGcdTimer *)timerWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)interval delay:(<span class="built_in">NSTimeInterval</span>)delay repeats:(<span class="built_in">BOOL</span>)repeats block:(<span class="keyword">void</span> (^)(SFGcdTimer *timer))block &#123;</span><br><span class="line">    SFGcdTimer *timer = [[SFGcdTimer alloc]initWithTimeInterval:interval delay:delay repeats:repeats block:block queue:<span class="literal">nil</span>];</span><br><span class="line">    <span class="keyword">return</span> timer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// åˆå§‹åŒ–æ–¹æ³•ï¼ˆblockï¼‰</span></span><br><span class="line"><span class="comment">/// @param interval æ—¶é—´é—´éš”</span></span><br><span class="line"><span class="comment">/// @param delay å»¶è¿Ÿæ—¶é—´</span></span><br><span class="line"><span class="comment">/// @param repeats æ˜¯å¦é‡å¤</span></span><br><span class="line"><span class="comment">/// @param block æ‰§è¡Œblock</span></span><br><span class="line"><span class="comment">/// @param queue æ‰§è¡Œé˜Ÿåˆ—ï¼ˆé»˜è®¤ä¸»é˜Ÿåˆ—ï¼‰</span></span><br><span class="line">+ (SFGcdTimer *)timerWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)interval delay:(<span class="built_in">NSTimeInterval</span>)delay repeats:(<span class="built_in">BOOL</span>)repeats block:(<span class="keyword">void</span> (^)(SFGcdTimer *timer))block queue:(<span class="built_in">dispatch_queue_t</span>)queue &#123;</span><br><span class="line">    SFGcdTimer *timer = [[SFGcdTimer alloc]initWithTimeInterval:interval delay:delay repeats:repeats block:block queue:queue];</span><br><span class="line">    <span class="keyword">return</span> timer;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// åˆå§‹åŒ–æ–¹æ³•ï¼ˆblockï¼‰</span></span><br><span class="line"><span class="comment">/// @param interval æ—¶é—´é—´éš”</span></span><br><span class="line"><span class="comment">/// @param delay å»¶è¿Ÿæ—¶é—´</span></span><br><span class="line"><span class="comment">/// @param repeats æ˜¯å¦é‡å¤</span></span><br><span class="line"><span class="comment">/// @param block æ‰§è¡Œblock</span></span><br><span class="line"><span class="comment">/// @param queue æ‰§è¡Œé˜Ÿåˆ—ï¼ˆé»˜è®¤ä¸»é˜Ÿåˆ—ï¼‰</span></span><br><span class="line">- (<span class="keyword">instancetype</span>)initWithTimeInterval:(<span class="built_in">NSTimeInterval</span>)interval delay:(<span class="built_in">NSTimeInterval</span>)delay repeats:(<span class="built_in">BOOL</span>)repeats block:(<span class="keyword">void</span> (^)(SFGcdTimer *timer))block queue:(<span class="built_in">dispatch_queue_t</span>)queue &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span> = [<span class="keyword">super</span> init]) &#123;</span><br><span class="line">        <span class="keyword">self</span>.timeInterval = interval;</span><br><span class="line">        <span class="keyword">self</span>.queue = queue;</span><br><span class="line">        <span class="keyword">self</span>.timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">self</span>.queue);</span><br><span class="line">        dispatch_source_set_timer(<span class="keyword">self</span>.timer,</span><br><span class="line">                                  dispatch_time(DISPATCH_TIME_NOW, delay * <span class="built_in">NSEC_PER_SEC</span>), <span class="comment">// å¼€å§‹æ—¶é—´</span></span><br><span class="line">                                  interval * <span class="built_in">NSEC_PER_SEC</span>, <span class="comment">// é—´éš”</span></span><br><span class="line">                                  <span class="number">0</span> <span class="comment">// è¯¯å·®</span></span><br><span class="line">                                  );</span><br><span class="line">        dispatch_source_set_event_handler(<span class="keyword">self</span>.timer, ^&#123;</span><br><span class="line">            <span class="keyword">if</span> (block) &#123;</span><br><span class="line">                block(<span class="keyword">self</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!repeats) &#123;</span><br><span class="line">                [<span class="keyword">self</span> invalidate];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// å¼€å¯</span></span><br><span class="line">- (<span class="keyword">void</span>)fire &#123;</span><br><span class="line">    dispatch_resume(<span class="keyword">self</span>.timer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// æš‚åœ</span></span><br><span class="line">- (<span class="keyword">void</span>)pause &#123;</span><br><span class="line">    dispatch_suspend(<span class="keyword">self</span>.timer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// é”€æ¯</span></span><br><span class="line">- (<span class="keyword">void</span>)invalidate &#123;</span><br><span class="line">    dispatch_source_cancel(<span class="keyword">self</span>.timer);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">pragma</span> mark - lazy load</span></span><br><span class="line"><span class="comment">// é»˜è®¤ä¸»é˜Ÿåˆ—</span></span><br><span class="line">- (<span class="built_in">dispatch_queue_t</span>)queue &#123;</span><br><span class="line">    <span class="keyword">if</span> (!_queue) &#123;</span><br><span class="line">        _queue = dispatch_get_main_queue();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> _queue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></div></figure><hr><p>[ä»£ç é“¾æ¥]<br/><br>GitHubï¼š<span class="exturl"><a class="exturl__link"   href="https://github.com/jack110530/SFCrash" >https://github.com/jack110530/SFCrash</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p><hr><p>[ç›¸å…³å‚è€ƒ]<br/></p><ol><li><span class="exturl"><a class="exturl__link"   href="https://juejin.im/post/6844904033824538638" >æ¯”è¾ƒä¸€ä¸‹iOSä¸­çš„ä¸‰ç§å®šæ—¶å™¨</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> </li><li><span class="exturl"><a class="exturl__link"   href="https://blog.csdn.net/u013480070/article/details/100154694" >å†…å­˜ç®¡ç†â€”â€”å®šæ—¶å™¨é—®é¢˜</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></li></ol><p>[ç›¸å…³æ€è€ƒ]<br/></p><ol><li>NSTimerå’Œçº¿ç¨‹çš„å…³ç³»</li><li>è‹¹æœä¸ºä»€ä¹ˆè¦æŠŠNSTimerä¸­çš„targetè®¾è®¡æˆå¼ºå¼•ç”¨å…³ç³»ï¼Œæ—¢ç„¶ä»–ä¼šå¯¼è‡´å¾ªç¯å¼•ç”¨é—®é¢˜ï¼Œä¸ºä»€ä¹ˆè‹¹æœä¸ç›´æ¥å°†NSTimerçš„targetè®¾è®¡æˆå¼±å¼•ç”¨å…³ç³»ï¼Ÿ</li></ol>]]></content>
    
    
    <summary type="html">&lt;img src=&quot;/%E5%AE%9A%E6%97%B6%E5%99%A8/%E9%87%8D%E6%8B%BEiOS.jpg&quot; class=&quot;&quot;&gt;
&lt;br&gt;

&lt;blockquote&gt;
&lt;p&gt;å…³é”®è¯ï¼šNSTimerã€CADisplayLinkã€GCDã€RunLoop&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="é‡æ‹¾iOS" scheme="https://jack110530.github.io/categories/%E9%87%8D%E6%8B%BEiOS/"/>
    
    
    <category term="timer" scheme="https://jack110530.github.io/tags/timer/"/>
    
  </entry>
  
</feed>
